/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={1655:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=u(e),o=a[0],s=a[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=16383,s=0,u=r-i;s<u;s+=o)a.push(c(e,s,s+o>u?u:s+o));return 1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)n[o]=a[o],r[a.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},9300:(e,t,n)=>{"use strict";var r=n(1655),i=n(4446),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|m(e,t),r=s(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(J(e,Uint8Array)){var t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(J(e,ArrayBuffer)||e&&J(e.buffer,ArrayBuffer))return f(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(J(e,SharedArrayBuffer)||e&&J(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);var i=function(e){if(u.isBuffer(e)){var t=0|d(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||k(e.length)?s(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),s(e<0?0:0|d(e))}function p(e){for(var t=e.length<0?0:0|d(e.length),n=s(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function d(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||J(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(e).length;default:if(i)return r?-1:B(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return S(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return x(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return M(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),k(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var h=!0,p=0;p<u;p++)if(c(e,a+p)!==c(t,p)){h=!1;break}if(h)return a}return-1}function E(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(k(s))return o;e[n+o]=s}return o}function w(e,t,n,r){return F(B(t,e.length-n),e,n,r)}function T(e,t,n,r){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function C(e,t,n,r){return F(U(t),e,n,r)}function N(e,t,n,r){return F(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function M(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=R));return n}(r)}t.kMaxLength=o,u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?s(e):void 0!==t?"string"==typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},u.allocUnsafe=function(e){return h(e)},u.allocUnsafeSlow=function(e){return h(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(J(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),J(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(J(a,Uint8Array))i+a.length>r.length?u.from(a).copy(r,i):Uint8Array.prototype.set.call(r,a,i);else{if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i)}i+=a.length}return r},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):y.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(u.prototype[a]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,i){if(J(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),h=0;h<s;++h)if(c[h]!==l[h]){a=c[h],o=l[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return E(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return T(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var R=4096;function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function S(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=G[e[a]];return i}function P(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length-1;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function _(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,r,a){return t=+t,n>>>=0,a||j(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,a){return t=+t,n>>>=0,a||j(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||_(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||_(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);_(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);_(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||_(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:u.from(e,r),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var L=/[^+/0-9A-Za-z-_]/g;function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function U(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function J(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function k(e){return e!=e}var G=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},1300:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(8002)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},8002:(e,t,n)=>{e.exports=function(e){function t(e){let n,i=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";s++;const a=t.formatters[i];if("function"==typeof a){const t=e[s];n=a.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null===i?t.enabled(e):i,set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(2118),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},4446:(e,t)=>{t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,p=n?-1:1,f=e[t+h];for(h+=p,a=f&(1<<-l)-1,f>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=p,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=p,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=c}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+f]=255&o,f+=d,o/=256,c-=8);e[n+f-d]|=128*m}},4566:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},2118:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,o){o=o||{};var s,u,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===c&&isFinite(e))return o.long?(s=e,(u=Math.abs(s))>=i?a(s,u,i,"day"):u>=r?a(s,u,r,"hour"):u>=n?a(s,u,n,"minute"):u>=t?a(s,u,t,"second"):s+" ms"):function(e){var a=Math.abs(e);return a>=i?Math.round(e/i)+"d":a>=r?Math.round(e/r)+"h":a>=n?Math.round(e/n)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},7253:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=a(e);function a(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=a(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,o={__proto__:[]}instanceof Array,s=!a&&!o,u={create:a?function(){return q(Object.create(null))}:o?function(){return q({__proto__:null})}:function(){return q({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,a)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function a(e,t){return t}function o(e,t){return[e,t]}}():Map,p=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,f=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+o()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function d(e,t,n){var r=f.get(e);if(C(r)){if(!n)return;r=new h,f.set(e,r)}var i=r.get(t);if(C(i)){if(!n)return;i=new h,r.set(t,i)}return i}function m(e,t,n){if(y(e,t,n))return!0;var r=j(t);return!N(r)&&m(e,r,n)}function y(e,t,n){var r=d(t,n,!1);return!C(r)&&!!r.has(e)}function v(e,t,n){if(y(e,t,n))return g(e,t,n);var r=j(t);return N(r)?void 0:v(e,r,n)}function g(e,t,n){var r=d(t,n,!1);if(!C(r))return r.get(e)}function b(e,t,n,r){d(n,r,!0).set(e,t)}function E(e,t){var n=w(e,t),r=j(e);if(null===r)return n;var i=E(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var a=new p,o=[],s=0,u=n;s<u.length;s++){var c=u[s];a.has(c)||(a.add(c),o.push(c))}for(var l=0,h=i;l<h.length;l++)c=h[l],a.has(c)||(a.add(c),o.push(c));return o}function w(e,t){var n=[],r=d(e,t,!1);if(C(r))return n;for(var a=function(e){var t=P(e,i);if(!O(t))throw new TypeError;var n=t.call(e);if(!M(n))throw new TypeError;return n}(r.keys()),o=0;;){var s=I(a);if(!s)return n.length=o,n;var u=s.value;try{n[o]=u}catch(e){try{_(a)}finally{throw e}}o++}}function T(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function C(e){return void 0===e}function N(e){return null===e}function M(e){return"object"==typeof e?null!==e:"function"==typeof e}function A(e,t){switch(T(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=P(e,r);if(void 0!==i){var a=i.call(e,n);if(M(a))throw new TypeError;return a}return function(e,t){if("string"===t){var n=e.toString;if(O(n)&&!M(i=n.call(e)))return i;if(O(r=e.valueOf)&&!M(i=r.call(e)))return i}else{var r;if(O(r=e.valueOf)&&!M(i=r.call(e)))return i;var i,a=e.toString;if(O(a)&&!M(i=a.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function R(e){var t=A(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function x(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function O(e){return"function"==typeof e}function S(e){return"function"==typeof e}function P(e,t){var n=e[t];if(null!=n){if(!O(n))throw new TypeError;return n}}function I(e){var t=e.next();return!t.done&&t}function _(e){var t=e.return;t&&t.call(e)}function j(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function q(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(C(n)){if(!x(e))throw new TypeError;if(!S(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!C(r)&&!N(r)){if(!S(r))throw new TypeError;t=r}}return t}(e,t)}if(!x(e))throw new TypeError;if(!M(t))throw new TypeError;if(!M(r)&&!C(r)&&!N(r))throw new TypeError;return N(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!C(a)&&!N(a)){if(!M(a))throw new TypeError;r=a}}return r}(e,t,n=R(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!M(n))throw new TypeError;if(!C(r)&&!function(e){switch(T(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;b(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!M(n))throw new TypeError;return C(r)||(r=R(r)),b(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return C(n)||(n=R(n)),m(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return C(n)||(n=R(n)),y(e,t,n)})),e("getMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return C(n)||(n=R(n)),v(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!M(t))throw new TypeError;return C(n)||(n=R(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!M(e))throw new TypeError;return C(t)||(t=R(t)),E(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!M(e))throw new TypeError;return C(t)||(t=R(t)),w(e,t)})),e("deleteMetadata",(function(e,t,n){if(!M(t))throw new TypeError;C(n)||(n=R(n));var r=d(t,n,!1);if(C(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=f.get(t);return i.delete(n),i.size>0||f.delete(t),!0}))}(i)}()}(r||(r={}))},2735:(e,t,n)=>{var r=n(9300),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),o.prototype=Object.create(i.prototype),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},984:(e,t,n)=>{var r=n(2735).Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var n=this._block,i=this._blockSize,a=e.length,o=this._len,s=0;s<a;){for(var u=o%i,c=Math.min(a-s,i-u),l=0;l<c;l++)n[u+l]=e[s+l];s+=c,(o+=c)%i==0&&this._update(n)}return this._len+=a,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=i},4706:(e,t,n)=>{var r=e.exports=function(e){e=e.toLowerCase();var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};r.sha=n(5226),r.sha1=n(3354),r.sha224=n(6301),r.sha256=n(303),r.sha384=n(9270),r.sha512=n(3123)},5226:(e,t,n)=>{var r=n(4566),i=n(984),a=n(2735).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<30|e>>>2}function l(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,h=0;h<16;++h)n[h]=e.readInt32BE(4*h);for(;h<80;++h)n[h]=n[h-3]^n[h-8]^n[h-14]^n[h-16];for(var p=0;p<80;++p){var f=~~(p/20),d=0|((t=r)<<5|t>>>27)+l(f,i,a,s)+u+n[p]+o[f];u=s,s=a,a=c(i),i=r,r=d}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},3354:(e,t,n)=>{var r=n(4566),i=n(984),a=n(2735).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function h(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,p=0;p<16;++p)n[p]=e.readInt32BE(4*p);for(;p<80;++p)n[p]=(t=n[p-3]^n[p-8]^n[p-14]^n[p-16])<<1|t>>>31;for(var f=0;f<80;++f){var d=~~(f/20),m=c(r)+h(d,i,a,s)+u+n[f]+o[d]|0;u=s,s=a,a=l(i),i=r,r=m}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},6301:(e,t,n)=>{var r=n(4566),i=n(303),a=n(984),o=n(2735).Buffer,s=new Array(64);function u(){this.init(),this._w=s,a.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=u},303:(e,t,n)=>{var r=n(4566),i=n(984),a=n(2735).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function h(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function p(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(u,i),u.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,d=0|this._f,m=0|this._g,y=0|this._h,v=0;v<16;++v)n[v]=e.readInt32BE(4*v);for(;v<64;++v)n[v]=0|(((t=n[v-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+n[v-7]+f(n[v-15])+n[v-16];for(var g=0;g<64;++g){var b=y+p(u)+c(u,d,m)+o[g]+n[g]|0,E=h(r)+l(r,i,a)|0;y=m,m=d,d=u,u=s+b|0,s=a,a=i,i=r,r=b+E|0}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0,this._f=d+this._f|0,this._g=m+this._g|0,this._h=y+this._h|0},u.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=u},9270:(e,t,n)=>{var r=n(4566),i=n(3123),a=n(984),o=n(2735).Buffer,s=new Array(160);function u(){this.init(),this._w=s,a.call(this,128,112)}r(u,i),u.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=u},3123:(e,t,n)=>{var r=n(4566),i=n(984),a=n(2735).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function u(){this.init(),this._w=s,i.call(this,128,112)}function c(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function h(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function p(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function d(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function y(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function v(e,t){return e>>>0<t>>>0?1:0}r(u,i),u.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,i=0|this._ch,a=0|this._dh,s=0|this._eh,u=0|this._fh,g=0|this._gh,b=0|this._hh,E=0|this._al,w=0|this._bl,T=0|this._cl,C=0|this._dl,N=0|this._el,M=0|this._fl,A=0|this._gl,R=0|this._hl,x=0;x<32;x+=2)t[x]=e.readInt32BE(4*x),t[x+1]=e.readInt32BE(4*x+4);for(;x<160;x+=2){var O=t[x-30],S=t[x-30+1],P=f(O,S),I=d(S,O),_=m(O=t[x-4],S=t[x-4+1]),j=y(S,O),q=t[x-14],D=t[x-14+1],L=t[x-32],B=t[x-32+1],U=I+D|0,F=P+q+v(U,I)|0;F=(F=F+_+v(U=U+j|0,j)|0)+L+v(U=U+B|0,B)|0,t[x]=F,t[x+1]=U}for(var J=0;J<160;J+=2){F=t[J],U=t[J+1];var k=l(n,r,i),G=l(E,w,T),Q=h(n,E),V=h(E,n),W=p(s,N),z=p(N,s),K=o[J],Z=o[J+1],H=c(s,u,g),X=c(N,M,A),Y=R+z|0,$=b+W+v(Y,R)|0;$=($=($=$+H+v(Y=Y+X|0,X)|0)+K+v(Y=Y+Z|0,Z)|0)+F+v(Y=Y+U|0,U)|0;var ee=V+G|0,te=Q+k+v(ee,V)|0;b=g,R=A,g=u,A=M,u=s,M=N,s=a+$+v(N=C+Y|0,C)|0,a=i,C=T,i=r,T=w,r=n,w=E,n=$+te+v(E=Y+ee|0,Y)|0}this._al=this._al+E|0,this._bl=this._bl+w|0,this._cl=this._cl+T|0,this._dl=this._dl+C|0,this._el=this._el+N|0,this._fl=this._fl+M|0,this._gl=this._gl+A|0,this._hl=this._hl+R|0,this._ah=this._ah+n+v(this._al,E)|0,this._bh=this._bh+r+v(this._bl,w)|0,this._ch=this._ch+i+v(this._cl,T)|0,this._dh=this._dh+a+v(this._dl,C)|0,this._eh=this._eh+s+v(this._el,N)|0,this._fh=this._fh+u+v(this._fl,M)|0,this._gh=this._gh+g+v(this._gl,A)|0,this._hh=this._hh+b+v(this._hl,R)|0},u.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=u},518:(e,t,n)=>{"use strict";n.d(t,{ZT:()=>i,pi:()=>a,mG:()=>o,Jh:()=>s,XA:()=>u,CR:()=>c,fl:()=>l});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}},3587:(e,t,n)=>{"use strict";n.d(t,{z:()=>a});var r=n(518),i=n(3169),a=function(){function e(){}return e.buildDriverOptions=function(e,t){var n,i;if(e.url){var a=this.parseConnectionUrl(e.url);t&&t.useSid&&a.database&&(a.sid=a.database);try{for(var o=(0,r.XA)(Object.keys(a)),s=o.next();!s.done;s=o.next()){var u=s.value;void 0===a[u]&&delete a[u]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return Object.assign({},e,a)}return Object.assign({},e)},e.buildColumnAlias=function(e,t,n){var r=e.maxAliasLength,a=t+"_"+n;return r&&r>0&&a.length>r?(0,i.vp)(a,{length:r}):a},e.parseConnectionUrl=function(e){var t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),a=i.indexOf("/"),o=-1!==a?i.substr(0,a):i,s=-1!==a?i.substr(a+1):void 0;s&&-1!==s.indexOf("?")&&(s=s.substr(0,s.indexOf("?")));var u=o.lastIndexOf("@"),c=o.substr(0,u),l=o.substr(u+1),h=c,p="",f=c.indexOf(":");-1!==f&&(h=c.substr(0,f),p=c.substr(f+1));var d=(0,r.CR)(l.split(":"),2),m=d[0],y=d[1];return{type:t,host:m,username:decodeURIComponent(h),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}},e}()},28:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var r=function(e,t){this.query=e,this.parameters=t}},3781:(e,t,n)=>{"use strict";n.d(t,{w:()=>b});var r=n(518),i=n(7155),a=n(5585),o=n(9431),s=n(3586),u=n(8836),c=n(5704),l=n(4449),h=n(8946),p=n(988),f=n(6838),d=n(9368),m=function(){function e(e){this.connection=e}return e.prototype.build=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return this.queryRunner=this.connection.createQueryRunner(),this.connection.driver instanceof a.J1?[3,2]:[4,this.queryRunner.startTransaction()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,12,18,20]),e=this.entityToSyncMetadatas.map((function(e){return e.tablePath})),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,4];case 3:n.sent(),n.label=4;case 4:return[4,this.queryRunner.getTables(e)];case 5:return n.sent(),[4,this.queryRunner.getViews([])];case 6:return n.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 7:return n.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,9];case 8:n.sent(),n.label=9;case 9:return this.connection.driver instanceof a.J1?[3,11]:[4,this.queryRunner.commitTransaction()];case 10:n.sent(),n.label=11;case 11:return[3,20];case 12:t=n.sent(),n.label=13;case 13:return n.trys.push([13,16,,17]),this.connection.driver instanceof a.J1?[3,15]:[4,this.queryRunner.rollbackTransaction()];case 14:n.sent(),n.label=15;case 15:return[3,17];case 16:return n.sent(),[3,17];case 17:throw t;case 18:return[4,this.queryRunner.release()];case 19:return n.sent(),[7];case 20:return[2]}}))}))},e.prototype.log=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:this.queryRunner=this.connection.createQueryRunner(),t.label=1;case 1:return t.trys.push([1,,9,11]),e=this.entityToSyncMetadatas.map((function(e){return e.tablePath})),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.queryRunner.getTables(e)];case 4:return t.sent(),[4,this.queryRunner.getViews([])];case 5:return t.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return t.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2,this.queryRunner.getMemorySql()];case 9:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 10:return t.sent(),[7];case 11:return[2]}}))}))},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter((function(e){return e.synchronize&&"entity-child"!==e.tableType&&"view"!==e.tableType}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewEntityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter((function(e){return"view"===e.tableType&&e.synchronize}))},enumerable:!0,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return[4,this.dropOldViews()];case 1:return e.sent(),[4,this.dropOldForeignKeys()];case 2:return e.sent(),[4,this.dropOldIndices()];case 3:return e.sent(),[4,this.dropOldChecks()];case 4:return e.sent(),[4,this.dropOldExclusions()];case 5:return e.sent(),[4,this.dropCompositeUniqueConstraints()];case 6:return e.sent(),[4,this.renameColumns()];case 7:return e.sent(),[4,this.createNewTables()];case 8:return e.sent(),[4,this.dropRemovedColumns()];case 9:return e.sent(),[4,this.addNewColumns()];case 10:return e.sent(),[4,this.updatePrimaryKeys()];case 11:return e.sent(),[4,this.updateExistColumns()];case 12:return e.sent(),[4,this.createNewIndices()];case 13:return e.sent(),[4,this.createNewChecks()];case 14:return e.sent(),[4,this.createNewExclusions()];case 15:return e.sent(),[4,this.createCompositeUniqueConstraints()];case 16:return e.sent(),[4,this.createForeignKeys()];case 17:return e.sent(),[4,this.createViews()];case 18:return e.sent(),[2]}}))}))},e.prototype.dropOldForeignKeys=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=n.foreignKeys.filter((function(t){var n=e.foreignKeys.find((function(e){return y(t,e)}));return!n||n.onDelete&&n.onDelete!==t.onDelete||n.onUpdate&&n.onUpdate!==t.onUpdate}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old foreign keys of "+n.name+": "+i.map((function(e){return e.name})).join(", ")),[4,t.queryRunner.dropForeignKeys(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),c.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.renameTables=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2]}))}))},e.prototype.renameColumns=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?e.columns.length!==n.columns.length||0===(i=e.columns.filter((function(e){return!n.columns.find((function(t){return t.name===e.databaseName&&t.type===c.connection.driver.normalizeType(e)&&t.isNullable===e.isNullable&&t.isUnique===c.connection.driver.normalizeIsUnique(e)}))}))).length||i.length>1||0===(a=n.columns.filter((function(t){return!e.columns.find((function(e){return e.databaseName===t.name&&c.connection.driver.normalizeType(e)===t.type&&e.isNullable===t.isNullable&&c.connection.driver.normalizeIsUnique(e)===t.isUnique}))}))).length||a.length>1?[2,"continue"]:((o=a[0].clone()).name=i[0].databaseName,t.connection.logger.logSchemaBuild('renaming column "'+a[0].name+'" in to "'+o.name+'"'),[4,t.queryRunner.renameColumn(n,a[0],o)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldIndices=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,(function(a){switch(a.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?(i=n.indices.filter((function(t){var n=e.indices.find((function(e){return e.name===t.name}));return!n||!1!==n.synchronize&&(n.isUnique!==t.isUnique||n.isSpatial!==t.isSpatial||!(!c.connection.driver.isFullTextColumnTypeSupported()||n.isFulltext===t.isFulltext)||n.columns.length!==t.columnNames.length||!n.columns.every((function(e){return-1!==t.columnNames.indexOf(e.databaseName)})))})).map((function(e){return(0,r.mG)(c,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: "'+e.name+'" from table '+n.name),[4,this.queryRunner.dropIndex(n,e)];case 1:return t.sent(),[2]}}))}))})),[4,Promise.all(i)]):[2,"continue"];case 1:return a.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldChecks=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:if(this.connection.driver instanceof a.p$||this.connection.driver instanceof a.xI)return[2];e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=n.checks.filter((function(t){return!e.checks.find((function(e){return e.name===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old check constraint: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropCheckConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.dropCompositeUniqueConstraints=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=n.uniques.filter((function(t){return t.columnNames.length>1&&!e.uniques.find((function(e){return e.name===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old unique constraint: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropUniqueConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),c.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldExclusions=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:if(!(this.connection.driver instanceof a.U4))return[2];e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=n.exclusions.filter((function(t){return!e.exclusions.find((function(e){return e.name===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old exclusion constraint: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropExclusionConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewTables=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,s,u,c,l=this;return(0,r.Jh)(this,(function(h){switch(h.label){case 0:e=function(e){var n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t.queryRunner.loadedTables.find((function(t){var n=e.database&&e.database!==l.connection.driver.database?e.database:void 0,r=e.schema||l.connection.driver.options.schema,i=l.connection.driver.buildTableName(e.tableName,r,n);return t.name===i}))?[2,"continue"]:(t.connection.logger.logSchemaBuild("creating a new table: "+e.tablePath),n=o.i.create(e,t.connection.driver),[4,t.queryRunner.createTable(n,!1,!1)]);case 1:return r.sent(),t.queryRunner.loadedTables.push(n),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createViews=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){var n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t.queryRunner.loadedViews.find((function(t){var n=e.database&&e.database!==c.connection.driver.database?e.database:void 0,r=e.schema||c.connection.driver.options.schema,i=c.connection.driver.buildTableName(e.tableName,r,n),a="string"==typeof t.expression?t.expression.trim():t.expression(c.connection).getQuery(),o="string"==typeof e.expression?e.expression.trim():e.expression(c.connection).getQuery();return t.name===i&&a===o}))?[2,"continue"]:(t.connection.logger.logSchemaBuild("creating a new view: "+e.tablePath),n=d.G.create(e,t.connection.driver),[4,t.queryRunner.createView(n)]);case 1:return r.sent(),t.queryRunner.loadedViews.push(n),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.viewEntityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldViews=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return t.viewEntityToSyncMetadatas.find((function(t){var n=t.database&&t.database!==c.connection.driver.database?t.database:void 0,r=t.schema||c.connection.driver.options.schema,i=c.connection.driver.buildTableName(t.tableName,r,n),a="string"==typeof e.expression?e.expression.trim():e.expression(c.connection).getQuery(),o="string"==typeof t.expression?t.expression.trim():t.expression(c.connection).getQuery();return e.name===i&&a===o}))?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping an old view: "+e.name),[4,t.queryRunner.dropView(e)]);case 1:return n.sent(),t.queryRunner.loadedViews.splice(t.queryRunner.loadedViews.indexOf(e),1),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.queryRunner.loadedViews),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropRemovedColumns=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=n.columns.filter((function(t){return!e.columns.find((function(e){return e.databaseName===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("columns dropped in "+n.name+": "+i.map((function(e){return e.name})).join(", ")),[4,t.queryRunner.dropColumns(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),c.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.addNewColumns=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=e.columns.filter((function(e){return!n.columns.find((function(t){return t.name===e.databaseName}))}))).length?[2,"continue"]:(a=t.metadataColumnsToTableColumnOptions(i),0===(o=a.map((function(e){return new s.D(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("new columns added: "+i.map((function(e){return e.databaseName})).join(", ")),[4,t.queryRunner.addColumns(n,o)])):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),u={error:o},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.updatePrimaryKeys=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c,h=this;return(0,r.Jh)(this,(function(p){switch(p.label){case 0:e=function(e){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?(i=e.columns.filter((function(e){return e.isPrimary})),n.columns.filter((function(e){return e.isPrimary})).length!==i.length&&i.length>1?(a=i.map((function(e){return new s.D(l.P.createTableColumnOptions(e,h.connection.driver))})),[4,t.queryRunner.updatePrimaryKeys(n,a)]):[3,2]):[2,"continue"];case 1:r.sent(),r.label=2;case 2:return[2]}}))},t=this,p.label=1;case 1:p.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),p.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:p.sent(),p.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=p.sent(),u={error:o},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.updateExistColumns=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,o,u,c,h,p=this;return(0,r.Jh)(this,(function(f){switch(f.label){case 0:e=function(e){var n,i,o,u,c,h,f,d,m,y,v,g,b,E,w,T,C,N,M;return(0,r.Jh)(this,(function(A){switch(A.label){case 0:if(!(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath}))))return[2,"continue"];if(0===(i=t.connection.driver.findChangedColumns(n.columns,e.columns)).length)return[2,"continue"];A.label=1;case 1:A.trys.push([1,6,7,8]),E=void 0,o=(0,r.XA)(i),u=o.next(),A.label=2;case 2:return u.done?[3,5]:(v=u.value,[4,t.dropColumnReferencedForeignKeys(e.tablePath,v.databaseName)]);case 3:A.sent(),A.label=4;case 4:return u=o.next(),[3,2];case 5:return[3,8];case 6:return c=A.sent(),E={error:c},[3,8];case 7:try{u&&!u.done&&(w=o.return)&&w.call(o)}finally{if(E)throw E.error}return[7];case 8:A.trys.push([8,13,14,15]),T=void 0,h=(0,r.XA)(i),f=h.next(),A.label=9;case 9:return f.done?[3,12]:(v=f.value,[4,t.dropColumnCompositeIndices(e.tablePath,v.databaseName)]);case 10:A.sent(),A.label=11;case 11:return f=h.next(),[3,9];case 12:return[3,15];case 13:return d=A.sent(),T={error:d},[3,15];case 14:try{f&&!f.done&&(C=h.return)&&C.call(h)}finally{if(T)throw T.error}return[7];case 15:if(t.connection.driver instanceof a.p$||t.connection.driver instanceof a.xI)return[3,23];A.label=16;case 16:A.trys.push([16,21,22,23]),N=void 0,m=(0,r.XA)(i),y=m.next(),A.label=17;case 17:return y.done?[3,20]:(v=y.value,[4,t.dropColumnCompositeUniques(e.tablePath,v.databaseName)]);case 18:A.sent(),A.label=19;case 19:return y=m.next(),[3,17];case 20:return[3,23];case 21:return g=A.sent(),N={error:g},[3,23];case 22:try{y&&!y.done&&(M=m.return)&&M.call(m)}finally{if(N)throw N.error}return[7];case 23:return 0===(b=i.map((function(e){var t=n.columns.find((function(t){return t.name===e.databaseName})),r=l.P.createTableColumnOptions(e,p.connection.driver);return{oldColumn:t,newColumn:new s.D(r)}}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild('columns changed in "'+n.name+'". updating: '+i.map((function(e){return e.databaseName})).join(", ")),[4,t.queryRunner.changeColumns(n,b)]);case 24:return A.sent(),[2]}}))},t=this,f.label=1;case 1:f.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),f.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:f.sent(),f.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{i&&!i.done&&(h=n.return)&&h.call(n)}finally{if(c)throw c.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewIndices=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=e.indices.filter((function(e){return!n.indices.find((function(t){return t.name===e.name}))&&!0===e.synchronize})).map((function(e){return c.s.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new indices "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createIndices(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewChecks=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:if(this.connection.driver instanceof a.p$||this.connection.driver instanceof a.xI)return[2];e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=e.checks.filter((function(e){return!n.checks.find((function(t){return t.name===e.name}))})).map((function(e){return p.r.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new check constraints: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createCheckConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createCompositeUniqueConstraints=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=e.uniques.filter((function(e){return e.columns.length>1&&!n.uniques.find((function(t){return t.name===e.name}))})).map((function(e){return h.v.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new unique constraints: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createUniqueConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),c.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewExclusions=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:if(!(this.connection.driver instanceof a.U4))return[2];e=function(e){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=e.exclusions.filter((function(e){return!n.exclusions.find((function(t){return t.name===e.name}))})).map((function(e){return f.N.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new exclusion constraints: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createExclusionConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createForeignKeys=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,c;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return t.name===e.tablePath})))?0===(i=e.foreignKeys.filter((function(e){return!n.foreignKeys.find((function(t){return y(t,e)}))}))).length?[2,"continue"]:(a=i.map((function(e){return u.U.create(e)})),t.connection.logger.logSchemaBuild("creating a foreign keys: "+i.map((function(e){return e.name})).join(", ")+' on table "'+n.name+'"'),[4,t.queryRunner.createForeignKeys(n,a)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.XA)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p;return(0,r.Jh)(this,(function(f){switch(f.label){case 0:if(!(n=this.queryRunner.loadedTables.find((function(t){return t.name===e}))))return[2];if(i=[],(a=n.foreignKeys.find((function(e){return-1!==e.columnNames.indexOf(t)})))&&((o=n.clone()).foreignKeys=[a],i.push(o),n.removeForeignKey(a)),this.queryRunner.loadedTables.forEach((function(n){var r=n.foreignKeys.filter((function(n){return n.referencedTableName===e&&-1!==n.referencedColumnNames.indexOf(t)}));if(r.length>0){var a=n.clone();a.foreignKeys=r,i.push(a),r.forEach((function(e){return n.removeForeignKey(e)}))}})),!(i.length>0))return[3,8];f.label=1;case 1:f.trys.push([1,6,7,8]),s=(0,r.XA)(i),u=s.next(),f.label=2;case 2:return u.done?[3,5]:(c=u.value,this.connection.logger.logSchemaBuild("dropping related foreign keys of "+c.name+": "+c.foreignKeys.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropForeignKeys(c,c.foreignKeys)]);case 3:f.sent(),f.label=4;case 4:return u=s.next(),[3,2];case 5:return[3,8];case 6:return l=f.sent(),h={error:l},[3,8];case 7:try{u&&!u.done&&(p=s.return)&&p.call(s)}finally{if(h)throw h.error}return[7];case 8:return[2]}}))}))},e.prototype.dropColumnCompositeIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return t.name===e})))?0===(i=n.indices.filter((function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)}))).length?[2]:(this.connection.logger.logSchemaBuild('dropping related indices of "'+e+'"."'+t+'": '+i.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropIndices(n,i)]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.dropColumnCompositeUniques=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return t.name===e})))?0===(i=n.uniques.filter((function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)}))).length?[2]:(this.connection.logger.logSchemaBuild('dropping related unique constraints of "'+e+'"."'+t+'": '+i.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropUniqueConstraints(n,i)]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.metadataColumnsToTableColumnOptions=function(e){var t=this;return e.map((function(e){return l.P.createTableColumnOptions(e,t.connection.driver)}))},e.prototype.createTypeormMetadataTable=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return e=this.connection.driver.options,t=this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database),[4,this.queryRunner.createTable(new o.i({name:t,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0}]}),!0)];case 1:return n.sent(),[2]}}))}))},e}();function y(e,t){return e.name===t.name&&e.referencedTableName===t.referencedTablePath}var v=n(8731),g=n(7718),b=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}}))}))},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close((function(e){return e?n(e):t()}))}))]}))}))},e.prototype.createSchemaBuilder=function(){return new m(this.connection)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=g.A.transformTo(t.transformer,e)),null==e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?i.E.mixedDateToDateString(e):"time"===t.type?i.E.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?i.E.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?i.E.simpleArrayToString(e):"simple-json"===t.type?i.E.simpleJsonToString(e):"simple-enum"===t.type?i.E.simpleEnumToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?g.A.transformFrom(t.transformer,e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"==typeof e&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=i.E.normalizeHydratedDate(e)):"date"===t.type?e=i.E.mixedDateToDateString(e):"time"===t.type?e=i.E.mixedTimeToString(e):"simple-array"===t.type?e=i.E.stringToSimpleArray(e):"simple-json"===t.type?e=i.E.stringToSimpleJson(e):"simple-enum"===t.type&&(e=i.E.stringToSimpleEnum(e,t)),t.transformer&&(e=g.A.transformFrom(t.transformer,e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return"boolean"==typeof n[e]?!0===n[e]?1:0:n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map((function(e){return r.push(e),"?"})).join(", "):n instanceof Function?n():(r.push(n),"?")})),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){return e},e.prototype.normalizeType=function(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"varchar":e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some((function(t){return 1===t.columns.length&&t.columns[0]===e}))},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.enum?"varchar":(e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t)},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t,n,r){var i=e.generatedColumns.reduce((function(e,i){var a;return"increment"===i.generationStrategy&&t&&(a=t-r+n+1),a?v.s.mergeDeep(e,i.createValueMap(a)):e}),{});return Object.keys(i).length>0?i:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)}))},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.isFullTextColumnTypeSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.createDatabaseConnection=function(){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}()},5890:(e,t,n)=>{"use strict";n.d(t,{J:()=>g});var r=n(518),i=n(2183),a=n(4825),o=n(3586),s=n(9693),u=n(9431),c=n(5704),l=n(8836),h=n(9368),p=n(3730),f=n(28),d=n(8946),m=n(7962),y=n(8731),v=n(988),g=function(e){function t(){return e.call(this)||this}return(0,r.ZT)(t,e),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(this.isTransactionActive)throw new i.S;if(!e)return[3,4];if("READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new Error("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");return"READ UNCOMMITTED"!==e?[3,2]:[4,this.query("PRAGMA read_uncommitted = true")];case 1:return r.sent(),[3,4];case 2:return[4,this.query("PRAGMA read_uncommitted = false")];case 3:r.sent(),r.label=4;case 4:return t=new p.D,this.broadcaster.broadcastBeforeTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,6];case 5:r.sent(),r.label=6;case 6:return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 7:return r.sent(),n=new p.D,this.broadcaster.broadcastAfterTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,9];case 8:r.sent(),r.label=9;case 9:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new a.W;return e=new p.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:return n.sent(),this.isTransactionActive=!1,t=new p.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new a.W;return e=new p.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:return n.sent(),this.isTransactionActive=!1,t=new p.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by sqlite driver.")},t.prototype.getDatabases=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve(!1)]}))}))},t.prototype.hasSchema=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("This driver does not support table schemas")}))}))},t.prototype.hasTable=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t=e instanceof u.i?e.name:e,n='SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" = \''+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=e instanceof u.i?e.name:e,i='PRAGMA table_info("'+n+'")',[4,this.query(i)];case 1:return[2,!!r.sent().find((function(e){return e.name===t}))]}}))}))},t.prototype.createDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,(function(){var a,o,s=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return a=[],o=[],t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,(function(){var a,o,s,c,l,h=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof u.i?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,c=[],l=[],i&&o.indices.forEach((function(e){c.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))})),c.push(this.dropTableSql(o,t)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t=e instanceof h.G?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,c=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).name=t,o=new f.A('ALTER TABLE "'+n.name+'" RENAME TO "'+t+'"'),s=new f.A('ALTER TABLE "'+t+'" RENAME TO "'+n.name+'"'),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.name=a.name,a.uniques.forEach((function(e){e.name=c.connection.namingStrategy.uniqueConstraintName(a,e.columnNames)})),a.foreignKeys.forEach((function(e){e.name=c.connection.namingStrategy.foreignKeyName(a,e.columnNames,e.referencedTableName,e.referencedColumnNames)})),a.indices.forEach((function(e){e.name=c.connection.namingStrategy.indexName(a,e.columnNames,e.where)})),[4,this.recreateTable(a,n)];case 5:return r.sent(),[2]}}))}))},t.prototype.addColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,this.addColumns(n,[t])]}}))}))},t.prototype.addColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addColumn(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,s,c;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.D?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.D?c=n:(c=s.clone()).name=n,[2,this.changeColumn(i,s,c)]}}))}))},t.prototype.changeColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.D?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return[4,this.changeColumns(i,[{oldColumn:s,newColumn:n}])];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){e.newColumn.name!==e.oldColumn.name&&(a.findColumnUniques(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.uniqueConstraintName(a,t.columnNames)})),a.findColumnForeignKeys(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.foreignKeyName(a,t.columnNames,t.referencedTableName,t.referencedColumnNames)})),a.findColumnIndices(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.indexName(a,t.columnNames,t.where)})));var t=a.columns.find((function(t){return t.name===e.oldColumn.name}));t&&(a.columns[a.columns.indexOf(t)]=e.newColumn)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.D?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return[4,this.dropColumns(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){a.removeColumn(e),a.findColumnUniques(e).forEach((function(e){return a.removeUniqueConstraint(e)})),a.findColumnIndices(e).forEach((function(e){return a.removeIndex(e)})),a.findColumnForeignKeys(e).forEach((function(e){return a.removeForeignKey(e)}))})),[4,this.recreateTable(a,n)];case 4:return r.sent(),t.forEach((function(e){n.removeColumn(e),n.findColumnUniques(e).forEach((function(e){return n.removeUniqueConstraint(e)})),n.findColumnIndices(e).forEach((function(e){return n.removeIndex(e)})),n.findColumnForeignKeys(e).forEach((function(e){return n.removeForeignKey(e)}))})),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),n.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return(i=(t=n).clone()).primaryColumns.forEach((function(e){e.isPrimary=!1})),[4,this.recreateTable(i,t)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.createUniqueConstraints(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addUniqueConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.v?t:n.uniques.find((function(e){return e.name===t}))))throw new Error("Supplied unique constraint was not found in table "+n.name);return[4,this.dropUniqueConstraints(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeUniqueConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.createCheckConstraints(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addCheckConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof v.r?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return[4,this.dropCheckConstraints(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeCheckConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.createForeignKeys(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addForeignKey(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.U?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return[4,this.dropForeignKeys(e,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeForeignKey(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof u.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.s?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return r.sent(),[4,this.startTransaction()];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,9,14,16]),[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 4:return e=r.sent(),[4,Promise.all(e.map((function(e){return i.query(e.query)})))];case 5:return r.sent(),[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 6:return t=r.sent(),[4,Promise.all(t.map((function(e){return i.query(e.query)})))];case 7:return r.sent(),[4,this.commitTransaction()];case 8:return r.sent(),[3,16];case 9:n=r.sent(),r.label=10;case 10:return r.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:case 12:return r.sent(),[3,13];case 13:throw n;case 14:return[4,this.query("PRAGMA foreign_keys = ON;")];case 15:return r.sent(),[7];case 16:return[2]}}))}))},t.prototype.loadViews=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(t=e.map((function(e){return"'"+e+"'"})).join(", "),n='SELECT "t".* FROM "'+this.getTypeormMetadataTableName()+'" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = \'view\' WHERE "t"."type" = \'VIEW\'',t.length>0&&(n+=' AND "t"."name" IN ('+t+")"),[4,this.query(n)]):[2,Promise.resolve([])];case 2:return[2,r.sent().map((function(e){var t=new h.G;return t.name=e.name,t.expression=e.value,t}))]}}))}))},t.prototype.loadTables=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a=this;return(0,r.Jh)(this,(function(s){switch(s.label){case 0:return e&&e.length?(t=e.map((function(e){return"'"+e+"'"})).join(", "),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" IN ('+t+")")]):[2,[]];case 1:return n=s.sent(),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'index\' AND "tbl_name" IN ('+t+")")];case 2:return i=s.sent(),n&&n.length?[2,Promise.all(n.map((function(e){return(0,r.mG)(a,void 0,void 0,(function(){var t,n,a,s,h,p,f,m,g,b,E,w,T,C,N,M,A,R,x=this;return(0,r.Jh)(this,(function(O){switch(O.label){case 0:return t=new u.i({name:e.name}),n=e.sql,[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return a=r.CR.apply(void 0,[O.sent(),3]),s=a[0],h=a[1],p=a[2],f=void 0,m=e.sql,-1!==(g=m.toUpperCase().indexOf("AUTOINCREMENT"))&&(f=m.substr(0,g),b=f.lastIndexOf(","),E=f.lastIndexOf("("),-1!==b?f=(f=(f=f.substr(b)).substr(0,f.lastIndexOf('"'))).substr(f.indexOf('"')+1):-1!==E&&(f=(f=(f=f.substr(E)).substr(0,f.lastIndexOf('"'))).substr(f.indexOf('"')+1))),t.columns=s.map((function(e){var t=new o.D;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=f===e.name,t.isGenerated&&(t.generationStrategy="increment"),"varchar"===t.type){var r=n.match(new RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\\1\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));r&&(t.type="simple-enum",t.enum=r[2].substr(1,r[2].length-2).split("','"))}var i=t.type.indexOf("(");if(-1!==i){var a=t.type,s=a.substr(0,i);if(x.driver.withLengthColumnTypes.find((function(e){return e===s}))){var u=parseInt(a.substring(i+1,a.length-1));u&&(t.length=u.toString(),t.type=s)}if(x.driver.withPrecisionColumnTypes.find((function(e){return e===s}))){var c=new RegExp("^"+s+"\\((\\d+),?\\s?(\\d+)?\\)"),l=a.match(c);l&&l[1]&&(t.precision=+l[1]),x.driver.withScaleColumnTypes.find((function(e){return e===s}))&&l&&l[2]&&(t.scale=+l[2]),t.type=s}}return t})),w=y.s.uniq(p,(function(e){return e.id})),t.foreignKeys=w.map((function(e){var n=p.filter((function(t){return t.id===e.id&&t.table===e.table})),r=n.map((function(e){return e.from})),i=n.map((function(e){return e.to})),a=x.connection.namingStrategy.foreignKeyName(t,r,e.referencedTableName,e.referencedColumnNames);return new l.U({name:a,columnNames:r,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})})),T=h.filter((function(e){return"u"===e.origin})).map((function(e){return e.name})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return(0,r.mG)(x,void 0,void 0,(function(){var n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=h.find((function(t){return t.name===e})),[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return i=r.sent(),1===(a=i.sort((function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)})).map((function(e){return e.name}))).length&&(o=t.columns.find((function(e){return!!a.find((function(t){return t===e.name}))})))&&(o.isUnique=!0),[2,new d.v({name:this.connection.namingStrategy.uniqueConstraintName(t,a),columnNames:a})]}}))}))})),C=t,[4,Promise.all(T)];case 2:for(C.uniques=O.sent(),M=/CONSTRAINT "([^"]*)" CHECK (\(.*?\))([,]|[)]$)/g;null!==(N=M.exec(n));)t.checks.push(new v.r({name:N[1],expression:N[2]}));return A=h.filter((function(e){return"c"===e.origin})).map((function(e){return e.name})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return(0,r.mG)(x,void 0,void 0,(function(){var n,a,o,s,u,l;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=i.find((function(t){return t.name===e})),a=/WHERE (.*)/.exec(n.sql),o=h.find((function(t){return t.name===e})),[4,this.query('PRAGMA index_info("'+o.name+'")')];case 1:return s=r.sent(),u=s.sort((function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)})).map((function(e){return e.name})),l="1"===o.unique||1===o.unique,[2,new c.s({table:t,name:o.name,columnNames:u,isUnique:l,where:a?a[1]:void 0})]}}))}))})),[4,Promise.all(A)];case 3:return R=O.sent(),t.indices=R.filter((function(e){return!!e})),[2,t]}}))}))})))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.filter((function(e){return e.isPrimary})),i=r.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})),a=r.length>1;if(a&&i)throw new Error("Sqlite does not support AUTOINCREMENT on composite primary key");var o=e.columns.map((function(e){return n.buildCreateColumnSql(e,a)})).join(", "),s='CREATE TABLE "'+e.name+'" ('+o;e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new d.v({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0&&(s+=", "+e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", ")),e.checks.length>0&&(s+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", ")),e.foreignKeys.length>0&&t&&(s+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a})).join(", ")),r.length>1&&(s+=", PRIMARY KEY ("+r.map((function(e){return'"'+e.name+'"'})).join(", ")+")"),s+=")";var u=this.connection.entityMetadatas.find((function(t){return t.tableName===e.name}));return u&&u.withoutRowid&&(s+=" WITHOUT ROWID"),new f.A(s)},t.prototype.dropTableSql=function(e,t){var n=e instanceof u.i?e.name:e,r=t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"';return new f.A(r)},t.prototype.createViewSql=function(e){return"string"==typeof e.expression?new f.A('CREATE VIEW "'+e.name+'" AS '+e.expression):new f.A('CREATE VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=(0,r.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new f.A(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof h.G?e.name:e;return new f.A('DROP VIEW "'+t+'"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof h.G?e.name:e,n=this.connection.createQueryBuilder(),i=(0,r.CR)(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape("type")+" = 'VIEW'").andWhere(n.escape("name")+" = :name",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new f.A(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new f.A("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e){var t=e instanceof c.s?e.name:e;return new f.A('DROP INDEX "'+t+'"')},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return e instanceof s.T?n+=" "+this.driver.normalizeType(e):n+=" "+this.connection.driver.createFullType(e),e.enum&&(n+=" CHECK( "+e.name+" IN ("+e.enum.map((function(e){return"'"+e+"'"})).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n},t.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),(0,r.mG)(this,void 0,void 0,(function(){var i,a,o,s,u=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return i=[],a=[],t.indices.forEach((function(e){i.push(u.dropIndexSql(e)),a.push(u.createIndexSql(t,e))})),e.name="temporary_"+e.name,i.push(this.createTableSql(e,!0)),a.push(this.dropTableSql(e)),n&&(o=e.columns.map((function(e){return'"'+e.name+'"'})).join(", "),s=t.columns.map((function(e){return'"'+e.name+'"'})).join(", "),t.columns.length<e.columns.length?o=e.columns.filter((function(e){return t.columns.find((function(t){return t.name===e.name}))})).map((function(e){return'"'+e.name+'"'})).join(", "):t.columns.length>e.columns.length&&(s=t.columns.filter((function(t){return e.columns.find((function(e){return e.name===t.name}))})).map((function(e){return'"'+e.name+'"'})).join(", ")),i.push(new f.A('INSERT INTO "'+e.name+'"('+o+") SELECT "+s+' FROM "'+t.name+'"')),a.push(new f.A('INSERT INTO "'+t.name+'"('+s+") SELECT "+o+' FROM "'+e.name+'"'))),i.push(this.dropTableSql(t)),a.push(this.createTableSql(t,!0)),i.push(new f.A('ALTER TABLE "'+e.name+'" RENAME TO "'+t.name+'"')),a.push(new f.A('ALTER TABLE "'+t.name+'" RENAME TO "'+e.name+'"')),e.name=t.name,e.indices.forEach((function(t){t.name||(t.name=u.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),i.push(u.createIndexSql(e,t)),a.push(u.dropIndexSql(t))})),[4,this.executeQueries(i,a)];case 1:return r.sent(),this.replaceCachedTable(t,e),[2]}}))}))},t}(m.Y)},8529:(e,t,n)=>{"use strict";n.d(t,{x:()=>d});var r=n(518),i=n(3781),a=n(3653),o=n(5890),s=n(5725),u=n(3321),c=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return(0,r.ZT)(t,e),t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}}))}))},t.prototype.query=function(e,t){var n=this;if(void 0===t&&(t=[]),this.isReleased)throw new a.Y;return new Promise((function(i,a){return(0,r.mG)(n,void 0,void 0,(function(){var n,o,s,c,l,h,p;return(0,r.Jh)(this,(function(r){n=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),o=+new Date;try{for(s=n.prepare(e),t&&(t=t.map((function(e){return void 0!==e?e:null})),s.bind(t)),c=this.driver.connection.options.maxQueryExecutionTime,l=+new Date,h=l-o,c&&h>c&&this.driver.connection.logger.logQuerySlow(h,e,t,this),p=[];s.step();)p.push(s.getAsObject());s.free(),i(p)}catch(n){s&&s.free(),this.driver.connection.logger.logQueryError(n,e,t,this),a(new u.O(e,t,n))}return[2]}))}))}))},t}(o.J),l=n(9313),h=n(733),p=n(1649),f=n(8731),d=function(e){function t(t){var n=e.call(this,t)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new h.f("location or autoSaveCallback");return n.loadDependencies(),n}return(0,r.ZT)(t,e),t.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}}))}))},t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(e){n(e)}}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new c(this)),this.queryRunner},t.prototype.load=function(e,t){return void 0===t&&(t=!0),(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if("string"!=typeof e)return[3,8];if("node"!==p.Qm.type)return[3,1];if(p.Qm.fileExist(e))return n=p.Qm.readFileSync(e),[2,this.createDatabaseConnectionWithImport(n)];if(t)throw new Error("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 1:return i=null,this.options.useLocalForage?window.localforage?[4,window.localforage.getItem(e)]:[3,3]:[3,5];case 2:return i=r.sent(),[3,4];case 3:throw new Error("localforage is not defined - please import localforage.js into your site");case 4:return[3,6];case 5:i=p.Qm.getGlobalVariable().localStorage.getItem(e),r.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(t)throw new Error("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}}))}))},t.prototype.save=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(!e&&!this.options.location)throw new Error("No location is set, specify a location parameter or add the location option to your configuration");if(t="",e?t=e:this.options.location&&(t=this.options.location),"node"!==p.Qm.type)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),n=Buffer.from(this.databaseConnection.export()),[4,p.Qm.writeFile(t,n)];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),new Error("Could not save database, error: "+i);case 4:return[3,10];case 5:return a=this.databaseConnection.export(),o=[].slice.call(a),this.options.useLocalForage?window.localforage?[4,window.localforage.setItem(t,JSON.stringify(o))]:[3,7]:[3,9];case 6:return r.sent(),[3,8];case 7:throw new Error("localforage is not defined - please import localforage.js into your site");case 8:return[3,10];case 9:p.Qm.getGlobalVariable().localStorage.setItem(t,JSON.stringify(o)),r.label=10;case 10:return[2]}}))}))},t.prototype.autoSave=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))},t.prototype.export=function(){return this.databaseConnection.export()},t.prototype.createGeneratedMap=function(e,t){var n=this,r=e.generatedColumns.reduce((function(e,t){if(t.isPrimary&&"increment"===t.generationStrategy){var r="SELECT last_insert_rowid()";try{var i=n.databaseConnection.exec(r);return n.connection.logger.logQuery(r),f.s.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(e){n.connection.logger.logQueryError(e,r,[])}}return e}),{});return Object.keys(r).length>0?r:void 0},t.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},t.prototype.createDatabaseConnectionWithImport=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return"function"==typeof this.sqlite.Database?(n=this.sqlite,[3,3]):[3,1];case 1:return[4,this.sqlite(this.options.sqlJsConfig)];case 2:n=r.sent(),r.label=3;case 3:return t=n,e&&e.length>0?this.databaseConnection=new t.Database(e):this.databaseConnection=new t.Database,[2,new Promise((function(e,t){try{i.databaseConnection.exec("PRAGMA foreign_keys = ON;"),e(i.databaseConnection)}catch(e){t(e)}}))]}}))}))},t.prototype.loadDependencies=function(){if("browser"===p.Qm.type)this.sqlite=window.SQL;else try{this.sqlite=p.Qm.load("sql.js")}catch(e){throw new l.z("sql.js","sql.js")}},t}(i.w)},8154:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});var r=function(e){this.options=e}},733:(e,t,n)=>{"use strict";n.d(t,{f:()=>i});var r=n(518),i=function(e){function t(n){var r=e.call(this)||this;return r.name="DriverOptionNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Driver option ("+n+") is not set. Please set it to perform connection to the database.",r}return(0,r.ZT)(t,e),t}(Error)},9313:(e,t,n)=>{"use strict";n.d(t,{z:()=>i});var r=n(518),i=function(e){function t(n,r){var i=e.call(this)||this;return i.name="DriverPackageNotInstalledError",Object.setPrototypeOf(i,t.prototype),i.message=n+" package has not been found installed. Try to install it: npm install "+r+" --save",i}return(0,r.ZT)(t,e),t}(Error)},7126:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});var r=n(518),i=function(e){function t(n){var r=e.call(this)||this;return r.name="EntityColumnNotFound",Object.setPrototypeOf(r,t.prototype),r.message='No entity column "'+n+'" was found.',r}return(0,r.ZT)(t,e),t}(Error)},597:(e,t,n)=>{"use strict";n.d(t,{E:()=>a});var r=n(518),i=n(9878),a=function(e){function t(n,r){var a,o=e.call(this)||this;o.name="EntityNotFound",Object.setPrototypeOf(o,t.prototype),a=n instanceof i.IU?n.options.name:"function"==typeof n||"object"==typeof n&&"name"in n?n.name:n;var s=o.stringifyCriteria(r);return o.message='Could not find any entity of type "'+a+'" matching: '+s,o}return(0,r.ZT)(t,e),t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e},t}(Error)},2108:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});var r=n(518),i=function(e){function t(){var n=e.call(this)||this;return n.name="LimitOnUpdateNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="Your database does not support LIMIT on UPDATE statements.",n}return(0,r.ZT)(t,e),t}(Error)},3321:(e,t,n)=>{"use strict";n.d(t,{O:()=>a});var r=n(518),i=n(4205),a=function(e){function t(n,a,o){var s=e.call(this)||this;return Object.setPrototypeOf(s,t.prototype),s.message=o.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""),i.g.assign(s,(0,r.pi)((0,r.pi)({},o),{name:"QueryFailedError",query:n,parameters:a||[]})),s}return(0,r.ZT)(t,e),t}(Error)},3653:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i});var r=n(518),i=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Query runner already released. Cannot run queries anymore.",n}return(0,r.ZT)(t,e),t}(Error)},6572:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});var r=n(518),i=function(e){function t(){var n=e.call(this)||this;return n.name="ReturningStatementNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.",n}return(0,r.ZT)(t,e),t}(Error)},2183:(e,t,n)=>{"use strict";n.d(t,{S:()=>i});var r=n(518),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionAlreadyStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction already started for the given connection, commit current transaction before starting a new one.",n}return(0,r.ZT)(t,e),t}(Error)},4825:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});var r=n(518),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionNotStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction is not started yet, start transaction before committing or rolling it back.",n}return(0,r.ZT)(t,e),t}(Error)},8163:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});var r=n(518),i=function(e){function t(){var n=e.call(this)||this;return n.name="UpdateValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.',n}return(0,r.ZT)(t,e),t}(Error)},7979:(e,t,n)=>{"use strict";n.d(t,{J:()=>r});var r=function(){function e(e,t,n,r,i,a){void 0===n&&(n=!0),void 0===r&&(r=!1),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r,this._getSql=i,this._objectLiteralParameters=a}return Object.defineProperty(e.prototype,"useParameter",{get:function(){return this._value instanceof e?this._value.useParameter:this._useParameter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleParameters",{get:function(){return this._value instanceof e?this._value.multipleParameters:this._multipleParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value instanceof e?this._value.value:this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectLiteralParameters",{get:function(){return this._value instanceof e?this._value.objectLiteralParameters:this._objectLiteralParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"child",{get:function(){if(this._value instanceof e)return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getSql",{get:function(){return this._value instanceof e?this._value.getSql:this._getSql},enumerable:!0,configurable:!0}),e}()},2410:(e,t,n)=>{"use strict";n.d(t,{In:()=>i});var r=n(7979);function i(e){return new r.J("in",e,!0,!0)}},9878:(e,t,n)=>{"use strict";n.d(t,{Yc:()=>kt,sg:()=>Bt,er:()=>Ut,JH:()=>Wt,IU:()=>yt.I,Q2:()=>Gt,hA:()=>Qt,IF:()=>Vt,bs:()=>Ft,RU:()=>Jt,I5:()=>Ht,B5:()=>Xt,vJ:()=>zt});var r=n(518),i=(n(7253),n(2972)),a=n(3169),o=n(9431),s=function(){function e(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}return e.prototype.tableName=function(e,t){return t||(0,a.fu)(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){var r=t||e;return n.length?(0,a.eV)(n.join("_"))+(0,a.Qs)(r):r},e.prototype.relationName=function(e){return e},e.prototype.primaryKeyName=function(e,t){var n=(0,r.fl)(t);n.sort();var a=(e instanceof o.i?e.name:e).replace(".","_")+"_"+n.join("_");return"PK_"+i.f.sha1(a).substr(0,27)},e.prototype.uniqueConstraintName=function(e,t){var n=(0,r.fl)(t);n.sort();var a=(e instanceof o.i?e.name:e).replace(".","_")+"_"+n.join("_");return"UQ_"+i.f.sha1(a).substr(0,27)},e.prototype.relationConstraintName=function(e,t,n){var a=(0,r.fl)(t);a.sort();var s=(e instanceof o.i?e.name:e).replace(".","_")+"_"+a.join("_");return n&&(s+="_"+n),"REL_"+i.f.sha1(s).substr(0,26)},e.prototype.defaultConstraintName=function(e,t){var n=(e instanceof o.i?e.name:e).replace(".","_")+"_"+t;return"DF_"+i.f.sha1(n).substr(0,27)},e.prototype.foreignKeyName=function(e,t,n,a){var s=(0,r.fl)(t);s.sort();var u=(e instanceof o.i?e.name:e).replace(".","_")+"_"+s.join("_");return"FK_"+i.f.sha1(u).substr(0,27)},e.prototype.indexName=function(e,t,n){var a=(0,r.fl)(t);a.sort();var s=(e instanceof o.i?e.name:e).replace(".","_")+"_"+a.join("_");return n&&(s+="_"+n),"IDX_"+i.f.sha1(s).substr(0,26)},e.prototype.checkConstraintName=function(e,t){var n=(e instanceof o.i?e.name:e).replace(".","_")+"_"+t;return"CHK_"+i.f.sha1(n).substr(0,26)},e.prototype.exclusionConstraintName=function(e,t){var n=(e instanceof o.i?e.name:e).replace(".","_")+"_"+t;return"XCL_"+i.f.sha1(n).substr(0,26)},e.prototype.joinColumnName=function(e,t){return(0,a.eV)(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,r){return(0,a.fu)(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return(0,a.eV)(e+"_"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.prefixTableName=function(e,t){return e+t},e.prototype.eagerJoinRelationAlias=function(e,t){return e+"_"+t.replace(".","_")},e}(),u=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotExecuteNotConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot execute operation on "'+n+'" connection because connection is not yet established.',r}return(0,r.ZT)(t,e),t}(Error),c=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotConnectAlreadyConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a "'+n+'" connection because connection to the database already established.',r}return(0,r.ZT)(t,e),t}(Error),l=function(e){function t(n){var r,i=e.call(this)||this;return i.name="EntityMetadataNotFound",Object.setPrototypeOf(i,t.prototype),r=n instanceof yt.I?n.options.name:"function"==typeof n||"object"==typeof n&&"name"in n?n.name:n,i.message='No metadata for "'+r+'" was found.',i}return(0,r.ZT)(t,e),t}(Error),h=function(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r},p=n(5585),f=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]},d=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.transaction="all";var n=this.connection.driver.options;this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n.schema,n.database)}return e.prototype.executeMigration=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t=this;return(0,r.Jh)(this,(function(n){return[2,this.withQueryRunner((function(n){return(0,r.mG)(t,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.createMigrationsTableIfNotExist(n)];case 1:return t.sent(),[4,e.instance.up(n)];case 2:return t.sent(),[4,this.insertExecutedMigration(n,e)];case 3:return t.sent(),[2,e]}}))}))}))]}))}))},e.prototype.getAllMigrations=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve(this.getMigrations())]}))}))},e.prototype.getExecutedMigrations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,this.withQueryRunner((function(t){return(0,r.mG)(e,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:return[2,e.sent()]}}))}))}))]}))}))},e.prototype.getPendingMigrations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.getAllMigrations()];case 1:return e=n.sent(),[4,this.getExecutedMigrations()];case 2:return t=n.sent(),[2,e.filter((function(e){return!t.find((function(t){return t.name===e.name}))}))]}}))}))},e.prototype.insertMigration=function(e){var t=this;return new Promise((function(n,r){t.withQueryRunner((function(i){t.insertExecutedMigration(i,e).then(n).catch(r)}))}))},e.prototype.deleteMigration=function(e){var t=this;return new Promise((function(n,r){t.withQueryRunner((function(i){t.deleteExecutedMigration(i,e).then(n).catch(r)}))}))},e.prototype.showMigrations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h;return(0,r.Jh)(this,(function(p){switch(p.label){case 0:return e=!1,t=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(t)];case 1:return p.sent(),[4,this.loadExecutedMigrations(t)];case 2:n=p.sent(),i=this.getMigrations(),a=function(t){n.find((function(e){return e.name===t.name}))?o.connection.logger.logSchemaBuild(" [X] "+t.name):(e=!0,o.connection.logger.logSchemaBuild(" [ ] "+t.name))},o=this;try{for(s=(0,r.XA)(i),u=s.next();!u.done;u=s.next())c=u.value,a(c)}catch(e){l={error:e}}finally{try{u&&!u.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}}return this.queryRunner?[3,4]:[4,t.release()];case 3:p.sent(),p.label=4;case 4:return[2,e]}}))}))},e.prototype.executePendingMigrations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h,p,f,d,m,y,v=this;return(0,r.Jh)(this,(function(g){switch(g.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return g.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=g.sent(),n=this.getLatestTimestampMigration(t),i=this.getMigrations(),a=[],(o=i.filter((function(e){return!t.find((function(t){return t.name===e.name}))}))).length?[3,5]:(this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner?[3,4]:[4,e.release()]);case 3:g.sent(),g.label=4;case 4:return[2,[]];case 5:return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(i.length+" migrations were found in the source code."),n&&this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(o.length+" migrations are new migrations that needs to be executed."),s=!1,"all"!==this.transaction||e.isTransactionActive?[3,7]:[4,e.startTransaction()];case 6:g.sent(),s=!0,g.label=7;case 7:g.trys.push([7,18,23,26]),u=function(t){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return"each"!==c.transaction||e.isTransactionActive?[3,2]:[4,e.startTransaction()];case 1:n.sent(),s=!0,n.label=2;case 2:return[4,t.instance.up(e).then((function(){return(0,r.mG)(v,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.insertExecutedMigration(e,t)];case 1:return n.sent(),"each"===this.transaction&&s?[4,e.commitTransaction()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))})).then((function(){a.push(t),v.connection.logger.logSchemaBuild("Migration "+t.name+" has been executed successfully.")}))];case 3:return n.sent(),[2]}}))},c=this,g.label=8;case 8:g.trys.push([8,13,14,15]),l=(0,r.XA)(o),h=l.next(),g.label=9;case 9:return h.done?[3,12]:(p=h.value,[5,u(p)]);case 10:g.sent(),g.label=11;case 11:return h=l.next(),[3,9];case 12:return[3,15];case 13:return f=g.sent(),m={error:f},[3,15];case 14:try{h&&!h.done&&(y=l.return)&&y.call(l)}finally{if(m)throw m.error}return[7];case 15:return"all"===this.transaction&&s?[4,e.commitTransaction()]:[3,17];case 16:g.sent(),g.label=17;case 17:return[3,26];case 18:if(d=g.sent(),!s)return[3,22];g.label=19;case 19:return g.trys.push([19,21,,22]),[4,e.rollbackTransaction()];case 20:case 21:return g.sent(),[3,22];case 22:throw d;case 23:return this.queryRunner?[3,25]:[4,e.release()];case 24:g.sent(),g.label=25;case 25:return[7];case 26:return[2,a]}}))}))},e.prototype.undoLastMigration=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return r.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=r.sent(),!(n=this.getLatestExecutedMigration(t)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(a=i.find((function(e){return e.name===n.name}))))throw new Error("No migration "+n.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),o=!1,"none"===this.transaction||e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:r.sent(),o=!0,r.label=4;case 4:return r.trys.push([4,9,14,17]),[4,a.instance.down(e)];case 5:return r.sent(),[4,this.deleteExecutedMigration(e,a)];case 6:return r.sent(),this.connection.logger.logSchemaBuild("Migration "+a.name+" has been reverted successfully."),o?[4,e.commitTransaction()]:[3,8];case 7:r.sent(),r.label=8;case 8:return[3,17];case 9:if(s=r.sent(),!o)return[3,13];r.label=10;case 10:return r.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:case 12:return r.sent(),[3,13];case 13:throw s;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:r.sent(),r.label=16;case 16:return[7];case 17:return[2]}}))}))},e.prototype.createMigrationsTableIfNotExist=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof p.Qd?[2]:[4,e.hasTable(this.migrationsTable)];case 1:return t.sent()?[3,3]:[4,e.createTable(new o.i({name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.loadExecutedMigrations=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof p.Qd?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,t.sent().map((function(e){return new h(parseInt(e.id),parseInt(e.timestamp),e.name)}))]}}))}))},e.prototype.getMigrations=function(){var e=this.connection.migrations.map((function(e){var t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw new Error(t+" migration name is wrong. Migration class name should have a JavaScript timestamp appended.");return new h(void 0,n,t,e)}));return this.checkForDuplicateMigrations(e),e.sort((function(e,t){return e.timestamp-t.timestamp}))},e.prototype.checkForDuplicateMigrations=function(e){var t=e.map((function(e){return e.name})),n=Array.from(new Set(t.filter((function(e,n){return t.indexOf(e)<n}))));if(n.length>0)throw Error("Duplicate migrations: "+n.join(", "))},e.prototype.getLatestTimestampMigration=function(e){var t=e.map((function(e){return e})).sort((function(e,t){return-1*(e.timestamp-t.timestamp)}));return t.length>0?t[0]:void 0},e.prototype.getLatestExecutedMigration=function(e){return e.length>0?e[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof p.Z0?(n.timestamp=new f(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new f(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof p.Qd?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insert(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.deleteExecutedMigration=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof p.Z0?(n.timestamp=new f(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new f(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof p.Qd?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,(i=e.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(i.escape("timestamp")+" = :timestamp").andWhere(i.escape("name")+" = :name").setParameters(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.withQueryRunner=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:t=this.queryRunner||this.connection.createQueryRunner(),n.label=1;case 1:return n.trys.push([1,,2,5]),[2,e(t)];case 2:return this.queryRunner?[3,4]:[4,t.release()];case 3:n.sent(),n.label=4;case 4:return[7];case 5:return[2]}}))}))},e}(),m=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingPrimaryColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',r}return(0,r.ZT)(t,e),t}(Error),y=function(e){function t(n){var r=e.call(this)||this;return r.name="CircularRelationsError",Object.setPrototypeOf(r,t.prototype),r.message="Circular relations detected: "+n+". To resolve this issue you need to set nullable: true somewhere in this dependency structure.",r}return(0,r.ZT)(t,e),t}(Error);function v(e,t,n){var r=[],i={};return function a(o){i[o]=!0,r.push(o),e[o].forEach((function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error("Dependency Cycle Found: "+r.join(" -> "))}else a(e)})),r.pop(),t&&0!==e[o].length||-1!==n.indexOf(o)||n.push(o)}}var g=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(this.nodes[e]=2===arguments.length?t:e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach((function(t){Object.keys(t).forEach((function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)}),this)})))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];v(this.outgoingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];v(this.incomingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=v(this.outgoingEdges,!1,[]);r.forEach((function(e){i(e)}));var a=v(this.outgoingEdges,e,n);return r.filter((function(e){return 0===t.incomingEdges[e].length})).forEach((function(e){a(e)})),n},e}(),b=function(e){function t(n,r,i){var a=e.call(this)||this;a.name="DataTypeNotSupportedError",Object.setPrototypeOf(a,t.prototype);var o="string"==typeof r?r:r.name;return a.message='Data type "'+o+'" in "'+n.entityMetadata.targetName+"."+n.propertyName+'" is not supported by "'+i+'" database.',a}return(0,r.ZT)(t,e),t}(Error),E=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Option "'+n+'" is not set in your connection options, please define "'+n+'" option in your connection options or ormconfig.json',r}return(0,r.ZT)(t,e),t}(Error),w=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "'+n.entityMetadata.targetName+"#"+n.propertyPath+'". This is ORM requirement to make relations to work properly. Refer docs for more information.',r}return(0,r.ZT)(t,e),t}(Error),T=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach((function(r){return n.validate(r,e,t)})),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new m(e);if("STI"===e.inheritancePattern||"entity-child"===e.tableType){if(!e.discriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?");if(void 0===e.discriminatorValue)throw new Error("Entity "+e.name+" has an undefined discriminator value. Discriminator value should be defined.");var r=t.find((function(t){return t!==e&&("STI"===t.inheritancePattern||"entity-child"===t.tableType)&&t.discriminatorValue===e.discriminatorValue&&t.inheritanceTree.some((function(t){return-1!==e.inheritanceTree.indexOf(t)}))}));if(r)throw new Error("Entities "+e.name+" and "+r.name+" have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.")}if(e.relationCounts.forEach((function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")})),n instanceof p.Qd||e.columns.forEach((function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new b(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new Error("Column "+t.propertyName+" of Entity "+e.name+" does not support length property.")})),(n instanceof p.p$||n instanceof p.xI)&&e.columns.filter((function(e){return e.isGenerated&&"uuid"!==e.generationStrategy})).length>1)throw new Error("Error in "+e.name+" entity. There can be only one auto-increment column in MySql table.");if(n instanceof p.p$&&0===t.filter((function(e){return e.database})).length&&!n.database)throw new E("database");if(n instanceof p.Z0&&e.columns.filter((function(e){return e.charset})).length>1)throw new Error("Character set specifying is not supported in Sql Server");var i=e.create();e.relations.forEach((function(e){if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;var t=e.getEntityValue(i);if(Array.isArray(t))throw new w(e)}})),e.relations.forEach((function(e){})),e.relations.forEach((function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")})),e.eagerRelations.forEach((function(e){}))},e.prototype.validateDependencies=function(e){var t=new g;e.forEach((function(e){t.addNode(e.name)})),e.forEach((function(e){e.relationsWithJoinColumns.filter((function(e){return!e.isNullable})).forEach((function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)}))}));try{t.overallOrder()}catch(e){throw new y(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach((function(e){e.eagerRelations.forEach((function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new Error("Circular eager relations are disallowed. "+e.targetName+"#"+t.propertyPath+' contains "eager: true", and its inverse side '+t.inverseEntityMetadata.targetName+"#"+t.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')}))}))},e}(),C=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerProviderAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",n}return(0,r.ZT)(t,e),t}(Error),N=n(597),M=function(e){function t(){var n=e.call(this)||this;return n.name="NoNeedToReleaseEntityManagerError",Object.setPrototypeOf(n,t.prototype),n.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",n}return(0,r.ZT)(t,e),t}(Error),A=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.manager).merge.apply(t,(0,r.fl)([this.metadata.target,e],n))},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.softRemove=function(e,t){return this.manager.softRemove(this.metadata.target,e,t)},e.prototype.recover=function(e,t){return this.manager.recover(this.metadata.target,e,t)},e.prototype.insert=function(e){return this.manager.insert(this.metadata.target,e)},e.prototype.update=function(e,t){return this.manager.update(this.metadata.target,e,t)},e.prototype.delete=function(e){return this.manager.delete(this.metadata.target,e)},e.prototype.softDelete=function(e){return this.manager.softDelete(this.metadata.target,e)},e.prototype.restore=function(e){return this.manager.restore(this.metadata.target,e)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e.prototype.increment=function(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)},e.prototype.decrement=function(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)},e}(),R=n(3781),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.findTrees=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t=this;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map((function(e){return t.findDescendantsTree(e)})))];case 2:return n.sent(),[2,e]}}))}))},t.prototype.findRoots=function(){var e,t=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,this.metadata.primaryColumns[0].propertyName);return this.createQueryBuilder("treeEntity").where(("treeEntity",this.manager.connection.driver.escape("treeEntity")+"."+(e=t,this.manager.connection.driver.escape(e)+" IS NULL"))).getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then((function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e}))},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)};if("closure-table"===this.metadata.treeType){var a=this.metadata.closureJunctionTable.descendantColumns.map((function(n){return i(t)+"."+i(n.propertyPath)+" = "+i(e)+"."+i(n.referencedColumn.propertyPath)})).join(" AND "),o={},s=this.metadata.closureJunctionTable.ancestorColumns.map((function(e){return o[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+"."+i(e.propertyPath)+" = :"+e.referencedColumn.propertyName})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(s).setParameters(o)}if("nested-set"===this.metadata.treeType){s=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath;var u={};return a=this.metadata.treeParentRelation.joinColumns.map((function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return u[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND "),this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",s).where(a,u)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof R.w?e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE "+i.getQuery()+" || '%'":e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE CONCAT("+i.getQuery()+", '%')"}));throw new Error("Supported only in tree entities")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then((function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildParentEntityTree(e,n.entities,r),e}))},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this;if("closure-table"===this.metadata.treeType){var i=this.metadata.closureJunctionTable.ancestorColumns.map((function(n){return t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath})).join(" AND "),a={},o=this.metadata.closureJunctionTable.descendantColumns.map((function(e){return a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(o).setParameters(a)}if("nested-set"===this.metadata.treeType){i="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath;var s={};return o=this.metadata.treeParentRelation.joinColumns.map((function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return s[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND "),this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",i).where(o,s)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof R.w?i.getQuery()+" LIKE "+e+"."+r.metadata.materializedPathColumn.propertyPath+" || '%'":i.getQuery()+" LIKE CONCAT("+e+"."+r.metadata.materializedPathColumn.propertyPath+", '%')"}));throw new Error("Supported only in tree entities")},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map((function(t){var r=n.metadata.treeParentRelation.joinColumns[0],i=r.givenDatabaseName||r.databaseName,a=t[e+"_"+n.metadata.primaryColumns[0].databaseName],o=t[e+"_"+i];return{id:n.manager.connection.driver.prepareHydratedValue(a,n.metadata.primaryColumns[0]),parentId:n.manager.connection.driver.prepareHydratedValue(o,r)}}))},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.filter((function(e){return e.parentId===a})),s=new Set(o.map((function(e){return e.id})));e[i]=t.filter((function(e){return s.has(e[r.metadata.primaryColumns[0].propertyName])})),e[i].forEach((function(e){r.buildChildrenEntityTree(e,t,n)}))},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.find((function(e){return e.id===a})),s=t.find((function(e){return!!o&&e[r.metadata.primaryColumns[0].propertyName]===o.parentId}));s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(A),O=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),1===n.length?r.message='Relation "'+n[0]+'" was not found; please check if it is correct and really exists in your entity.':r.message="Relations "+n.map((function(e){return'"'+e+'"'})).join(", ")+" were not found; please check if relations are correct and they exist in your entities.",r}return(0,r.ZT)(t,e),t}(Error),S=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(Array.isArray(t.select)||t.where instanceof Object||"string"==typeof t.where||Array.isArray(t.relations)||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||"boolean"==typeof t.cache||"number"==typeof t.cache||t.lock instanceof Object||t.loadRelationIds instanceof Object||"boolean"==typeof t.loadRelationIds||"boolean"==typeof t.loadEagerRelations||"boolean"==typeof t.withDeleted||"boolean"==typeof t.transaction)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take||"string"==typeof t.skip||"string"==typeof t.take)},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(!0===t.transaction&&(e.expressionMap.useTransaction=!0),!e.expressionMap.mainAlias||!e.expressionMap.mainAlias.hasMetadata)return e;var n=e.expressionMap.mainAlias.metadata;if(t.select&&(e.select([]),t.select.forEach((function(t){if(!n.findColumnWithPropertyPath(String(t)))throw new Error(t+" column was not found in the "+n.name+" entity.");e.addSelect(e.alias+"."+t)}))),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach((function(r){var i=t.order[r];if(!n.findColumnWithPropertyPath(r))throw new Error(r+" column was not found in the "+n.name+" entity.");switch(i){case 1:e.addOrderBy(e.alias+"."+r,"ASC");break;case-1:e.addOrderBy(e.alias+"."+r,"DESC");break;case"ASC":e.addOrderBy(e.alias+"."+r,"ASC");break;case"DESC":e.addOrderBy(e.alias+"."+r,"DESC")}})),t.relations){var r=t.relations.map((function(e){return e}));if(this.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new O(r)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach((function(n){e.leftJoin(t.join.leftJoin[n],n)})),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach((function(n){e.innerJoin(t.join.innerJoin[n],n)})),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach((function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)})),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach((function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)}))),t.cache)if(t.cache instanceof Object){var i=t.cache;e.cache(i.id,i.milliseconds)}else e.cache(t.cache);return t.lock&&("optimistic"===t.lock.mode?e.setLock(t.lock.mode,t.lock.version):"pessimistic_read"!==t.lock.mode&&"pessimistic_write"!==t.lock.mode&&"dirty_read"!==t.lock.mode&&"pessimistic_partial_write"!==t.lock.mode&&"pessimistic_write_or_fail"!==t.lock.mode||e.setLock(t.lock.mode)),t.withDeleted&&e.withDeleted(),!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),e},e.applyRelationsRecursively=function(e,t,n,r,i){var o=this,s=[];if(i){var u=new RegExp("^"+i.replace(".","\\.")+"\\.");s=t.filter((function(e){return e.match(u)})).map((function(e){return e.replace(u,"")})).filter((function(e){return r.findRelationWithPropertyPath(e)}))}else s=t.filter((function(e){return r.findRelationWithPropertyPath(e)}));s.forEach((function(s){var u=n+"__"+s;e.connection.driver.maxAliasLength&&u.length>e.connection.driver.maxAliasLength&&(u=(0,a.OV)(u));var c=n+"."+s;e.leftJoinAndSelect(c,u);var l=r.relations.find((function(e){return e.propertyName===s}));l&&o.joinEagerRelations(e,u,l.inverseEntityMetadata),t.splice(t.indexOf(i?i+"."+s:s),1);var h=e.expressionMap.joinAttributes.find((function(e){return e.entityOrProperty===c}));o.applyRelationsRecursively(e,t,h.alias.name,h.metadata,i?i+"."+s:s)}))},e.joinEagerRelations=function(e,t,n){var r=this;n.eagerRelations.forEach((function(n){var i=e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath);e.leftJoinAndSelect(t+"."+n.propertyPath,i),r.joinEagerRelations(e,i,n.inverseEntityMetadata)}))},e}(),P=function(){function e(){}return e.prototype.transform=function(e,t,n,r){return void 0===r&&(r=!1),this.groupAndTransform(e,t,n,r),e},e.prototype.groupAndTransform=function(e,t,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach((function(n){var r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)})),n.relations.length&&n.relations.forEach((function(n){var a=n.getEntityValue(e),o=n.getEntityValue(t,r);if(void 0!==o)if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(o))return;a||(a=[],n.setEntityValue(e,a)),o.forEach((function(e){var t=a.find((function(t){return n.inverseEntityMetadata.compareEntities(e,t)}));t||(t=n.inverseEntityMetadata.create(),a.push(t)),i.groupAndTransform(t,e,n.inverseEntityMetadata,r)}))}else{if(!(o instanceof Object))return void(a instanceof Object||n.setEntityValue(e,o));a||(a=n.inverseEntityMetadata.create(),n.setEntityValue(e,a)),i.groupAndTransform(a,o,n.inverseEntityMetadata,r)}}))},e}(),I=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e}(),_=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find((function(e){return!e.relation&&!e.parentLoadMapItem}))},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find((function(t){return t.target===e.target&&t.id===e.id}))||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach((function(t){var r=n.loadMapItems.find((function(n){return n.target===e&&n.metadata.compareEntities(t,n.plainEntity)}));r&&(r.entity=t)}))},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach((function(t){var n=e.find((function(e){return e.target===t.target}));n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)})),e},e}(),j=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a=this;return(0,r.Jh)(this,(function(o){switch(o.label){case 0:return t.hasAllPrimaryKeys(e)?(n=new _,(i=function(e,a,o,s){var u=new I(e,a,o,s);n.addLoadMap(u),a.extractRelationValuesFromEntity(e,t.relations).filter((function(e){return null!=e})).forEach((function(e){var t=(0,r.CR)(e,3),n=t[0],a=t[1],o=t[2];return i(a,o,u,n)}))})(e,t),[4,Promise.all(n.groupByTargetIds().map((function(e){return a.manager.findByIds(e.target,e.ids).then((function(t){return n.fillEntities(e.target,t)}))})))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return o.sent(),n.loadMapItems.forEach((function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)})),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}}))}))},e}(),q=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",r}return(0,r.ZT)(t,e),t}(Error),D=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryDoesNotHaveEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ",r}return(0,r.ZT)(t,e),t}(Error),L=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new D(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new D(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new D(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=zt().entityRepositories.find((function(t){return t.target===(e instanceof Function?e:e.constructor)}));if(!t)throw new q(e);return t.entity},e}(),B=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryCannotInheritRepositoryError",Object.setPrototypeOf(r,t.prototype),r.message="Custom entity repository "+(n instanceof Function?n.name:n.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.",r}return(0,r.ZT)(t,e),t}(Error),U=function(e){function t(n,r){var i,a=e.call(this)||this;return a.name="RepositoryNotFoundError",Object.setPrototypeOf(a,t.prototype),i=r instanceof yt.I?r.options.name:"function"==typeof r||"object"==typeof r&&"name"in r?r.name:r,a.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+n+'" connection?',a}return(0,r.ZT)(t,e),t}(Error),F=function(e){function t(n){var r,i=e.call(this)||this;return i.name="RepositoryNotTreeError",Object.setPrototypeOf(i,t.prototype),r=n instanceof yt.I?n.options.name:"function"==typeof n||"object"==typeof n&&"name"in n?n.name:n,i.message='Repository of the "'+r+'" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',i}return(0,r.ZT)(t,e),t}(Error),J=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.treeType){var r=new x;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}return r=void 0,r=e.connection.driver instanceof p.Qd?new p.yX:new A,Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r},e}(),k=function(e){function t(n){var r=e.call(this)||this;return r.name="TreeRepositoryNotSupportedError",Object.setPrototypeOf(r,t.prototype),r.message="Tree repositories are not supported in "+n.options.type+" driver.",r}return(0,r.ZT)(t,e),t}(Error),G=function(e){function t(n,r){var i=e.call(this)||this;return i.name="MustBeEntityError",Object.setPrototypeOf(i,t.prototype),i.message="Cannot "+n+', given value must be an entity, instead "'+r+'" is given.',i}return(0,r.ZT)(t,e),t}(Error),Q=function(){function e(e){this.subjects=(0,r.fl)(e),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var n=[];if("delete"===e){var i=this.subjects.filter((function(e){return!e.entity&&!e.databaseEntity}));n.push.apply(n,(0,r.fl)(i)),this.removeAlreadySorted(i)}var a=this.getNonNullableDependencies(),o=this.toposort(a);"insert"===e&&(o=o.reverse()),o.forEach((function(e){var i=t.subjects.filter((function(t){return t.metadata.targetName===e}));n.push.apply(n,(0,r.fl)(i)),t.removeAlreadySorted(i)}));var s=this.getDependencies(),u=this.toposort(s);return"insert"===e&&(u=u.reverse()),u.forEach((function(e){var i=t.subjects.filter((function(t){return t.metadata.targetName===e}));n.push.apply(n,(0,r.fl)(i)),t.removeAlreadySorted(i)})),n.push.apply(n,(0,r.fl)(this.subjects)),n},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach((function(e){t.subjects.splice(t.subjects.indexOf(e),1)}))},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach((function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)})),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce((function(e,t){return t.relationsWithJoinColumns.forEach((function(n){n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e}),[])},e.prototype.getDependencies=function(){return this.metadatas.reduce((function(e,t){return t.relationsWithJoinColumns.forEach((function(n){n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e}),[])},e.prototype.toposort=function(e){for(var t=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.indexOf(i[0])<0&&t.push(i[0]),t.indexOf(i[1])<0&&t.push(i[1])}return t}(e),n=t.length,r=new Array(n),i={},a=n;a--;)i[a]||o(t[a],a,[]);function o(a,s,u){if(u.indexOf(a)>=0)throw new Error("Cyclic dependency: "+JSON.stringify(a));if(!~t.indexOf(a))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(!i[s]){i[s]=!0;var c=e.filter((function(e){return e[0]===a}));if(s=c.length){var l=u.concat(a);do{var h=c[--s][1];o(h,t.indexOf(h),l)}while(s)}r[--n]=a}}return r},e}(),V=n(7155),W=n(8731),z=n(7718),K=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach((function(n){t.computeDiffColumns(n),t.computeDiffRelationalColumns(e,n)}))},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach((function(t){if(!t.isVirtual&&!t.isDiscriminator){var n=e.changeMaps.find((function(e){return e.column===t}));n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);var r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i=t.getEntityValue(e.databaseEntity,!0);if(t.relationMetadata)if(null!=t.relationMetadata.getEntityValue(e.entity))return;var a=r;if(null!==r){switch(t.type){case"date":a=V.E.mixedDateToDateString(r);break;case"time":case"time with time zone":case"time without time zone":case"timetz":a=V.E.mixedDateToTimeString(r);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":a=V.E.mixedDateToUtcDatetimeString(r),i=V.E.mixedDateToUtcDatetimeString(i);break;case"json":case"jsonb":if(W.s.deepCompare(r,i))return;break;case"simple-array":a=V.E.simpleArrayToString(r),i=V.E.simpleArrayToString(i);break;case"simple-enum":a=V.E.simpleEnumToString(r),i=V.E.simpleEnumToString(i);break;case"simple-json":a=V.E.simpleJsonToString(r),i=V.E.simpleJsonToString(i)}t.transformer&&(a=z.A.transformTo(t.transformer,r))}if(a===i)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}}))},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach((function(n){var r=n.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var a=n.getEntityValue(t.databaseEntity);if(W.s.compareIds(i,a))return;t.diffRelations.push(n)}var o=e.find((function(e){return e.mustBeInserted&&e.entity===r}));o&&(r=o);var s=t.changeMaps.find((function(e){return e.relation===n}));s?s.value=r:t.changeMaps.push({relation:n,value:r})}}))},e}(),Z=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectWithoutIdentifierError",Object.setPrototypeOf(r,t.prototype),r.message="Internal error. Subject "+n.metadata.targetName+" must have an identifier to perform operation. Please report a github issue if you face this error.",r}return(0,r.ZT)(t,e),t}(Error),H=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectRemovedAndUpdatedError",Object.setPrototypeOf(r,t.prototype),r.message='Removed entity "'+n.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).',r}return(0,r.ZT)(t,e),t}(Error),X=n(3730),Y=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t=function(e){return c.queryRunner.connection.driver.escape(e)},n=this.getTableName(e.metadata.tablePath),i=t(e.metadata.nestedSetLeftColumn.databaseName),a=t(e.metadata.nestedSetRightColumn.databaseName),!(o=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(o=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),s=e.metadata.getEntityIdMap(o),u=void 0,s?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(s).getRawOne().then((function(e){var t=e?e.right:void 0;return"string"==typeof t?parseInt(t):t}))]:[3,2];case 1:u=r.sent(),r.label=2;case 2:return void 0===u?[3,4]:[4,this.queryRunner.query("UPDATE "+n+" SET "+i+" = CASE WHEN "+i+" > "+u+" THEN "+i+" + 2 ELSE "+i+" END,"+a+" = "+a+" + 2 WHERE "+a+" >= "+u)];case 3:return r.sent(),W.s.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(u),e.metadata.nestedSetRightColumn.createValueMap(u+1)),[3,5];case 4:W.s.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2)),r.label=5;case 5:return[2]}}))}))},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)})).join(".")},e}(),$=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotAttachTreeChildrenEntityError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot attach entity "'+n+'" to its parent. Please make sure parent is saved in the database before saving children nodes.',r}return(0,r.ZT)(t,e),t}(Error),ee=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p=this;return(0,r.Jh)(this,(function(f){switch(f.label){case 0:return t={},e.metadata.closureJunctionTable.ancestorColumns.forEach((function(n){t[n.databaseName]=e.identifier})),e.metadata.closureJunctionTable.descendantColumns.forEach((function(n){t[n.databaseName]=e.identifier})),[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute()];case 1:return f.sent(),!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n?(i=function(e){return p.queryRunner.connection.driver.escape(e)},a=this.getTableName(e.metadata.closureJunctionTable.tablePath),o=e.metadata.closureJunctionTable.ancestorColumns.map((function(e){return i(e.databaseName)})),s=e.metadata.closureJunctionTable.descendantColumns.map((function(e){return i(e.databaseName)})),u=[],c=e.metadata.primaryColumns.map((function(t){return t.getEntityValue(e.insertedValueSet)})),l=e.metadata.primaryColumns.map((function(e,t){return u.push(c[t]),p.queryRunner.connection.driver.createParameter("child_entity_"+e.databaseName,u.length-1)})),h=e.metadata.closureJunctionTable.descendantColumns.map((function(t){var r=i(t.databaseName),a=t.referencedColumn.getEntityValue(n);if(!a)throw new $(e.metadata.name);return u.push(a),r+" = "+p.queryRunner.connection.driver.createParameter("parent_entity_"+t.referencedColumn.databaseName,u.length-1)})).join(", "),[4,this.queryRunner.query("INSERT INTO "+a+" ("+(0,r.fl)(o,s).join(", ")+") SELECT "+o.join(", ")+", "+l.join(", ")+" FROM "+a+" WHERE "+h,u)]):[3,3];case 2:f.sent(),f.label=3;case 3:return[2]}}))}))},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)})).join(".")},e}(),te=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return!(t=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n=e.metadata.getEntityIdMap(t),i="",n?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(n).getRawOne().then((function(e){return e?e.path:void 0}))]:[3,2];case 1:i=r.sent(),r.label=2;case 2:return a=e.metadata.treeParentRelation.joinColumns.map((function(t){return t.referencedColumn.getEntityValue(e.insertedValueSet)})).join("_"),[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set((o={},o[e.metadata.materializedPathColumn.propertyPath]=i+a+".",o)).where(e.identifier).execute()];case 3:return r.sent(),[2]}}))}))},e}(),ne=function(){function e(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}return e.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return e=void 0,this.options&&!1===this.options.listeners?[3,2]:(e=this.broadcastBeforeEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e&&e.count>0&&(this.insertSubjects.forEach((function(e){return e.recompute()})),this.updateSubjects.forEach((function(e){return e.recompute()})),this.removeSubjects.forEach((function(e){return e.recompute()})),this.softRemoveSubjects.forEach((function(e){return e.recompute()})),this.recoverSubjects.forEach((function(e){return e.recompute()})),this.recompute()),this.insertSubjects=new Q(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter((function(e){return e.mustBeUpdated})),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new Q(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return t.sent(),this.softRemoveSubjects=this.allSubjects.filter((function(e){return e.mustBeSoftRemoved})),[4,this.executeSoftRemoveOperations()];case 6:return t.sent(),this.recoverSubjects=this.allSubjects.filter((function(e){return e.mustBeRecovered})),[4,this.executeRecoverOperations()];case 7:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 8:return t.sent(),this.options&&!1===this.options.listeners?[3,10]:(e=this.broadcastAfterEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[2]}}))}))},e.prototype.validate=function(){this.allSubjects.forEach((function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new H(e)}))},e.prototype.recompute=function(){(new K).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter((function(e){return e.mustBeInserted})),this.updateSubjects=this.allSubjects.filter((function(e){return e.mustBeUpdated})),this.removeSubjects=this.allSubjects.filter((function(e){return e.mustBeRemoved})),this.softRemoveSubjects=this.allSubjects.filter((function(e){return e.mustBeSoftRemoved})),this.recoverSubjects=this.allSubjects.filter((function(e){return e.mustBeRecovered})),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new X.D;return this.insertSubjects.length&&this.insertSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,n.metadata,n.entity)})),this.updateSubjects.length&&this.updateSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.removeSubjects.length&&this.removeSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)})),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.recoverSubjects.length&&this.recoverSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new X.D;return this.insertSubjects.length&&this.insertSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,n.metadata,n.entity)})),this.updateSubjects.length&&this.updateSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.removeSubjects.length&&this.removeSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)})),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.recoverSubjects.length&&this.recoverSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),t},e.prototype.executeInsertOperations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h,f=this;return(0,r.Jh)(this,(function(d){switch(d.label){case 0:e=(0,r.CR)(this.groupBulkSubjects(this.insertSubjects,"insert"),2),t=e[0],n=e[1],i=function(e){var n,i,o,s,u,c,l,h,d,m,y,v,g;return(0,r.Jh)(this,(function(b){switch(b.label){case 0:return n=t[e],i=[],o=[],s=[],a.queryRunner.connection.driver instanceof p.Qd?n.forEach((function(e){e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),o.push(e),i.push(e.entity)})):a.queryRunner.connection.driver instanceof p.XR?n.forEach((function(e){s.push(e)})):n.forEach((function(e){0===e.changeMaps.length||e.metadata.treeType||f.queryRunner.connection.driver instanceof p.XR||f.queryRunner.connection.driver instanceof p.tU?s.push(e):(o.push(e),i.push(e.createValueSetAndPopChangeMap()))})),a.queryRunner instanceof p.En?[4,a.queryRunner.manager.insert(n[0].metadata.target,i)]:[3,2];case 1:return u=b.sent(),n.forEach((function(e,t){e.identifier=u.identifiers[t],e.generatedMap=u.generatedMaps[t],e.insertedValueSet=i[t]})),[3,12];case 2:return i.length>0?[4,a.queryRunner.manager.createQueryBuilder().insert().into(n[0].metadata.target).values(i).updateEntity(!a.options||!1!==a.options.reload).callListeners(!1).execute()]:[3,4];case 3:c=b.sent(),o.forEach((function(e,t){e.identifier=c.identifiers[t],e.generatedMap=c.generatedMaps[t],e.insertedValueSet=i[t]})),b.label=4;case 4:if(!(s.length>0))return[3,12];l=function(e){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"!==e.metadata.treeType?[3,2]:[4,new Y(a.queryRunner).insert(e)];case 1:t.sent(),t.label=2;case 2:return[4,a.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!a.options||!1!==a.options.reload).callListeners(!1).execute().then((function(t){e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]}))];case 3:return t.sent(),"closure-table"!==e.metadata.treeType?[3,5]:[4,new ee(a.queryRunner).insert(e)];case 4:return t.sent(),[3,7];case 5:return"materialized-path"!==e.metadata.treeType?[3,7]:[4,new te(a.queryRunner).insert(e)];case 6:t.sent(),t.label=7;case 7:return[2]}}))},b.label=5;case 5:b.trys.push([5,10,11,12]),v=void 0,h=(0,r.XA)(s),d=h.next(),b.label=6;case 6:return d.done?[3,9]:(m=d.value,[5,l(m)]);case 7:b.sent(),b.label=8;case 8:return d=h.next(),[3,6];case 9:return[3,12];case 10:return y=b.sent(),v={error:y},[3,12];case 11:try{d&&!d.done&&(g=h.return)&&g.call(h)}finally{if(v)throw v.error}return[7];case 12:return n.forEach((function(e){e.generatedMap&&e.metadata.columns.forEach((function(t){var n=t.getEntityValue(e.generatedMap);if(null!=n){var r=f.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}}))})),[2]}}))},a=this,d.label=1;case 1:d.trys.push([1,6,7,8]),o=(0,r.XA)(n),s=o.next(),d.label=2;case 2:return s.done?[3,5]:(u=s.value,[5,i(u)]);case 3:d.sent(),d.label=4;case 4:return s=o.next(),[3,2];case 5:return[3,8];case 6:return c=d.sent(),l={error:c},[3,8];case 7:try{s&&!s.done&&(h=o.return)&&h.call(o)}finally{if(l)throw l.error}return[7];case 8:return[2]}}))}))},e.prototype.executeUpdateOperations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map((function(t){return(0,r.mG)(e,void 0,void 0,(function(){var e,n,i,a,o=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new Z(t);return this.queryRunner instanceof p.En?(e=W.s.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=t.createValueSetAndPopChangeMap(),i=this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?i.whereEntity(t.identifier):i.where(t.identifier),[4,i.execute()];case 3:a=r.sent(),t.generatedMap=a.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=o.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),r.label=4;case 4:return[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.executeRemoveOperations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h;return(0,r.Jh)(this,(function(f){switch(f.label){case 0:e=(0,r.CR)(this.groupBulkSubjects(this.removeSubjects,"delete"),2),t=e[0],n=e[1],f.label=1;case 1:f.trys.push([1,8,9,10]),i=(0,r.XA)(n),a=i.next(),f.label=2;case 2:return a.done?[3,7]:(o=a.value,s=t[o],u=s.map((function(e){if(!e.identifier)throw new Z(e);return e.identifier})),this.queryRunner instanceof p.En?[4,this.queryRunner.manager.delete(s[0].metadata.target,u)]:[3,4]);case 3:return f.sent(),[3,6];case 4:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(s[0].metadata.target).where(u).callListeners(!1).execute()];case 5:f.sent(),f.label=6;case 6:return a=i.next(),[3,2];case 7:return[3,10];case 8:return c=f.sent(),l={error:c},[3,10];case 9:try{a&&!a.done&&(h=i.return)&&h.call(i)}finally{if(l)throw l.error}return[7];case 10:return[2]}}))}))},e.prototype.executeSoftRemoveOperations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.softRemoveSubjects.map((function(t){return(0,r.mG)(e,void 0,void 0,(function(){var e,n,i,a=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new Z(t);return this.queryRunner instanceof p.En?(e=W.s.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().softDelete().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:i=r.sent(),t.generatedMap=i.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),r.label=4;case 4:return[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.executeRecoverOperations=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.recoverSubjects.map((function(t){return(0,r.mG)(e,void 0,void 0,(function(){var e,n,i,a=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new Z(t);return this.queryRunner instanceof p.En?(e=W.s.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=null),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().restore().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:i=r.sent(),t.generatedMap=i.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),r.label=4;case 4:return[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.updateSpecialColumnsInPersistedEntities=function(){var e=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach((function(e){e.entity&&e.metadata.primaryColumns.forEach((function(t){t.setEntityValue(e.entity,void 0)}))})),this.allSubjects.forEach((function(t){t.entity&&(t.metadata.relationIds.forEach((function(e){e.setValue(t.entity)})),e.queryRunner instanceof p.En&&t.metadata.objectIdColumn&&t.metadata.objectIdColumn.databaseName&&t.metadata.objectIdColumn.databaseName!==t.metadata.objectIdColumn.propertyName&&delete t.entity[t.metadata.objectIdColumn.databaseName])}))},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach((function(e){e.entity&&(e.metadata.columns.forEach((function(t){e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map((function(e){return e.target})).indexOf(t.target)||t.isVirtual||(t.isNullable&&void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null),e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach((function(t){t.relation.joinColumns.forEach((function(n){!0!==n.isVirtual&&n.setEntityValue(e.entity,t.value instanceof Object?n.referencedColumn.getEntityValue(t.value):t.value)}))})))})),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))}))},e.prototype.groupBulkSubjects=function(e,t){var n={},r=[],i="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach((function(e,t){var a=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[a]?n[a].push(e):(n[a]=[e],r.push(a))})),[n,r]},e}(),re=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotDetermineEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Cannot "+n+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.",r}return(0,r.ZT)(t,e),t}(Error),ie=function(){function e(e){var t;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,(0,r.fl)(e.changeMaps)),this.recompute()}return Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeSoftRemoved",{get:function(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeRecovered",{get:function(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],r=this.changeMaps.reduce((function(r,i){var a,o=i.value;if(o instanceof e&&(o=o.insertedValueSet?o.insertedValueSet:o.entity),t.metadata.isJunction&&i.column)a=i.column.createValueMap(i.column.referencedColumn.getEntityValue(o));else if(i.column)a=i.column.createValueMap(o);else if(i.relation)if(o instanceof Object){var s=i.relation.getRelationIdMap(o);if(void 0===s)return n.push(i),t.canBeUpdated=!0,r;a=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s})}else a=i.relation.createValueMap(o),t.updatedRelationMaps.push({relation:i.relation,value:o});return W.s.mergeDeep(r,a),r}),{});return this.changeMaps=n,r},e.prototype.recompute=function(){var e=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach((function(t){if(t.relationMetadata&&t.relationMetadata.inverseEntityMetadata===e.parentSubject.metadata){var n=t.referencedColumn.getEntityValue(e.parentSubject.entity);t.setEntityValue(e.entityWithFulfilledIds,n)}})),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},e}(),ae=n(7837),oe=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.metadata.oneToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0!==i){var a=[];i.forEach((function(i){var o=t.inverseEntityMetadata.getEntityIdMap(i),s=n.subjects.find((function(e){return e.entity===i}));if(s&&(o=s.identifier),o)r.find((function(e){return W.s.compareIds(o,e)}))||(s||(s=new ie({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:o}),n.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),a.push(o);else{if(!s)return;s.changeMaps.push({relation:t.inverseRelation,value:e})}})),ae.T.difference(r,a).forEach((function(r){var i=new ie({metadata:t.inverseEntityMetadata,parentSubject:e,identifier:r});t.inverseRelation&&"nullify"!==t.inverseRelation.orphanedRowAction?"delete"===t.inverseRelation.orphanedRowAction&&(i.mustBeRemoved=!0):(i.canBeUpdated=!0,i.changeMaps=[{relation:t.inverseRelation,value:null}]),n.subjects.push(i)}))}},e}(),se=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.metadata.oneToOneRelations.forEach((function(n){n.isOwning||!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=void 0;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));var r=t.getEntityValue(e.entity);if(void 0!==r)if(null!==r){var i=t.inverseEntityMetadata.getEntityIdMap(r),a=this.subjects.find((function(e){return!!e.entity&&e.entity===r}));if(a&&(i=a.identifier),!i){if(!a)return;a.changeMaps.push({relation:t.inverseRelation,value:e})}n&&W.s.compareIds(i,n)||(a||(a=new ie({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:i}),this.subjects.push(a)),a.changeMaps.push({relation:t.inverseRelation,value:e}))}else if(n){var o=new ie({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(o)}},e}(),ue=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.entity&&t.metadata.manyToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&n.getEntityValue(e.databaseEntity).forEach((function(r){var i=new ie({metadata:n.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,r)});t.subjects.push(i)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),Array.isArray(i)){i.forEach((function(i){var a=t.inverseEntityMetadata.getEntityIdMap(i),o=n.subjects.find((function(e){return e.entity===i}));if(o&&(a=o.identifier),(a||o)&&!r.find((function(e){return W.s.compareIds(e,a)}))){var s=t.isOwning?e:o||i,u=t.isOwning?o||i:e,c=new ie({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});n.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach((function(e){c.changeMaps.push({column:e,value:s})})),t.junctionEntityMetadata.inverseColumns.forEach((function(e){c.changeMaps.push({column:e,value:u})}))}}));var a=[];i.forEach((function(e){var r=t.inverseEntityMetadata.getEntityIdMap(e),i=n.subjects.find((function(t){return t.entity===e}));i&&(r=i.identifier),null!=r&&a.push(r)})),r.filter((function(e){return!a.find((function(t){return W.s.compareIds(t,e)}))})).forEach((function(r){var i=new ie({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,r)});n.subjects.push(i)}))}},e.prototype.buildJunctionIdentifier=function(e,t,n){var r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach((function(e){W.s.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))})),t.junctionEntityMetadata.inverseColumns.forEach((function(e){W.s.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))})),a},e}(),ce=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n=this;return(0,r.Jh)(this,(function(i){switch(i.label){case 0:return t=this.groupByEntityTargets().map((function(t){return(0,r.mG)(n,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h=this;return(0,r.Jh)(this,(function(p){switch(p.label){case 0:return n=[],i=[],t.subjects.forEach((function(e){!e.databaseEntity&&e.identifier&&(n.push(e.identifier),i.push(e))})),n.length?(a=[],"save"===e||"soft-remove"===e||"recover"===e?t.subjects.forEach((function(e){e.metadata.relations.forEach((function(t){void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===a.indexOf(t.propertyPath)&&a.push(t.propertyPath)}))})):a.push.apply(a,(0,r.fl)(t.subjects[0].metadata.manyToManyRelations.map((function(e){return e.propertyPath})))),o={loadEagerRelations:!1,loadRelationIds:{relations:a,disableMixedMap:!0},withDeleted:!0},[4,this.queryRunner.manager.getRepository(t.target).findByIds(n,o)]):[2];case 1:p.sent().forEach((function(e){h.findByPersistEntityLike(t.target,e).forEach((function(t){t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)}))}));try{for(s=(0,r.XA)(i),u=s.next();!u.done;u=s.next())u.value.databaseEntityLoaded=!0}catch(e){c={error:e}}finally{try{u&&!u.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}}return[2]}}))}))})),[4,Promise.all(t)];case 1:return i.sent(),[2]}}))}))},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.filter((function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))}))},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce((function(e,t){var n=e.find((function(e){return e.target===t.metadata.target}));return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e}),[])},e}(),le=function(){function e(e){this.allSubjects=e}return e.prototype.build=function(e,t){var n=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach((function(i){var a=(0,r.CR)(i,3),o=a[0],s=a[1],u=a[2];if(null!=s&&(o.isCascadeInsert||o.isCascadeUpdate||o.isCascadeSoftRemove||o.isCascadeRecover)&&s instanceof Object){var c=n.findByPersistEntityLike(u.target,s);if(c)return!1===c.canBeInserted&&(c.canBeInserted=!0===o.isCascadeInsert&&"save"===t),!1===c.canBeUpdated&&(c.canBeUpdated=!0===o.isCascadeUpdate&&"save"===t),!1===c.canBeSoftRemoved&&(c.canBeSoftRemoved=!0===o.isCascadeSoftRemove&&"soft-remove"===t),void(!1===c.canBeRecovered&&(c.canBeRecovered=!0===o.isCascadeRecover&&"recover"===t));var l=new ie({metadata:u,parentSubject:e,entity:s,canBeInserted:!0===o.isCascadeInsert&&"save"===t,canBeUpdated:!0===o.isCascadeUpdate&&"save"===t,canBeSoftRemoved:!0===o.isCascadeSoftRemove&&"soft-remove"===t,canBeRecovered:!0===o.isCascadeRecover&&"recover"===t});n.allSubjects.push(l),n.build(l,t)}}))},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find((function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))}))},e}(),he=function(){function e(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}return e.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h,p,f=this;return(0,r.Jh)(this,(function(d){switch(d.label){case 0:return this.entity&&"object"==typeof this.entity?[4,Promise.resolve()]:[2,Promise.reject(new G(this.mode,this.entity))];case 1:d.sent(),e=this.queryRunner||this.connection.createQueryRunner(),this.options&&this.options.data&&(e.data=this.options.data),d.label=2;case 2:return d.trys.push([2,,22,25]),t=Array.isArray(this.entity)?this.entity:[this.entity],n=this.options&&this.options.chunk&&this.options.chunk>0?W.s.chunk(t,this.options.chunk):[t],[4,Promise.all(n.map((function(t){return(0,r.mG)(f,void 0,void 0,(function(){var n,i,a=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=[],t.forEach((function(e){var t=a.target?a.target:e.constructor;if(t===Object)throw new re(a.mode);n.push(new ie({metadata:a.connection.getMetadata(t),entity:e,canBeInserted:"save"===a.mode,canBeUpdated:"save"===a.mode,mustBeRemoved:"remove"===a.mode,canBeSoftRemoved:"soft-remove"===a.mode,canBeRecovered:"recover"===a.mode}))})),i=new le(n),n.forEach((function(e){i.build(e,a.mode)})),[4,new ce(e,n).load(this.mode)];case 1:return r.sent(),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new oe(n).build(),new se(n).build(),new ue(n).build()):n.forEach((function(e){e.mustBeRemoved&&new ue(n).buildForAllRemoval(e)})),[2,new ne(e,n,this.options)]}}))}))})))];case 3:if(i=d.sent(),0===(a=i.filter((function(e){return e.hasExecutableOperations}))).length)return[2];o=!1,d.label=4;case 4:return d.trys.push([4,16,,21]),e.isTransactionActive||this.options&&!1===this.options.transaction?[3,6]:(o=!0,[4,e.startTransaction()]);case 5:d.sent(),d.label=6;case 6:d.trys.push([6,11,12,13]),s=(0,r.XA)(a),u=s.next(),d.label=7;case 7:return u.done?[3,10]:[4,u.value.execute()];case 8:d.sent(),d.label=9;case 9:return u=s.next(),[3,7];case 10:return[3,13];case 11:return c=d.sent(),h={error:c},[3,13];case 12:try{u&&!u.done&&(p=s.return)&&p.call(s)}finally{if(h)throw h.error}return[7];case 13:return!0!==o?[3,15]:[4,e.commitTransaction()];case 14:d.sent(),d.label=15;case 15:return[3,21];case 16:if(l=d.sent(),!o)return[3,20];d.label=17;case 17:return d.trys.push([17,19,,20]),[4,e.rollbackTransaction()];case 18:case 19:return d.sent(),[3,20];case 20:throw l;case 21:return[3,25];case 22:return this.queryRunner?[3,24]:[4,e.release()];case 23:d.sent(),d.label=24;case 24:return[7];case 25:return[2]}}))}))},e}(),pe=n(4205),fe=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new P,this.connection=e,t&&(this.queryRunner=t,pe.g.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(n="string"==typeof e?e:void 0,!(i="function"==typeof e?e:t))throw new Error("Transaction method requires callback in second paramter if isolation level is supplied.");if(this.connection.driver instanceof p.Qd)throw new Error("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new C;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error("Cannot start transaction because its already started");a=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,8,13,16]),n?[4,a.startTransaction(n)]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,a.startTransaction()];case 4:r.sent(),r.label=5;case 5:return[4,i(a.manager)];case 6:return o=r.sent(),[4,a.commitTransaction()];case 7:return r.sent(),[2,o];case 8:s=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,a.rollbackTransaction()];case 10:case 11:return r.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,a.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}}))}))},e.prototype.query=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){return[2,this.connection.query(e,t,this.queryRunner)]}))}))},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e,i=this.connection.getMetadata(n);return i.hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e,i=this.connection.getMetadata(n);return i.getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);if(!t)return r.create(this.queryRunner);if(Array.isArray(t))return t.map((function(t){return n.create(e,t)}));var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,r,!0),i},e.prototype.merge=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=this.connection.getMetadata(e);return r.forEach((function(e){return n.plainObjectToEntityTransformer.transform(t,e,a)})),t},e.prototype.preload=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=this.connection.getMetadata(e),[4,new j(this.connection.manager).transform(t,n)];case 1:return(i=r.sent())?[2,this.merge(e,i,t)]:[2,void 0]}}))}))},e.prototype.save=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof yt.I||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof yt.I&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new he(this.connection,this.queryRunner,"save",r,i,a).execute().then((function(){return i}))},e.prototype.remove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new he(this.connection,this.queryRunner,"remove",r,i,a).execute().then((function(){return i}))},e.prototype.softRemove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof yt.I||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof yt.I&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new he(this.connection,this.queryRunner,"soft-remove",r,i,a).execute().then((function(){return i}))},e.prototype.recover=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof yt.I||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof yt.I&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new he(this.connection,this.queryRunner,"recover",r,i,a).execute().then((function(){return i}))},e.prototype.insert=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]}))}))},e.prototype.update=function(e,t,n){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the update method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()},e.prototype.delete=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.softDelete=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()},e.prototype.restore=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()},e.prototype.count=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,S.extractFindManyOptionsAlias(t)||n.name),[2,S.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getCount()]}))}))},e.prototype.find=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,S.extractFindManyOptionsAlias(t)||n.name),S.isFindManyOptions(t)&&!1===t.loadEagerRelations||S.joinEagerRelations(i,i.alias,n),[2,S.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getMany()]}))}))},e.prototype.findAndCount=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,S.extractFindManyOptionsAlias(t)||n.name),S.isFindManyOptions(t)&&!1===t.loadEagerRelations||S.joinEagerRelations(i,i.alias,n),[2,S.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getManyAndCount()]}))}))},e.prototype.findByIds=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a;return(0,r.Jh)(this,(function(r){return t.length?(i=this.connection.getMetadata(e),a=this.createQueryBuilder(e,S.extractFindManyOptionsAlias(n)||i.name),S.applyFindManyOptionsOrConditionsToQueryBuilder(a,n),S.isFindManyOptions(n)&&!1===n.loadEagerRelations||S.joinEagerRelations(a,a.alias,i),[2,a.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]}))}))},e.prototype.findOne=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,o,s,u,c;return(0,r.Jh)(this,(function(l){return i=void 0,S.isFindOneOptions(t)?i=t:n&&S.isFindOneOptions(n)&&(i=n),a=void 0,t instanceof Object&&!S.isFindOneOptions(t)&&(a=t),o=this.connection.getMetadata(e),s=o.name,i&&i.join?s=i.join.alias:n&&S.isFindOneOptions(n)&&n.join&&(s=n.join.alias),u=this.createQueryBuilder(e,s),i&&!1===i.loadEagerRelations||S.joinEagerRelations(u,u.alias,u.expressionMap.mainAlias.metadata),(c="string"==typeof t||"number"==typeof t||t instanceof Date)||(i=(0,r.pi)((0,r.pi)({},i||{}),{take:1})),S.applyOptionsToQueryBuilder(u,i),a?u.where(a):c&&u.andWhereInIds(o.ensureEntityIdMap(t)),[2,u.getOne()]}))}))},e.prototype.findOneOrFail=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(r){return[2,this.findOne(e,t,n).then((function(n){return void 0===n?Promise.reject(new N.E(e,t)):Promise.resolve(n)}))]}))}))},e.prototype.clear=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(t.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.increment=function(e,t,n,i){return(0,r.mG)(this,void 0,void 0,(function(){var a,o,s,u=this;return(0,r.Jh)(this,(function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new Error("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new Error('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight((function(e,t){var n;return(n={})[t]=e,n}),(function(){return u.connection.driver.escape(o.databaseName)+" + "+i})),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]}))}))},e.prototype.decrement=function(e,t,n,i){return(0,r.mG)(this,void 0,void 0,(function(){var a,o,s,u=this;return(0,r.Jh)(this,(function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new Error("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new Error('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight((function(e,t){var n;return(n={})[t]=e,n}),(function(){return u.connection.driver.escape(o.databaseName)+" - "+i})),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]}))}))},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new U(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find((function(e){return e.metadata===t}));if(n)return n;var r=(new J).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new k(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof x))throw new F(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=zt().entityRepositories.find((function(t){return t.target===(e instanceof Function?e:e.constructor)}));if(!t)throw new q(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof L&&(r.manager||(r.manager=this)),r instanceof A){if(!n)throw new B(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){if(!this.queryRunner)throw new M;return[2,this.queryRunner.release()]}))}))},e}(),de=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return(0,r.ZT)(t,e),t.prototype.loadDatabase=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.driver.load(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.saveDatabase=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.exportDatabase=function(){return this.driver.export()},t}(fe),me=n(8529),ye=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof p.Qd?new p.$2(e):e.driver instanceof me.x?new de(e,t):new fe(e,t)},e}(),ve=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDriverError",Object.setPrototypeOf(r,t.prototype),r.message='Wrong driver: "'+n+'" given. Supported drivers are: "cordova", "expo", "mariadb", "mongodb", "mssql", "mysql", "oracle", "postgres", "sqlite", "better-sqlite3", "sqljs", "react-native", "aurora-data-api", "aurora-data-api-pg".',r}return(0,r.ZT)(t,e),t}(Error),ge=n(3653),be=n(3321),Ee=n(5890),we=n(5725),Te=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new we.a(n),n}return(0,r.ZT)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new ge.Y;return new Promise((function(i,a){return(0,r.mG)(n,void 0,void 0,(function(){var n,o,s=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.executeSql(e,t,(function(n){var r=s.driver.connection.options.maxQueryExecutionTime,a=+new Date-o;if(r&&a>r&&s.driver.connection.logger.logQuerySlow(a,e,t,s),"INSERT INTO"===e.substr(0,11))i(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));i(u)}}),(function(n){s.driver.connection.logger.logQueryError(n,e,t,s),a(new be.O(e,t,n))})),[2]}}))}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Ee.J),Ce=n(733),Ne=n(9313),Me=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new Ce.f("database");if(!n.options.location)throw new Ce.f("location");return n.loadDependencies(),n}return(0,r.ZT)(t,e),t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Te(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,(function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],(function(e){t(r)}),(function(e){n(e)}))}),(function(e){n(e)}))}))},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new Ne.z("Cordova-SQLite","cordova-sqlite-storage")}},t}(R.w),Ae=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new we.a(n),n}return(0,r.ZT)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new ge.Y;return new Promise((function(i,a){return(0,r.mG)(n,void 0,void 0,(function(){var n,o,s=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.executeSql(e,t,(function(n){var r=s.driver.connection.options.maxQueryExecutionTime,a=+new Date-o;if(r&&a>r&&s.driver.connection.logger.logQuerySlow(a,e,t,s),"INSERT INTO"===e.substr(0,11))i(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));i(u)}}),(function(n){s.driver.connection.logger.logQueryError(n,e,t,s),a(new be.O(e,t,n))})),[2]}}))}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Ee.J),Re=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new Ce.f("database");if(!n.options.location)throw new Ce.f("location");return n.loadDependencies(),n}return(0,r.ZT)(t,e),t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Ae(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,(function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],(function(e){t(r)}),(function(e){n(e)}))}),(function(e){n(e)}))}))},t.prototype.loadDependencies=function(){try{this.sqlite=n(Object(function(){var e=new Error("Cannot find module 'react-native-sqlite-storage'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){throw new Ne.z("React-Native","react-native-sqlite-storage")}},t}(R.w),xe=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new we.a(n),n}return(0,r.ZT)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new ge.Y;var r=this.driver.connection;return new Promise((function(i,a){var o="INSERT INTO"===e.substr(0,11),s=function(n,o){var s=r.options.maxQueryExecutionTime,c=+new Date-u;s&&c>s&&r.logger.logQuerySlow(c,e,t,this),n?(r.logger.logQueryError(n,e,t,this),a(new be.O(e,t,n))):i(o)};n.driver.connection.logger.logQuery(e,t,n);var u=+new Date;n.connect().then((function(n){o?n.execSQL(e,t,s):n.all(e,t,s)}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Ee.J),Oe=function(e){function t(t){var n=e.call(this,t)||this;if(n.connection=t,n.options=t.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new Ce.f("database");return n.loadDependencies(),n}return(0,r.ZT)(t,e),t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close().then(t).catch(n)}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new xe(this)),this.queryRunner},t.prototype.normalizeType=function(t){return t.type===Buffer?"blob":e.prototype.normalizeType.call(this,t)},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{readOnly:e.options.readOnly,key:e.options.key,multithreading:e.options.multithreading,migrate:e.options.migrate,iosFlags:e.options.iosFlags,androidFlags:e.options.androidFlags},e.options.extra||{});new e.sqlite(e.options.database,r,(function(r,i){if(r)return n(r);i.resultType(e.sqlite.RESULTSASOBJECT),i.execSQL("PRAGMA foreign_keys = ON;",[],(function(e,r){if(e)return n(e);t(i)}))}))}))},t.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new Ne.z("Nativescript","nativescript-sqlite")},t}(R.w),Se=n(2183),Pe=n(4825),Ie=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new we.a(n),n}return(0,r.ZT)(t,e),t.prototype.startTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(this.isTransactionActive&&void 0!==this.transaction)throw new Se.S;return e=new X.D,this.broadcaster.broadcastBeforeTransactionStartEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!0,t=new X.D,this.broadcaster.broadcastAfterTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new Pe.W;return e=new X.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!1,this.transaction=void 0,t=new X.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new Pe.W;return e=new X.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!1,this.transaction=void 0,t=new X.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new ge.Y;return new Promise((function(i,a){return(0,r.mG)(n,void 0,void 0,(function(){var n,o,s=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.transaction((function(n){void 0===s.transaction&&(s.startTransaction(),s.transaction=n),s.transaction.executeSql(e,t,(function(n,r){var a=s.driver.connection.options.maxQueryExecutionTime,u=+new Date-o;if(a&&u>a&&s.driver.connection.logger.logQuerySlow(u,e,t,s),"INSERT INTO"===e.substr(0,11))i(r.insertId);else{for(var c=[],l=0;l<r.rows.length;l++)c.push(r.rows.item(l));i(c)}}),(function(n,r){s.driver.connection.logger.logQueryError(r,e,t,s),a(new be.O(e,t,r))}))}),(function(e){s.rollbackTransaction()}),(function(){s.isTransactionActive=!1,s.transaction=void 0})),[2]}}))}))}))},t}(Ee.J),_e=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new Ce.f("database");if(!n.options.driver)throw new Ce.f("driver");return n.sqlite=n.options.driver,n}return(0,r.ZT)(t,e),t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){try{e.queryRunner=void 0,e.databaseConnection._db.close(),e.databaseConnection=void 0,t()}catch(e){n(e)}}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Ie(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){try{var r=e.sqlite.openDatabase(e.options.database);r.transaction((function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],(function(e,n){t(r)}),(function(e,t){n({transaction:e,error:t})}))}),(function(e){n(e)}))}catch(e){n(e)}}))},t}(R.w),je=n(1649),qe=n(7962),De=n(988),Le=n(3586),Be=n(6838),Ue=n(8836),Fe=n(5704),Je=n(8946),ke=n(9368),Ge=n(28),Qe=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.client=n,i}return(0,r.ZT)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((function(t){var n=(0,r.CR)(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((function(t){var n=(0,r.CR)(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection}))),this.databaseConnectionPromise)},t.prototype.startTransaction=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(this.isTransactionActive)throw new Se.S;return e=new X.D,this.broadcaster.broadcastBeforeTransactionStartEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!0,[4,this.client.startTransaction()];case 3:return n.sent(),t=new X.D,this.broadcaster.broadcastAfterTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Pe.W;return e=new X.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.client.commitTransaction()];case 3:return n.sent(),this.isTransactionActive=!1,t=new X.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Pe.W;return e=new X.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.client.rollbackTransaction()];case 3:return n.sent(),t=new X.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.query=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(this.isReleased)throw new ge.Y;return[4,this.client.query(e,t)];case 1:return(n=r.sent()).records?[2,n.records]:[2,n]}}))}))},t}(function(e){function t(t,n){return e.call(this,t,n)||this}return(0,r.ZT)(t,e),t}(function(e){function t(t,n){var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.mode=n,r.broadcaster=new we.a(r),r}return(0,r.ZT)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((function(t){var n=(0,r.CR)(t,2),i=n[0],a=n[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=i;var o=function(){return e.release()};return e.releaseCallback=function(){e.databaseConnection.removeListener("error",o),a()},e.databaseConnection.on("error",o),e.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((function(t){var n=(0,r.CR)(t,2),i=n[0],a=n[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=i;var o=function(){return e.release()};return e.releaseCallback=function(){e.databaseConnection.removeListener("error",o),a()},e.databaseConnection.on("error",o),e.databaseConnection}))),this.databaseConnectionPromise)},t.prototype.release=function(){if(this.isReleased)return Promise.resolve();this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},t.prototype.startTransaction=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(this.isTransactionActive)throw new Se.S;return t=new X.D,this.broadcaster.broadcastBeforeTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 3:return r.sent(),e?[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)]:[3,5];case 4:r.sent(),r.label=5;case 5:return n=new X.D,this.broadcaster.broadcastAfterTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Pe.W;return e=new X.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:return n.sent(),this.isTransactionActive=!1,t=new X.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Pe.W;return e=new X.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:return n.sent(),this.isTransactionActive=!1,t=new X.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.query=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(this.isReleased)throw new ge.Y;return[4,this.connect()];case 1:n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),r.label=2;case 2:return r.trys.push([2,4,,5]),i=+new Date,[4,n.query(e,t)];case 3:switch(a=r.sent(),o=this.driver.connection.options.maxQueryExecutionTime,s=+new Date,u=s-i,o&&u>o&&this.driver.connection.logger.logQuerySlow(u,e,t,this),a.command){case"DELETE":case"UPDATE":return[2,[a.rows,a.rowCount]];default:return[2,a.rows]}return[3,5];case 4:throw c=r.sent(),this.driver.connection.logger.logQueryError(c,e,t,this),new be.O(e,t,c);case 5:return[2]}}))}))},t.prototype.stream=function(e,t,n,i){var a=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new ge.Y;return new Promise((function(s,u){return(0,r.mG)(a,void 0,void 0,(function(){var a,c,l;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return a=r.sent(),this.driver.connection.logger.logQuery(e,t,this),c=a.query(new o(e,t)),n&&c.on("end",n),i&&c.on("error",i),s(c),[3,3];case 2:return l=r.sent(),u(l),[3,3];case 3:return[2]}}))}))}))},t.prototype.getDatabases=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve(!1)]}))}))},t.prototype.hasSchema=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = \''+e+"'")];case 1:return[2,!!t.sent().length]}}))}))},t.prototype.hasTable=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t=this.parseTableName(e),n='SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '+t.schema+' AND "table_name" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=this.parseTableName(e),i='SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '+n.schema+' AND "table_name" = '+n.tableName+' AND "column_name" = \''+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}}))}))},t.prototype.dropDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t?'CREATE SCHEMA IF NOT EXISTS "'+e+'"':'CREATE SCHEMA "'+e+'"',i='DROP SCHEMA "'+e+'" CASCADE',[4,this.executeQueries(new Ge.A(n),new Ge.A(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropSchema=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return i=-1===e.indexOf(".")?e:e.split(".")[0],a=t?'DROP SCHEMA IF EXISTS "'+i+'" '+(n?"CASCADE":""):'DROP SCHEMA "'+i+'" '+(n?"CASCADE":""),o='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(new Ge.A(a),new Ge.A(o))];case 1:return r.sent(),[2]}}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,(function(){var a,o,s=this;return(0,r.Jh)(this,(function(u){switch(u.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(u.sent())return[2,Promise.resolve()];u.label=2;case 2:return a=[],o=[],[4,Promise.all(e.columns.filter((function(e){return"enum"===e.type||"simple-enum"===e.type})).map((function(t){return(0,r.mG)(s,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.hasEnumType(e,t)];case 1:return n.sent()||(a.push(this.createEnumTypeSql(e,t)),o.push(this.dropEnumTypeSql(e,t))),[2,Promise.resolve()]}}))}))})))];case 3:return u.sent(),a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((function(t){return o.push(s.dropForeignKeySql(e,t))})),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))})),[4,this.executeQueries(a,o)];case 4:return u.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,(function(){var a,s,u,c,l,h=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,s=e instanceof o.i?e.name:e,[4,this.getCachedTable(s)];case 3:return u=r.sent(),c=[],l=[],i&&u.indices.forEach((function(e){c.push(h.dropIndexSql(u,e)),l.push(h.createIndexSql(u,e))})),n&&u.foreignKeys.forEach((function(e){return c.push(h.dropForeignKeySql(u,e))})),c.push(this.dropTableSql(u)),l.push(this.createTableSql(u,a)),[4,this.executeQueries(c,l)];case 4:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t=e instanceof ke.G?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u,c,l,h,p,f,d,m,y,v,g,b,E,w,T=this;return(0,r.Jh)(this,(function(C){switch(C.label){case 0:return n=[],i=[],e instanceof o.i?(s=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:s=C.sent(),C.label=3;case 3:u=(a=s).clone(),c=-1===a.name.indexOf(".")?a.name:a.name.split(".")[1],l=-1===a.name.indexOf(".")?void 0:a.name.split(".")[0],u.name=l?l+"."+t:t,n.push(new Ge.A("ALTER TABLE "+this.escapePath(a)+' RENAME TO "'+t+'"')),i.push(new Ge.A("ALTER TABLE "+this.escapePath(u)+' RENAME TO "'+c+'"')),u.primaryColumns.length>0&&(h=u.primaryColumns.map((function(e){return e.name})),p=this.connection.namingStrategy.primaryKeyName(a,h),f=this.connection.namingStrategy.primaryKeyName(u,h),n.push(new Ge.A("ALTER TABLE "+this.escapePath(u)+' RENAME CONSTRAINT "'+p+'" TO "'+f+'"')),i.push(new Ge.A("ALTER TABLE "+this.escapePath(u)+' RENAME CONSTRAINT "'+f+'" TO "'+p+'"'))),u.uniques.forEach((function(e){var t=T.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);n.push(new Ge.A("ALTER TABLE "+T.escapePath(u)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new Ge.A("ALTER TABLE "+T.escapePath(u)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),u.indices.forEach((function(e){var t=T.extractSchema(u),r=T.connection.namingStrategy.indexName(u,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',o=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';n.push(new Ge.A(a)),i.push(new Ge.A(o)),e.name=r})),u.foreignKeys.forEach((function(e){var t=T.connection.namingStrategy.foreignKeyName(u,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new Ge.A("ALTER TABLE "+T.escapePath(u)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new Ge.A("ALTER TABLE "+T.escapePath(u)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),d=u.columns.filter((function(e){return"enum"===e.type||"simple-enum"===e.type})),C.label=4;case 4:C.trys.push([4,9,10,11]),m=(0,r.XA)(d),y=m.next(),C.label=5;case 5:return y.done?[3,8]:(v=y.value,[4,this.getEnumTypeName(a,v)]);case 6:g=C.sent(),n.push(new Ge.A('ALTER TYPE "'+g.enumTypeSchema+'"."'+g.enumTypeName+'" RENAME TO '+this.buildEnumName(u,v,!1))),i.push(new Ge.A("ALTER TYPE "+this.buildEnumName(u,v)+' RENAME TO "'+g.enumTypeName+'"')),C.label=7;case 7:return y=m.next(),[3,5];case 8:return[3,11];case 9:return b=C.sent(),E={error:b},[3,11];case 10:try{y&&!y.done&&(w=m.return)&&w.call(m)}finally{if(E)throw E.error}return[7];case 11:return[4,this.executeQueries(n,i)];case 12:return C.sent(),[2]}}))}))},t.prototype.addColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u,c,l,h,p,f,d,m;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),s=[],u=[],"enum"!==t.type&&"simple-enum"!==t.type?[3,5]:[4,this.hasEnumType(n,t)];case 4:r.sent()||(s.push(this.createEnumTypeSql(n,t)),u.push(this.dropEnumTypeSql(n,t))),r.label=5;case 5:return s.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,t))),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+t.name+'"')),t.isPrimary&&((c=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map((function(e){return e.name}))),h=c.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+l+'"')),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")"))),c.push(t),p=this.connection.namingStrategy.primaryKeyName(a.name,c.map((function(e){return e.name}))),f=c.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+f+")")),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+p+'"'))),(d=a.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))&&(s.push(this.createIndexSql(n,d)),u.push(this.dropIndexSql(n,d))),t.isUnique&&(m=new Je.v({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(m),s.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+m.name+'" UNIQUE ("'+t.name+'")')),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+m.name+'"'))),t.comment&&(s.push(new Ge.A("COMMENT ON COLUMN "+this.escapePath(n)+'."'+t.name+'" IS '+this.escapeComment(t.comment))),u.push(new Ge.A("COMMENT ON COLUMN "+this.escapePath(n)+'."'+t.name+'" IS '+this.escapeComment(t.comment)))),[4,this.executeQueries(s,u)];case 6:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.addColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.addColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof Le.D?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n instanceof Le.D?u=n:(u=s.clone()).name=n,[2,this.changeColumn(i,s,u)]}}))}))},t.prototype.changeColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,s,u,c,l,h,p,f,d,m,y,v,g,b,E,w,T,C,N,M,A,R,x,O,S,P,I=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(s=(i=a).clone(),u=[],c=[],!(l=t instanceof Le.D?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return l.type===n.type&&l.length===n.length?[3,6]:[4,this.dropColumn(i,l)];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),s=i.clone(),[3,12];case 6:return l.name===n.name?[3,9]:(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+l.name+'" TO "'+n.name+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+n.name+'" TO "'+l.name+'"')),"enum"!==l.type&&"simple-enum"!==l.type?[3,8]:[4,this.getEnumTypeName(i,l)]);case 7:h=r.sent(),u.push(new Ge.A('ALTER TYPE "'+h.enumTypeSchema+'"."'+h.enumTypeName+'" RENAME TO '+this.buildEnumName(i,n,!1))),c.push(new Ge.A("ALTER TYPE "+this.buildEnumName(i,n)+' RENAME TO "'+h.enumTypeName+'"')),r.label=8;case 8:!0===l.isPrimary&&(R=s.primaryColumns,S=R.map((function(e){return e.name})),p=this.connection.namingStrategy.primaryKeyName(s,S),S.splice(S.indexOf(l.name),1),S.push(n.name),f=this.connection.namingStrategy.primaryKeyName(s,S),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+p+'" TO "'+f+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+f+'" TO "'+p+'"'))),!0===l.isGenerated&&"increment"===n.generationStrategy&&(d=this.extractSchema(i),m=this.buildSequenceName(i,l.name,void 0,!0,!0),y=this.buildSequenceName(i,n.name,void 0,!0,!0),v=d?'ALTER SEQUENCE "'+d+'"."'+m+'" RENAME TO "'+y+'"':'ALTER SEQUENCE "'+m+'" RENAME TO "'+y+'"',g=d?'ALTER SEQUENCE "'+d+'"."'+y+'" RENAME TO "'+m+'"':'ALTER SEQUENCE "'+y+'" RENAME TO "'+m+'"',u.push(new Ge.A(v)),c.push(new Ge.A(g))),s.findColumnUniques(l).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=I.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);u.push(new Ge.A("ALTER TABLE "+I.escapePath(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),c.push(new Ge.A("ALTER TABLE "+I.escapePath(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),s.findColumnIndices(l).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=I.extractSchema(i),r=I.connection.namingStrategy.indexName(s,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',o=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';u.push(new Ge.A(a)),c.push(new Ge.A(o)),e.name=r})),s.findColumnForeignKeys(l).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=I.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames);u.push(new Ge.A("ALTER TABLE "+I.escapePath(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),c.push(new Ge.A("ALTER TABLE "+I.escapePath(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),b=s.columns.find((function(e){return e.name===l.name})),s.columns[s.columns.indexOf(b)].name=n.name,l.name=n.name,r.label=9;case 9:return n.precision===l.precision&&n.scale===l.scale||(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(n))),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(l)))),"enum"!==n.type&&"simple-enum"!==n.type||"enum"!==l.type&&"simple-enum"!==l.type||W.s.isArraysEqual(n.enum,l.enum)?[3,11]:(E=this.buildEnumName(i,n),w=n.isArray?"[]":"",T=this.buildEnumName(i,n,!0,!1,!0),C=this.buildEnumName(i,n,!1,!1,!0),[4,this.getEnumTypeName(i,l)]);case 10:N=r.sent(),u.push(new Ge.A('ALTER TYPE "'+N.enumTypeSchema+'"."'+N.enumTypeName+'" RENAME TO '+C)),c.push(new Ge.A("ALTER TYPE "+T+' RENAME TO  "'+N.enumTypeName+'"')),u.push(this.createEnumTypeSql(i,n)),c.push(this.dropEnumTypeSql(i,l)),null!==n.default&&void 0!==n.default&&(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default))),M=""+E+w+' USING "'+n.name+'"::"text"::'+E+w,A=""+T+w+' USING "'+n.name+'"::"text"::'+T+w,u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+M)),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+A)),null!==n.default&&void 0!==n.default&&(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default)),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))),u.push(this.dropEnumTypeSql(i,n,T)),c.push(this.createEnumTypeSql(i,l,T)),r.label=11;case 11:l.isNullable!==n.isNullable&&(n.isNullable?(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+l.name+'" DROP NOT NULL')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+l.name+'" SET NOT NULL'))):(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+l.name+'" SET NOT NULL')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+l.name+'" DROP NOT NULL')))),l.comment!==n.comment&&(u.push(new Ge.A("COMMENT ON COLUMN "+this.escapePath(i)+'."'+l.name+'" IS '+this.escapeComment(n.comment))),c.push(new Ge.A("COMMENT ON COLUMN "+this.escapePath(i)+'."'+n.name+'" IS '+this.escapeComment(l.comment)))),n.isPrimary!==l.isPrimary&&((R=s.primaryColumns).length>0&&(O=this.connection.namingStrategy.primaryKeyName(s.name,R.map((function(e){return e.name}))),S=R.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+O+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+O+'" PRIMARY KEY ('+S+")"))),!0===n.isPrimary?(R.push(n),s.columns.find((function(e){return e.name===n.name})).isPrimary=!0,O=this.connection.namingStrategy.primaryKeyName(s.name,R.map((function(e){return e.name}))),S=R.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+O+'" PRIMARY KEY ('+S+")")),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+O+'"'))):(x=R.find((function(e){return e.name===n.name})),R.splice(R.indexOf(x),1),s.columns.find((function(e){return e.name===n.name})).isPrimary=!1,R.length>0&&(O=this.connection.namingStrategy.primaryKeyName(s.name,R.map((function(e){return e.name}))),S=R.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+O+'" PRIMARY KEY ('+S+")")),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+O+'"'))))),n.isUnique!==l.isUnique&&(!0===n.isUnique?(P=new Je.v({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),s.uniques.push(P),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+P.name+'" UNIQUE ("'+n.name+'")')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+P.name+'"'))):(P=s.uniques.find((function(e){return 1===e.columnNames.length&&!!e.columnNames.find((function(e){return e===n.name}))})),s.uniques.splice(s.uniques.indexOf(P),1),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+P.name+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+P.name+'" UNIQUE ("'+n.name+'")')))),l.isGenerated!==n.isGenerated&&"uuid"!==n.generationStrategy&&(!0===n.isGenerated?(u.push(new Ge.A("CREATE SEQUENCE "+this.buildSequenceName(i,n)+" OWNED BY "+this.escapePath(i)+'."'+n.name+'"')),c.push(new Ge.A("DROP SEQUENCE "+this.buildSequenceName(i,n))),u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+"\" SET DEFAULT nextval('"+this.buildSequenceName(i,n,void 0,!0)+"')")),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))):(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+"\" SET DEFAULT nextval('"+this.buildSequenceName(i,n,void 0,!0)+"')")),u.push(new Ge.A("DROP SEQUENCE "+this.buildSequenceName(i,n))),c.push(new Ge.A("CREATE SEQUENCE "+this.buildSequenceName(i,n)+" OWNED BY "+this.escapePath(i)+'."'+n.name+'"')))),n.default!==l.default&&(null!==n.default&&void 0!==n.default?(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default)),null!==l.default&&void 0!==l.default?c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+l.default)):c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))):null!==l.default&&void 0!==l.default&&(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+l.default)))),(n.spatialFeatureType||"").toLowerCase()===(l.spatialFeatureType||"").toLowerCase()&&n.srid===l.srid||(u.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(n))),c.push(new Ge.A("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(l)))),r.label=12;case 12:return[4,this.executeQueries(u,c)];case 13:return r.sent(),this.replaceCachedTable(i,s),[2]}}))}))},t.prototype.changeColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l;return(0,r.Jh)(this,(function(h){switch(h.label){case 0:h.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),h.label=1;case 1:return i.done?[3,4]:(a=i.value,o=a.oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)]);case 2:h.sent(),h.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u=h.sent(),c={error:u},[3,7];case 6:try{i&&!i.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 7:return[2]}}))}))},t.prototype.dropColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u,c,l,h,p,f,d,m,y,v,g;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Le.D?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return s=n.clone(),u=[],c=[],a.isPrimary&&(l=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map((function(e){return e.name}))),h=s.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+l+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")")),s.findColumnByName(a.name).isPrimary=!1,s.primaryColumns.length>0&&(p=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map((function(e){return e.name}))),f=s.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+f+")")),c.push(new Ge.A("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+p+'"')))),(d=s.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(s.indices.splice(s.indices.indexOf(d),1),u.push(this.dropIndexSql(n,d)),c.push(this.createIndexSql(n,d))),(m=s.checks.find((function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(s.checks.splice(s.checks.indexOf(m),1),u.push(this.dropCheckConstraintSql(n,m)),c.push(this.createCheckConstraintSql(n,m))),(y=s.uniques.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(s.uniques.splice(s.uniques.indexOf(y),1),u.push(this.dropUniqueConstraintSql(n,y)),c.push(this.createUniqueConstraintSql(n,y))),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+a.name+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,a))),"enum"!==a.type&&"simple-enum"!==a.type?[3,6]:[4,this.hasEnumType(n,a)];case 4:return r.sent()?[4,this.getEnumTypeName(n,a)]:[3,6];case 5:v=r.sent(),g='"'+v.enumTypeSchema+'"."'+v.enumTypeName+'"',u.push(this.dropEnumTypeSql(n,a,g)),c.push(this.createEnumTypeSql(n,a,g)),r.label=6;case 6:return[4,this.executeQueries(u,c)];case 7:return r.sent(),s.removeColumn(a),this.replaceCachedTable(n,s),[2]}}))}))},t.prototype.dropColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),s=this.createPrimaryKeySql(n,t),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),u=this.dropPrimaryKeySql(a),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u,c,l,h,p,f,d;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),s=t.map((function(e){return e.name})),u=[],c=[],(l=a.primaryColumns).length>0&&(h=this.connection.namingStrategy.primaryKeyName(a.name,l.map((function(e){return e.name}))),p=l.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+h+'"')),c.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")"))),a.columns.filter((function(e){return-1!==s.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),f=this.connection.namingStrategy.primaryKeyName(a.name,s),d=s.map((function(e){return'"'+e+'"'})).join(", "),u.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+d+")")),c.push(new Ge.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+f+'"')),[4,this.executeQueries(u,c)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name}))),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),s=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,s)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.createUniqueConstraint(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Je.v?t:n.uniques.find((function(e){return e.name===t}))))throw new Error("Supplied unique constraint was not found in table "+n.name);return s=this.dropUniqueConstraintSql(n,a),u=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(s,u)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropUniqueConstraint(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),s=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,s)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof De.r?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return s=this.dropCheckConstraintSql(n,a),u=this.createCheckConstraintSql(n,a),[4,this.executeQueries(s,u)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.exclusionConstraintName(n.name,t.expression)),a=this.createExclusionConstraintSql(n,t),s=this.dropExclusionConstraintSql(n,t),[4,this.executeQueries(a,s)];case 4:return r.sent(),n.addExclusionConstraint(t),[2]}}))}))},t.prototype.createExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createExclusionConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Be.N?t:n.exclusions.find((function(e){return e.name===t}))))throw new Error("Supplied exclusion constraint was not found in table "+n.name);return s=this.dropExclusionConstraintSql(n,a),u=this.createExclusionConstraintSql(n,a),[4,this.executeQueries(s,u)];case 4:return r.sent(),n.removeExclusionConstraint(a),[2]}}))}))},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropExclusionConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),s=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,s)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.createForeignKey(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Ue.U?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return s=this.dropForeignKeySql(n,a),u=this.createForeignKeySql(n,a),[4,this.executeQueries(s,u)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropForeignKey(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.createIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),s=this.dropIndexSql(n,t),[4,this.executeQueries(a,s)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.createIndex(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.dropIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e instanceof o.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Fe.s?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return s=this.dropIndexSql(n,a),u=this.createIndexSql(n,a),[4,this.executeQueries(s,u)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.XA)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropIndex(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.clearTable=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter((function(e){return e.schema})).forEach((function(t){e.find((function(e){return e===t.schema}))||e.push(t.schema)})),e.push(this.driver.options.schema||"current_schema()"),t=e.map((function(e){return"current_schema()"===e?e:"'"+e+"'"})).join(", "),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,9,,14]),n='SELECT \'DROP VIEW IF EXISTS "\' || schemaname || \'"."\' || viewname || \'" CASCADE;\' as "query" FROM "pg_views" WHERE "schemaname" IN ('+t+") AND \"viewname\" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')",[4,this.query(n)];case 3:return i=r.sent(),[4,Promise.all(i.map((function(e){return u.query(e.query)})))];case 4:return r.sent(),a='SELECT \'DROP TABLE IF EXISTS "\' || schemaname || \'"."\' || tablename || \'" CASCADE;\' as "query" FROM "pg_tables" WHERE "schemaname" IN ('+t+") AND \"tablename\" NOT IN ('spatial_ref_sys')",[4,this.query(a)];case 5:return o=r.sent(),[4,Promise.all(o.map((function(e){return u.query(e.query)})))];case 6:return r.sent(),[4,this.dropEnumTypes(t)];case 7:return r.sent(),[4,this.commitTransaction()];case 8:return r.sent(),[3,14];case 9:s=r.sent(),r.label=10;case 10:return r.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:case 12:return r.sent(),[3,13];case 13:throw s;case 14:return[2]}}))}))},t.prototype.loadViews=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o=this;return(0,r.Jh)(this,(function(s){switch(s.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return s.sent()?[4,this.query("SELECT * FROM current_schema()")]:[2,Promise.resolve([])];case 2:return t=s.sent(),n=t[0].current_schema,i=e.map((function(e){var t=(0,r.CR)(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=o.driver.options.schema||n),'("t"."schema" = \''+i+'\' AND "t"."name" = \''+a+"')"})).join(" OR "),a='SELECT "t".*, "v"."check_option" FROM '+this.escapePath(this.getTypeormMetadataTableName())+' "t" INNER JOIN "information_schema"."views" "v" ON "v"."table_schema" = "t"."schema" AND "v"."table_name" = "t"."name" WHERE "t"."type" = \'VIEW\' '+(i?"AND ("+i+")":""),[4,this.query(a)];case 3:return[2,s.sent().map((function(e){var t=new ke.G,r=e.schema!==n||o.driver.options.schema?e.schema:void 0;return t.name=o.driver.buildTableName(e.name,r),t.expression=e.value,t}))]}}))}))},t.prototype.loadTables=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,s,u,c,l,h,p,f,d,m,y,v,g,b,E=this;return(0,r.Jh)(this,(function(w){switch(w.label){case 0:return e&&e.length?[4,this.query("SELECT * FROM current_schema()")]:[2,[]];case 1:return t=w.sent(),n=t[0].current_schema,i=e.map((function(e){var t=(0,r.CR)(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=E.driver.options.schema||n),'("table_schema" = \''+i+"' AND \"table_name\" = '"+a+"')"})).join(" OR "),a='SELECT * FROM "information_schema"."tables" WHERE '+i,s='\n            SELECT columns.*,\n              pg_catalog.col_description((\'"\' || table_catalog || \'"."\' || table_schema || \'"."\' || table_name || \'"\')::regclass::oid, ordinal_position) AS description,\n              (\'"\' || "udt_schema" || \'"."\' || "udt_name" || \'"\')::"regtype" AS "regtype",\n              pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type"\n              FROM "information_schema"."columns"\n              LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr"\n              ON "col_attr"."attname" = "columns"."column_name"\n              AND "col_attr"."attrelid" = (\n                SELECT\n                  "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls"\n                  LEFT JOIN "pg_catalog"."pg_namespace" AS "ns"\n                  ON "ns"."oid" = "cls"."relnamespace"\n                WHERE "cls"."relname" = "columns"."table_name"\n                AND "ns"."nspname" = "columns"."table_schema"\n              )\n            WHERE\n            '+i,u=e.map((function(e){var t=(0,r.CR)(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=E.driver.options.schema||n),'("ns"."nspname" = \''+i+'\' AND "t"."relname" = \''+a+"')"})).join(" OR "),c='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN \'p\' THEN \'PRIMARY\' WHEN \'u\' THEN \'UNIQUE\' WHEN \'c\' THEN \'CHECK\' WHEN \'x\' THEN \'EXCLUDE\' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN (\'r\', \'p\') AND ('+u+")",l='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN \'t\' THEN \'TRUE\' ELSE\'FALSE\' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN (\'r\', \'p\') AND "cnst"."contype" IS NULL AND ('+u+")",h=e.map((function(e){var t=(0,r.CR)(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=E.driver.options.schema||n),'("ns"."nspname" = \''+i+'\' AND "cl"."relname" = \''+a+"')"})).join(" OR "),[4,this.hasSupportForPartitionedTables()];case 2:return p=w.sent(),f='SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN \'INITIALLY DEFERRED\' ELSE \'INITIALLY IMMEDIATE\' END as condeferred, CASE "con1"."confdeltype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confdeltype", CASE "con1"."confupdtype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = \'f\' AND ('+h+') ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" '+(p?' AND "cl"."relispartition" = \'f\'':"")+'INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"',[4,Promise.all([this.query(a),this.query(s),this.query(c),this.query(l),this.query(f)])];case 3:return d=r.CR.apply(void 0,[w.sent(),5]),m=d[0],y=d[1],v=d[2],g=d[3],b=d[4],m.length?[2,Promise.all(m.map((function(e){return(0,r.mG)(E,void 0,void 0,(function(){var t,a,s,u,c,l,h,p,f,d,m=this;return(0,r.Jh)(this,(function(E){switch(E.label){case 0:return t=new o.i,s=(a=function(e,t){return e[t]!==n||m.driver.options.schema?e[t]:void 0})(e,"table_schema"),t.name=this.driver.buildTableName(e.table_name,s),u=this.driver.buildTableName(e.table_name,e.table_schema),c=t,[4,Promise.all(y.filter((function(e){return m.driver.buildTableName(e.table_name,e.table_schema)===u})).map((function(a){return(0,r.mG)(m,void 0,void 0,(function(){var o,s,c,l,h,p,f,d,m,y,g,b=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return o=v.filter((function(e){return b.driver.buildTableName(e.table_name,e.table_schema)===u&&e.column_name===a.column_name})),(s=new Le.D).name=a.column_name,s.type=a.regtype.toLowerCase(),"numeric"!==s.type&&"decimal"!==s.type&&"float"!==s.type||(null===a.numeric_precision||this.isDefaultColumnPrecision(t,s,a.numeric_precision)?null===a.numeric_scale||this.isDefaultColumnScale(t,s,a.numeric_scale)||(s.precision=void 0):s.precision=a.numeric_precision,null===a.numeric_scale||this.isDefaultColumnScale(t,s,a.numeric_scale)?null===a.numeric_precision||this.isDefaultColumnPrecision(t,s,a.numeric_precision)||(s.scale=void 0):s.scale=a.numeric_scale),"array"===a.data_type.toLowerCase()&&(s.isArray=!0,c=s.type.replace("[]",""),s.type=this.connection.driver.normalizeType({type:c})),"interval"!==s.type&&"time without time zone"!==s.type&&"time with time zone"!==s.type&&"timestamp without time zone"!==s.type&&"timestamp with time zone"!==s.type||(s.precision=this.isDefaultColumnPrecision(t,s,a.datetime_precision)?void 0:a.datetime_precision),-1===s.type.indexOf("enum")?[3,2]:(s.type="enum",l='SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = \''+e.table_schema+'\' AND "t"."typname" = \''+this.buildEnumName(t,s.name,!1,!0)+"'",[4,this.query(l)]);case 1:f=r.sent(),s.enum=f.map((function(e){return e.value})),r.label=2;case 2:return"geometry"!==s.type?[3,4]:(h='SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geometry_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geometry_columns"\n                      ) AS _\n                      WHERE ('+i+') AND "column_name" = \''+s.name+"' AND \"table_name\" = '"+e.table_name+"'",[4,this.query(h)]);case 3:f=r.sent(),s.spatialFeatureType=f[0].type,s.srid=f[0].srid,r.label=4;case 4:return"geography"!==s.type?[3,6]:(p='SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geography_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geography_columns"\n                      ) AS _\n                      WHERE ('+i+') AND "column_name" = \''+s.name+"' AND \"table_name\" = '"+e.table_name+"'",[4,this.query(p)]);case 5:f=r.sent(),s.spatialFeatureType=f[0].type,s.srid=f[0].srid,r.label=6;case 6:return-1!==this.driver.withLengthColumnTypes.indexOf(s.type)&&(s.isArray?(m=/\((\d+)\)/.exec(a.format_type),d=m?m[1]:void 0):a.character_maximum_length&&(d=a.character_maximum_length.toString()),d&&(s.length=this.isDefaultColumnLength(t,s,d)?"":d)),s.isNullable="YES"===a.is_nullable,s.isPrimary=!!o.find((function(e){return"PRIMARY"===e.constraint_type})),y=o.find((function(e){return"UNIQUE"===e.constraint_type})),g=!!y&&!!v.find((function(e){return"UNIQUE"===e.constraint_type&&e.constraint_name===y.constraint_name&&e.column_name!==a.column_name})),s.isUnique=!!y&&!g,null!==a.column_default&&void 0!==a.column_default&&(a.column_default.replace(/"/gi,"")==="nextval('"+this.buildSequenceName(t,a.column_name,n,!0)+"'::regclass)"?(s.isGenerated=!0,s.generationStrategy="increment"):"gen_random_uuid()"===a.column_default||/^uuid_generate_v\d\(\)/.test(a.column_default)?(s.isGenerated=!0,s.generationStrategy="uuid"):(s.default=a.column_default.replace(/::.*/,""),s.default=s.default.replace(/^(-?\d+)$/,"'$1'"))),s.comment=null==a.description?void 0:a.description,a.character_set_name&&(s.charset=a.character_set_name),a.collation_name&&(s.collation=a.collation_name),[2,s]}}))}))})))];case 1:return c.columns=E.sent(),l=W.s.uniq(v.filter((function(e){return m.driver.buildTableName(e.table_name,e.table_schema)===u&&"UNIQUE"===e.constraint_type})),(function(e){return e.constraint_name})),t.uniques=l.map((function(e){var t=v.filter((function(t){return t.constraint_name===e.constraint_name}));return new Je.v({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name}))})})),h=W.s.uniq(v.filter((function(e){return m.driver.buildTableName(e.table_name,e.table_schema)===u&&"CHECK"===e.constraint_type})),(function(e){return e.constraint_name})),t.checks=h.map((function(e){var t=v.filter((function(t){return t.constraint_name===e.constraint_name}));return new De.r({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),expression:e.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})})),p=W.s.uniq(v.filter((function(e){return m.driver.buildTableName(e.table_name,e.table_schema)===u&&"EXCLUDE"===e.constraint_type})),(function(e){return e.constraint_name})),t.exclusions=p.map((function(e){return new Be.N({name:e.constraint_name,expression:e.expression.substring(8)})})),f=W.s.uniq(b.filter((function(e){return m.driver.buildTableName(e.table_name,e.table_schema)===u})),(function(e){return e.constraint_name})),t.foreignKeys=f.map((function(e){var t=b.filter((function(t){return t.constraint_name===e.constraint_name})),n=a(e,"referenced_table_schema"),r=m.driver.buildTableName(e.referenced_table_name,n);return new Ue.U({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),referencedTableName:r,referencedColumnNames:t.map((function(e){return e.referenced_column_name})),onDelete:e.on_delete,onUpdate:e.on_update,deferrable:e.deferrable?e.deferred:void 0})})),d=W.s.uniq(g.filter((function(e){return m.driver.buildTableName(e.table_name,e.table_schema)===u})),(function(e){return e.constraint_name})),t.indices=d.map((function(e){var n=g.filter((function(t){return t.table_schema===e.table_schema&&t.table_name===e.table_name&&t.constraint_name===e.constraint_name}));return new Fe.s({table:t,name:e.constraint_name,columnNames:n.map((function(e){return e.column_name})),isUnique:"TRUE"===e.is_unique,where:e.condition,isSpatial:n.every((function(e){return m.driver.spatialTypes.indexOf(e.type_name)>=0})),isFulltext:!1})})),[2,t]}}))}))})))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(t){return n.buildCreateColumnSql(e,t)})).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;if(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new Je.v({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0){var a=e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", ");i+=", "+a}if(e.checks.length>0){var o=e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", ");i+=", "+o}if(e.exclusions.length>0){var s=e.exclusions.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.exclusionConstraintName(e.name,t.expression))+'" EXCLUDE '+t.expression})).join(", ");i+=", "+s}if(e.foreignKeys.length>0&&t){var u=e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapePath(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),t.deferrable&&(a+=" DEFERRABLE "+t.deferrable),a})).join(", ");i+=", "+u}var c=e.columns.filter((function(e){return e.isPrimary}));if(c.length>0){var l=this.connection.namingStrategy.primaryKeyName(e.name,c.map((function(e){return e.name}))),h=c.map((function(e){return'"'+e.name+'"'})).join(", ");i+=', CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")"}return i+=")",e.columns.filter((function(e){return e.comment})).forEach((function(t){return i+="; COMMENT ON COLUMN "+n.escapePath(e)+'."'+t.name+'" IS '+n.escapeComment(t.comment)})),new Ge.A(i)},t.prototype.dropTableSql=function(e){return new Ge.A("DROP TABLE "+this.escapePath(e))},t.prototype.createViewSql=function(e){var t=e.materialized?"MATERIALIZED ":"",n=this.escapePath(e);return"string"==typeof e.expression?new Ge.A("CREATE "+t+"VIEW "+n+" AS "+e.expression):new Ge.A("CREATE "+t+"VIEW "+n+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l;return(0,r.Jh)(this,(function(h){switch(h.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return t=h.sent(),n=t[0].current_schema,i=e.name.split("."),a=this.driver.options.schema||n,o=e.name,2===i.length&&(a=i[0],o=i[1]),s="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),u=(0,r.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",schema:a,name:o,value:s}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new Ge.A(c,l)]}}))}))},t.prototype.dropViewSql=function(e){return new Ge.A("DROP VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h;return(0,r.Jh)(this,(function(p){switch(p.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return t=p.sent(),n=t[0].current_schema,i=e instanceof ke.G?e.name:e,a=i.split("."),o=this.driver.options.schema||n,s=i,2===a.length&&(o=a[0],s=a[1]),u=this.connection.createQueryBuilder(),c=(0,r.CR)(u.delete().from(this.getTypeormMetadataTableName()).where(u.escape("type")+" = 'VIEW'").andWhere(u.escape("schema")+" = :schema",{schema:o}).andWhere(u.escape("name")+" = :name",{name:s}).getQueryAndParameters(),2),l=c[0],h=c[1],[2,new Ge.A(l,h)]}}))}))},t.prototype.extractSchema=function(e){var t=e instanceof o.i?e.name:e;return-1===t.indexOf(".")?this.driver.options.schema:t.split(".")[0]},t.prototype.dropEnumTypes=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t='SELECT \'DROP TYPE IF EXISTS "\' || n.nspname || \'"."\' || t.typname || \'" CASCADE;\' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN ('+e+') GROUP BY "n"."nspname", "t"."typname"',[4,this.query(t)];case 1:return n=r.sent(),[4,Promise.all(n.map((function(e){return i.query(e.query)})))];case 2:return r.sent(),[2]}}))}))},t.prototype.hasEnumType=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=this.parseTableName(e).schema,i=this.buildEnumName(e,t,!1,!0),a='SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '+n+' AND "t"."typname" = \''+i+"'",[4,this.query(a)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createEnumTypeSql=function(e,t,n){n||(n=this.buildEnumName(e,t));var r=t.enum.map((function(e){return"'"+e.replace("'","''")+"'"})).join(", ");return new Ge.A("CREATE TYPE "+n+" AS ENUM("+r+")")},t.prototype.dropEnumTypeSql=function(e,t,n){return n||(n=this.buildEnumName(e,t)),new Ge.A("DROP TYPE "+n)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new Ge.A("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON '+this.escapePath(e)+" "+(t.isSpatial?"USING GiST ":"")+"("+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof Fe.s?t.name:t,r=this.extractSchema(e);return r?new Ge.A('DROP INDEX "'+r+'"."'+n+'"'):new Ge.A('DROP INDEX "'+n+'"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map((function(e){return'"'+e+'"'})).join(", ");return new Ge.A("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map((function(e){return e.name})),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new Ge.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new Ge.A("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof Je.v?t.name:t;return new Ge.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new Ge.A("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof De.r?t.name:t;return new Ge.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createExclusionConstraintSql=function(e,t){return new Ge.A("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" EXCLUDE '+t.expression)},t.prototype.dropExclusionConstraintSql=function(e,t){var n=t instanceof Be.N?t.name:t;return new Ge.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(","),i="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapePath(t.referencedTableName)+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),t.deferrable&&(i+=" DEFERRABLE "+t.deferrable),new Ge.A(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof Ue.U?t.name:t;return new Ge.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.buildSequenceName=function(e,t,n,r,i){var a=t instanceof Le.D?t.name:t,o=void 0,s=void 0;-1===e.name.indexOf(".")?s=e.name:(o=e.name.split(".")[0],s=e.name.split(".")[1]);var u=s+"_"+a+"_seq";return u.length>this.connection.driver.maxAliasLength&&(u=s.substring(0,29)+"_"+a.substring(0,Math.max(29,63-s.length-5))+"_seq"),o&&o!==n&&!i?r?o+"."+u:'"'+o+'"."'+u+'"':r?""+u:'"'+u+'"'},t.prototype.buildEnumName=function(e,t,n,r,i){if(void 0===n&&(n=!0),t instanceof Le.D&&t.enumName){var a=t.enumName;return i&&(a+="_old"),r?a:'"'+a+'"'}var o=t instanceof Le.D?t.name:t,s=-1===e.name.indexOf(".")?this.driver.options.schema:e.name.split(".")[0],u=-1===e.name.indexOf(".")?e.name:e.name.split(".")[1],c=s&&n?s+"."+u+"_"+o.toLowerCase()+"_enum":u+"_"+o.toLowerCase()+"_enum";return i&&(c+="_old"),c.split(".").map((function(e){return r?e:'"'+e+'"'})).join(".")},t.prototype.getEnumTypeName=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return n=c.sent(),i=n[0].current_schema,a=(0,r.CR)(e.name.split("."),2),o=a[0],(s=a[1])||(s=o,o=this.driver.options.schema||i),[4,this.query('SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = \''+o+"' AND \"table_name\" = '"+s+"' AND \"column_name\"='"+t.name+"'")];case 2:return[2,{enumTypeSchema:(u=c.sent())[0].udt_schema,enumTypeName:u[0].udt_name}]}}))}))},t.prototype.escapeComment=function(e){return void 0===e||0===e.length?"NULL":"'"+(e=e.replace("'","''").replace("\0",""))+"'"},t.prototype.escapePath=function(e,t){var n=e instanceof o.i||e instanceof ke.G?e.name:e;return(n=-1===n.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+n:n).split(".").map((function(e){return t?e:'"'+e+'"'})).join(".")},t.prototype.parseTableName=function(e){var t=e instanceof o.i?e.name:e;return-1===t.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema()",tableName:"'"+t+"'"}:{schema:"'"+t.split(".")[0]+"'",tableName:"'"+t.split(".")[1]+"'"}},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+t.name+'"';return!0===t.isGenerated&&"uuid"!==t.generationStrategy&&("integer"!==t.type&&"int"!==t.type&&"int4"!==t.type||(n+=" SERIAL"),"smallint"!==t.type&&"int2"!==t.type||(n+=" SMALLSERIAL"),"bigint"!==t.type&&"int8"!==t.type||(n+=" BIGSERIAL")),"enum"===t.type||"simple-enum"===t.type?(n+=" "+this.buildEnumName(e,t),t.isArray&&(n+=" array")):t.isGenerated&&"uuid"!==t.type||(n+=" "+this.connection.driver.createFullType(t)),t.charset&&(n+=' CHARACTER SET "'+t.charset+'"'),t.collation&&(n+=' COLLATE "'+t.collation+'"'),!0!==t.isNullable&&(n+=" NOT NULL"),void 0!==t.default&&null!==t.default&&(n+=" DEFAULT "+t.default),t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(n+=" DEFAULT "+this.driver.uuidGenerator),n},t.prototype.hasSupportForPartitionedTables=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return[4,this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")];case 1:return[2,!!e.sent().length]}}))}))},t}(qe.Y))),Ve=function(e){function t(t){var n=e.call(this)||this;return n.connection=t,n.options=t.options,n.isReplicated=!1,n.loadDependencies(),n}return(0,r.ZT)(t,e),t.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2]}))}))},t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2]}))}))},t.prototype.createQueryRunner=function(e){var t=this;return new Qe(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(function(e,n){return t.connection.logger.logQuery(e,n)}),this.options.serviceConfigOptions,this.options.formatOptions),e)},t.prototype.loadDependencies=function(){var e=je.Qm.load("typeorm-aurora-data-api-driver").pg;this.DataApiDriver=e},t.prototype.executeQuery=function(e,t){return this.connection.query(t)},t.prototype.afterConnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.checkMetadataForExtensions()];case 1:return(e=t.sent()).hasExtensions?[4,this.enableExtensions(e,this.connection)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,Promise.resolve()]}}))}))},t}(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t}(p.U4)),We=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new p.p$(e);case"postgres":return new p.U4(e);case"cockroachdb":return new p.J1(e);case"sap":return new p.tU(e);case"mariadb":return new p.p$(e);case"sqlite":return new p.Z7(e);case"better-sqlite3":return new p.R4(e);case"cordova":return new Me(e);case"nativescript":return new Oe(e);case"react-native":return new Re(e);case"sqljs":return new me.x(e);case"oracle":return new p.XR(e);case"mssql":return new p.Z0(e);case"mongodb":return new p.Qd(e);case"expo":return new _e(e);case"aurora-data-api":return new p.xI(e);case"aurora-data-api-pg":return new Ve(e);default:throw new ve(t)}},e}();function ze(e,t,n){return void 0===n&&(n=[".js",".cjs",".ts"]),[]}var Ke=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find((function(t){return t.type===e}));return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}());function Ze(e){return Ke.get(e)}var He,Xe=n(9693),Ye=function(){function e(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map((function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e}))).forEach((function(e){return n[e]=1}));else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map((function(e){return String(e)}))).forEach((function(e){return n[e]=1})):(r=Object.keys(i).map((function(e){return String(e)})),Object.keys(i).forEach((function(e){return n[e]=i[e]})))}this.columns=r.map((function(e){var n=t.entityMetadata.columns.find((function(t){return t.propertyPath===e}));if(n)return[n];var r=t.entityMetadata.relations.find((function(t){return t.isWithJoinColumn&&t.propertyName===e}));if(r)return r.joinColumns;var i=t.givenName?'"'+t.givenName+'" ':"",a=t.entityMetadata.targetName;throw new Error("Index "+i+"contains column that is missing in the entity ("+a+"): "+e)})).reduce((function(e,t){return e.concat(t)}))}return this.columnNamesWithOrderingMap=Object.keys(n).reduce((function(e,r){var i=t.entityMetadata.columns.find((function(e){return e.propertyPath===r}));return i&&(e[i.databasePath]=n[r]),e}),{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tablePath,this.columns.map((function(e){return e.databaseName})),this.where),this},e}(),$e=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("recover"),this.isPrimary=t.options.primary||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.orphanedRowAction=t.options.orphanedRowAction||"nullify",this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((function(e){return e.referencedColumn}));return ae.T.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((function(e){return e.referencedColumn}));if(t.length>1)throw new Error("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){if(this.embeddedMetadata){var n=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),i=function(e,t){var n=e.shift();return n?t[n]?i(e,t[n]):void 0:t},a=i(n,e);return this.isLazy?void 0!==a["__"+this.propertyName+"__"]?a["__"+this.propertyName+"__"]:!0===t?a[this.propertyName]:void 0:a?a[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n]=t,r)};return i((0,r.fl)(this.embeddedMetadata.embeddedMetadataTree),e)}e[n]=t},e.prototype.createValueMap=function(e){var t,n=this;if(this.embeddedMetadata){var i=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),a=function(t,r){var i=t.shift();return i?(r[i]={},a(t,r[i]),r):(r[n.propertyName]=e,r)};return a(i,{})}return(t={})[this.propertyName]=e,t},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,(0,r.fl)(t)),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),et=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach((function(t){return t.build(e)})),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw new Error("Invalid prefix option given for "+this.entityMetadata.targetName+"#"+this.propertyName)},e.prototype.buildPrefix=function(e){if(e.driver instanceof p.Qd)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push.apply(t,(0,r.fl)(this.buildPartialPrefix())),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildColumnsFromTree())}),this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationsFromTree())}),this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildListenersFromTree())}),this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildIndicesFromTree())}),this.indices)},e.prototype.buildUniquesFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildUniquesFromTree())}),this.uniques)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationIdsFromTree())}),this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationCountsFromTree())}),this.relationCounts)},e}(),tt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(Array.isArray(n))e[this.propertyName]=n.map((function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)})).filter((function(e){return null!=e}));else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),nt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),rt=function(){function e(){}return e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove",e}(),it=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter((function(e){return e.target&&-1!==t.indexOf(e.target)})):e},e}(),at=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map((function(e){return e.databaseName})),this.referencedColumnNames=this.referencedColumns.map((function(e){return e.databaseName})),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=e.foreignKeyName(this.entityMetadata.tablePath,this.columnNames,this.referencedTablePath,this.referencedColumnNames)},e}(),ot=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this,i=this.collectReferencedColumns(e,t),a=this.collectInverseReferencedColumns(e,t),o=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),s=new ae.T({connection:this.connection,args:{target:"",name:o,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});s.build();var u=i.map((function(r){var i=t.joinColumns?t.joinColumns.find((function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)})):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new Xe.T({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{name:a,length:r.length||!(n.connection.driver instanceof p.p$||n.connection.driver instanceof p.xI)||"uuid"!==r.generationStrategy&&"uuid"!==r.type?r.length:"36",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,nullable:!1,primary:!0}}})})),c=a.map((function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find((function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)})):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new Xe.T({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{length:r.length||!(n.connection.driver instanceof p.p$||n.connection.driver instanceof p.xI)||"uuid"!==r.generationStrategy&&"uuid"!==r.type?r.length:"36",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,name:a,nullable:!1,primary:!0}}})}));return this.changeDuplicatedColumnNames(u,c),s.ownerColumns=u,s.inverseColumns=c,s.ownColumns=(0,r.fl)(u,c),s.ownColumns.forEach((function(t){return t.relationMetadata=e})),s.foreignKeys=[new at({entityMetadata:s,referencedEntityMetadata:e.entityMetadata,columns:u,referencedColumns:i,onDelete:e.onDelete||"CASCADE"}),new at({entityMetadata:s,referencedEntityMetadata:e.inverseEntityMetadata,columns:c,referencedColumns:a,onDelete:e.onDelete||"CASCADE"})],s.ownIndices=[new Ye({entityMetadata:s,columns:u,args:{target:s.target,synchronize:!0}}),new Ye({entityMetadata:s,columns:c,args:{target:s.target,synchronize:!0}})],s},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find((function(e){return!!e.referencedColumnName}));return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter((function(e){return e.isPrimary})):t.joinColumns.map((function(t){var n=e.entityMetadata.columns.find((function(e){return e.propertyName===t.referencedColumnName}));if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n}))},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find((function(e){return!!e.referencedColumnName}));return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map((function(t){var n=e.inverseEntityMetadata.ownColumns.find((function(e){return e.propertyName===t.referencedColumnName}));if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n}))},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach((function(e){t.forEach((function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}}))}))},e}(),st=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new ae.T({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return n.build(),e.primaryColumns.forEach((function(r){n.ownColumns.push(new Xe.T({connection:t.connection,entityMetadata:n,closureType:"ancestor",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(r):r.propertyName+"_ancestor",options:{primary:!0,length:r.length,type:r.type}}})),n.ownColumns.push(new Xe.T({connection:t.connection,entityMetadata:n,closureType:"descendant",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(r):r.propertyName+"_descendant",options:{primary:!0,length:r.length,type:r.type}}}))})),n.ownIndices=[new Ye({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new Ye({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],e.treeLevelColumn&&n.ownColumns.push(new Xe.T({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new at({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns}),new at({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns})],n},e}(),ut=function(){function e(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map((function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e}))).forEach((function(e){return n[e]=1}));else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map((function(e){return String(e)}))).forEach((function(e){return n[e]=1})):(r=Object.keys(i).map((function(e){return String(e)})),Object.keys(i).forEach((function(e){return n[e]=i[e]})))}this.columns=r.map((function(e){var n=t.entityMetadata.columns.find((function(t){return t.propertyPath===e}));if(n)return[n];var r=t.entityMetadata.relations.find((function(t){return t.isWithJoinColumn&&t.propertyName===e}));if(r)return r.joinColumns;var i=t.givenName?'"'+t.givenName+'" ':"",a=t.entityMetadata.targetName;throw new Error("Unique constraint "+i+"contains column that is missing in the entity ("+a+"): "+e)})).reduce((function(e,t){return e.concat(t)}))}return this.columnNamesWithOrderingMap=Object.keys(n).reduce((function(e,r){var i=t.entityMetadata.columns.find((function(e){return e.propertyPath===r}));return i&&(e[i.databasePath]=n[r]),e}),{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tablePath,this.columns.map((function(e){return e.databaseName}))),this},e}(),ct=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(!n.length)return{foreignKey:void 0,uniqueConstraint:void 0};var r=this.collectColumns(e,t,n),i=new at({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if(this.connection.driver instanceof p.XR&&r.every((function(e){return e.isPrimary})))return{foreignKey:i,uniqueConstraint:void 0};if(n.length>0&&t.isOneToOne){var a=new ut({entityMetadata:t.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tablePath,i.columns.map((function(e){return e.databaseName}))),target:t.entityMetadata.target}});return a.build(this.connection.namingStrategy),{foreignKey:i,uniqueConstraint:a}}return{foreignKey:i,uniqueConstraint:void 0}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find((function(e){return!!e.referencedColumnName})),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map((function(e){var n=t.inverseEntityMetadata.ownColumns.find((function(t){return t.propertyName===e.referencedColumnName}));if(!n)throw new Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n}))},e.prototype.collectColumns=function(e,t,n){var r=this;return n.map((function(n){var i=e.find((function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)})),a=i?i.name:r.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),o=t.entityMetadata.ownColumns.find((function(e){return e.databaseName===a}));return o||(o=new Xe.T({connection:r.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:n.type,length:n.length||!(r.connection.driver instanceof p.p$||r.connection.driver instanceof p.xI)||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(o)),o.referencedColumn=n,o.type=n.type,o.relationMetadata=t,o.build(r.connection),o}))},e}(),lt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&e[n]&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),ht=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),pt=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),ft=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new ot(e),this.closureJunctionEntityMetadataBuilder=new st(e),this.relationJoinColumnBuilder=new ct(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter((function(e){return"regular"===e.type||"closure"===e.type||"entity-child"===e.type||"view"===e.type})).map((function(e){return t.createEntityMetadata(e)}));return n.forEach((function(e){return t.computeParentEntityMetadata(n,e)})),n.forEach((function(e){e.childEntityMetadatas=n.filter((function(t){return e.target instanceof Function&&t.target instanceof Function&&it.isInherited(t.target,e.target)}))})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){return e.build()})),n.filter((function(e){return"entity-child"===e.tableType})).forEach((function(e){return e.build()})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){return t.computeEntityMetadataStep1(n,e)})),n.filter((function(e){return"entity-child"===e.tableType})).forEach((function(e){return t.computeEntityMetadataStep1(n,e)})),n.forEach((function(e){return t.computeEntityMetadataStep2(e)})),n.forEach((function(e){return t.computeInverseProperties(e,n)})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){e.relations.filter((function(e){return e.isOneToOne||e.isManyToOne})).forEach((function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n),a=i.foreignKey,o=i.uniqueConstraint;if(a&&(n.registerForeignKeys(a),e.foreignKeys.push(a)),o)if(t.connection.driver instanceof p.p$||t.connection.driver instanceof p.xI||t.connection.driver instanceof p.Z0||t.connection.driver instanceof p.tU){var s=new Ye({entityMetadata:o.entityMetadata,columns:o.columns,args:{target:o.target,name:o.name,unique:!0,synchronize:!0}});t.connection.driver instanceof p.Z0&&(s.where=s.columns.map((function(e){return t.connection.driver.escape(e.databaseName)+" IS NOT NULL"})).join(" AND ")),n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}else n.embeddedMetadata?n.embeddedMetadata.uniques.push(o):n.entityMetadata.ownUniques.push(o),t.computeEntityMetadataStep2(e);a&&t.connection.driver instanceof p.J1&&(s=new Ye({entityMetadata:n.entityMetadata,columns:a.columns,args:{target:n.entityMetadata.target,synchronize:!0}}),n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e))})),e.relations.filter((function(e){return e.isManyToMany})).forEach((function(e){var i=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(i){var a=t.junctionEntityMetadataBuilder.build(e,i);e.registerForeignKeys.apply(e,(0,r.fl)(a.foreignKeys)),e.registerJunctionEntityMetadata(a),t.computeEntityMetadataStep2(a),t.computeInverseProperties(a,n),n.push(a)}}))})),n.forEach((function(e){e.relationsWithJoinColumns=e.relations.filter((function(e){return e.isWithJoinColumn})),e.hasNonNullableRelations=e.relationsWithJoinColumns.some((function(e){return!e.isNullable||e.isPrimary}))})),n.filter((function(e){return"closure-table"===e.treeType})).forEach((function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadataStep2(r),t.computeInverseProperties(r,n),n.push(r)})),n.filter((function(e){return"STI"===e.inheritancePattern&&e.discriminatorColumn})).forEach((function(e){return t.createKeysForTableInheritance(e)})),n.forEach((function(e){e.indices.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.uniques.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.checks.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.exclusions.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.filter((function(e){return e.target instanceof Function})).forEach((function(e){e.relations.filter((function(e){return e.isLazy})).forEach((function(n){t.connection.relationLoader.enableLazyLoad(n,e.target.prototype)}))})),n.forEach((function(e){e.columns.forEach((function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,"uuid"===r.strategy?n.type="uuid":"rowid"===r.strategy?n.type="int":n.type=n.type||Number,n.build(t.connection),t.computeEntityMetadataStep2(e))}))})),n},e.prototype.createEntityMetadata=function(e){var t,n=e.target instanceof Function?it.getInheritanceTree(e.target):[e.target],i=this.metadataArgsStorage.findInheritanceType(e.target),a=this.metadataArgsStorage.findTree(e.target);return(i&&"STI"===i.pattern||"entity-child"===e.type)&&(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map((function(e){return e.target})).filter((function(e){return e instanceof Function})),n.push.apply(n,(0,r.fl)(t))),new ae.T({connection:this.connection,args:e,inheritanceTree:n,tableTree:a,inheritancePattern:i?i.pattern:void 0})},e.prototype.computeParentEntityMetadata=function(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find((function(e){return-1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern})))},e.prototype.computeEntityMetadataStep1=function(e,t){var n,i,a,o=this,s=this.metadataArgsStorage.findInheritanceType(t.target),u=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=void 0!==u?u.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map((function(e){return"STI"===t.inheritancePattern&&(e.columns=e.columns.map((function(e){return e.isNullable=!0,e}))),e})),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map((function(n){if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find((function(e){return e.propertyName===n.propertyName}));var r=new Xe.T({connection:o.connection,entityMetadata:t,args:n});return e.find((function(e){return"entity-child"===e.tableType&&e.target===n.target}))&&(r.isNullable=!0),r})),s&&s.column){var c=s.column&&s.column.name?s.column.name:"type",l=t.ownColumns.find((function(e){return e.propertyName===c}));l?l.isDiscriminator=!0:((l=new Xe.T({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:c,options:s.column||{name:c,type:"varchar",nullable:!1}}})).isVirtual=!0,l.isDiscriminator=!0,t.ownColumns.push(l))}if("entity-child"===t.tableType){var h=t.parentEntityMetadata.ownColumns.find((function(e){return e.isDiscriminator}));h&&!t.ownColumns.find((function(e){return e===h}))&&t.ownColumns.push(h)}var f=this.connection.namingStrategy;if("materialized-path"===t.treeType)t.ownColumns.push(new Xe.T({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:f.materializedPathColumnName,type:"varchar",nullable:!0,default:""}}}));else if("nested-set"===t.treeType){var d=f.nestedSetColumnNames,m=d.left,y=d.right;t.ownColumns.push(new Xe.T({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:m,options:{name:m,type:"integer",nullable:!1,default:1}}})),t.ownColumns.push(new Xe.T({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:y,options:{name:y,type:"integer",nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.ownRelations.find((function(t){return t.propertyName===e.propertyName})):new $e({entityMetadata:t,args:e})})),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find((function(t){return t.propertyName===e.propertyName})):new tt({entityMetadata:t,args:e})})),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find((function(t){return t.propertyName===e.propertyName})):new nt({entityMetadata:t,args:e})})),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map((function(e){return new lt({entityMetadata:t,args:e})})),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map((function(e){return new ht({entityMetadata:t,args:e})})),this.connection.driver instanceof p.U4&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map((function(e){return new pt({entityMetadata:t,args:e})}))),this.connection.driver instanceof p.J1){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((function(e){return!e.unique})).map((function(e){return new Ye({entityMetadata:t,args:e})}));var v=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((function(e){return e.unique})).map((function(e){return new ut({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})}));(n=t.ownUniques).push.apply(n,(0,r.fl)(v))}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map((function(e){return new Ye({entityMetadata:t,args:e})}));if(this.connection.driver instanceof p.p$||this.connection.driver instanceof p.xI||this.connection.driver instanceof p.tU){var g=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((function(e){return new Ye({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})}));(i=t.ownIndices).push.apply(i,(0,r.fl)(g))}else v=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((function(e){return new ut({entityMetadata:t,args:e})})),(a=t.ownUniques).push.apply(a,(0,r.fl)(v))},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map((function(t){var r=new et({entityMetadata:e,args:t}),i=it.getInheritanceTree(r.type);return r.columns=n.metadataArgsStorage.filterColumns(i).map((function(t){return new Xe.T({connection:n.connection,entityMetadata:e,embeddedMetadata:r,args:t})})),r.relations=n.metadataArgsStorage.filterRelations(i).map((function(t){return new $e({entityMetadata:e,embeddedMetadata:r,args:t})})),r.listeners=n.metadataArgsStorage.filterListeners(i).map((function(t){return new lt({entityMetadata:e,embeddedMetadata:r,args:t})})),r.indices=n.metadataArgsStorage.filterIndices(i).map((function(t){return new Ye({entityMetadata:e,embeddedMetadata:r,args:t})})),r.uniques=n.metadataArgsStorage.filterUniques(i).map((function(t){return new ut({entityMetadata:e,embeddedMetadata:r,args:t})})),r.relationIds=n.metadataArgsStorage.filterRelationIds(i).map((function(t){return new tt({entityMetadata:e,args:t})})),r.relationCounts=n.metadataArgsStorage.filterRelationCounts(i).map((function(t){return new nt({entityMetadata:e,args:t})})),r.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i)),r.embeddeds.forEach((function(e){return e.parentEmbeddedMetadata=r})),e.allEmbeddeds.push(r),r}))},e.prototype.computeEntityMetadataStep2=function(e){var t=this;e.embeddeds.forEach((function(e){return e.build(t.connection)})),e.embeddeds.forEach((function(e){e.columnsFromTree.forEach((function(e){return e.build(t.connection)})),e.relationsFromTree.forEach((function(e){return e.build()}))})),e.ownColumns.forEach((function(e){return e.build(t.connection)})),e.ownRelations.forEach((function(e){return e.build()})),e.relations=e.embeddeds.reduce((function(e,t){return e.concat(t.relationsFromTree)}),e.ownRelations),e.eagerRelations=e.relations.filter((function(e){return e.isEager})),e.lazyRelations=e.relations.filter((function(e){return e.isLazy})),e.oneToOneRelations=e.relations.filter((function(e){return e.isOneToOne})),e.oneToManyRelations=e.relations.filter((function(e){return e.isOneToMany})),e.manyToOneRelations=e.relations.filter((function(e){return e.isManyToOne})),e.manyToManyRelations=e.relations.filter((function(e){return e.isManyToMany})),e.ownerOneToOneRelations=e.relations.filter((function(e){return e.isOneToOneOwner})),e.ownerManyToManyRelations=e.relations.filter((function(e){return e.isManyToManyOwner})),e.treeParentRelation=e.relations.find((function(e){return e.isTreeParent})),e.treeChildrenRelation=e.relations.find((function(e){return e.isTreeChildren})),e.columns=e.embeddeds.reduce((function(e,t){return e.concat(t.columnsFromTree)}),e.ownColumns),e.listeners=e.embeddeds.reduce((function(e,t){return e.concat(t.listenersFromTree)}),e.ownListeners),e.afterLoadListeners=e.listeners.filter((function(e){return e.type===rt.AFTER_LOAD})),e.afterInsertListeners=e.listeners.filter((function(e){return e.type===rt.AFTER_INSERT})),e.afterUpdateListeners=e.listeners.filter((function(e){return e.type===rt.AFTER_UPDATE})),e.afterRemoveListeners=e.listeners.filter((function(e){return e.type===rt.AFTER_REMOVE})),e.beforeInsertListeners=e.listeners.filter((function(e){return e.type===rt.BEFORE_INSERT})),e.beforeUpdateListeners=e.listeners.filter((function(e){return e.type===rt.BEFORE_UPDATE})),e.beforeRemoveListeners=e.listeners.filter((function(e){return e.type===rt.BEFORE_REMOVE})),e.indices=e.embeddeds.reduce((function(e,t){return e.concat(t.indicesFromTree)}),e.ownIndices),e.uniques=e.embeddeds.reduce((function(e,t){return e.concat(t.uniquesFromTree)}),e.ownUniques),e.primaryColumns=e.columns.filter((function(e){return e.isPrimary})),e.nonVirtualColumns=e.columns.filter((function(e){return!e.isVirtual})),e.ancestorColumns=e.columns.filter((function(e){return"ancestor"===e.closureType})),e.descendantColumns=e.columns.filter((function(e){return"descendant"===e.closureType})),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter((function(e){return e.isGenerated||e.isObjectId})),e.hasUUIDGeneratedColumns=e.columns.filter((function(e){return e.isGenerated||"uuid"===e.generationStrategy})).length>0,e.createDateColumn=e.columns.find((function(e){return e.isCreateDate})),e.updateDateColumn=e.columns.find((function(e){return e.isUpdateDate})),e.deleteDateColumn=e.columns.find((function(e){return e.isDeleteDate})),e.versionColumn=e.columns.find((function(e){return e.isVersion})),e.discriminatorColumn=e.columns.find((function(e){return e.isDiscriminator})),e.treeLevelColumn=e.columns.find((function(e){return e.isTreeLevel})),e.nestedSetLeftColumn=e.columns.find((function(e){return e.isNestedSetLeft})),e.nestedSetRightColumn=e.columns.find((function(e){return e.isNestedSetRight})),e.materializedPathColumn=e.columns.find((function(e){return e.isMaterializedPath})),e.objectIdColumn=e.columns.find((function(e){return e.isObjectId})),e.foreignKeys.forEach((function(e){return e.build(t.connection.namingStrategy)})),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach((function(e){return e.build()})),e.relationCounts.forEach((function(e){return e.build()})),e.embeddeds.forEach((function(e){e.relationIdsFromTree.forEach((function(e){return e.build()})),e.relationCountsFromTree.forEach((function(e){return e.build()}))}))},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach((function(n){var r=t.find((function(e){return e.target===n.type||"string"==typeof n.type&&e.targetName===n.type}));if(!r)throw new Error("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find((function(e){return e.propertyPath===n.inverseSidePropertyPath}))}))},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new Ye({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))},e}(),dt=function(){function e(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t}))},e.prototype.findTree=function(e){return this.trees.find((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterUniques=function(e){return this.uniques.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterChecks=function(e){return this.checks.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterExclusions=function(e){return this.exclusions.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find((function(n){return n.target===e&&n.propertyName===t}))},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter((function(n){return n.target===e&&n.propertyName===t}))},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e,t){return this.transactionEntityManagers.filter((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t}))},e.prototype.filterTransactionRepository=function(e,t){return this.transactionRepositories.filter((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t}))},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter((function(t){return t.target instanceof Function&&e instanceof Function&&it.isInherited(t.target,e)&&"entity-child"===t.type}))},e.prototype.findInheritanceType=function(e){return this.inheritances.find((function(t){return t.target===e}))},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find((function(t){return t.target===e}))},e.prototype.filterByTarget=function(e,t){return e.filter((function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t}))},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach((function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((function(t){return t.propertyName===e.propertyName}))||n.push(e))})),n},e.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(e,t){var n=[];return e.forEach((function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((function(t){return t.prefix===e.prefix&&t.propertyName===e.propertyName}))||n.push(e))})),n},e}(),mt=function(){function e(){}return e.prototype.transform=function(e){var t=new dt;return e.forEach((function(e){var n=e.options,i={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize,expression:n.expression};t.tables.push(i),Object.keys(n.columns).forEach((function(e){var r=n.columns[e],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.deleteDate&&(i="deleteDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel"),r.objectId&&(i="objectId");var a={target:n.target||n.name,mode:i,propertyName:e,options:{type:r.type,name:r.objectId?"_id":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,update:r.update,select:r.select,insert:r.insert,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer,spatialFeatureType:r.spatialFeatureType,srid:r.srid}};if(t.columns.push(a),r.generated){var o={target:n.target||n.name,propertyName:e,strategy:"string"==typeof r.generated?r.generated:"increment"};t.generations.push(o)}r.unique&&t.uniques.push({target:n.target||n.name,columns:[e]})})),n.relations&&Object.keys(n.relations).forEach((function(e){var i,a,o=n.relations[e],s={target:n.target||n.name,propertyName:e,relationType:o.type,isLazy:o.lazy||!1,type:o.target,inverseSideProperty:o.inverseSide,isTreeParent:o.treeParent,isTreeChildren:o.treeChildren,options:{eager:o.eager||!1,cascade:o.cascade,nullable:o.nullable,onDelete:o.onDelete,onUpdate:o.onUpdate,deferrable:o.deferrable,primary:o.primary,persistence:o.persistence}};if(t.relations.push(s),o.joinColumn)if("boolean"==typeof o.joinColumn){var u={target:n.target||n.name,propertyName:e};t.joinColumns.push(u)}else{var c=Array.isArray(o.joinColumn)?o.joinColumn:[o.joinColumn];try{for(var l=(0,r.XA)(c),h=l.next();!h.done;h=l.next()){var p=h.value;u={target:n.target||n.name,propertyName:e,name:p.name,referencedColumnName:p.referencedColumnName},t.joinColumns.push(u)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}}if(o.joinTable)if("boolean"==typeof o.joinTable){var f={target:n.target||n.name,propertyName:e};t.joinTables.push(f)}else f={target:n.target||n.name,propertyName:e,name:o.joinTable.name,database:o.joinTable.database,schema:o.joinTable.schema,joinColumns:o.joinTable.joinColumn?[o.joinTable.joinColumn]:o.joinTable.joinColumns,inverseJoinColumns:o.joinTable.inverseJoinColumn?[o.joinTable.inverseJoinColumn]:o.joinTable.inverseJoinColumns},t.joinTables.push(f)})),n.indices&&n.indices.forEach((function(e){var r={target:n.target||n.name,name:e.name,unique:!0===e.unique,spatial:!0===e.spatial,fulltext:!0===e.fulltext,parser:e.parser,synchronize:!1!==e.synchronize,where:e.where,sparse:e.sparse,columns:e.columns};t.indices.push(r)})),n.uniques&&n.uniques.forEach((function(e){var r={target:n.target||n.name,name:e.name,columns:e.columns};t.uniques.push(r)})),n.checks&&n.checks.forEach((function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.checks.push(r)})),n.exclusions&&n.exclusions.forEach((function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.exclusions.push(r)}))})),t},e}(),yt=n(8154),vt=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=(0,r.CR)(W.s.splitClassesAndStrings(e),2),n=t[0];return t[1],(0,r.fl)(n,ze(this.connection.logger)).map((function(e){return Ze(e)}))},e.prototype.buildSubscribers=function(e){var t=(0,r.CR)(W.s.splitClassesAndStrings(e||[]),2),n=t[0],i=(t[1],(0,r.fl)(n,ze(this.connection.logger)));return zt().filterSubscribers(i).map((function(e){return Ze(e.target)}))},e.prototype.buildEntityMetadatas=function(e){var t=(0,r.CR)(W.s.splitClassesAndStrings(e||[]),2),n=t[0],i=(t[1],n.filter((function(e){return e instanceof yt.I==0}))),a=n.filter((function(e){return e instanceof yt.I})),o=(0,r.fl)(i,ze(this.connection.logger));o.forEach((function(e){e instanceof yt.I&&(a.push(e),o.slice(o.indexOf(e),1))}));var s=new ft(this.connection,zt()).build(o),u=(new mt).transform(a),c=new ft(this.connection,u).build();return(0,r.fl)(s,c)},e}(),gt=n(7138),bt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("query: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),Et=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");je.Qm.logInfo("query:",je.Qm.highlightSql(r))}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");je.Qm.logError("query failed:",je.Qm.highlightSql(i)),je.Qm.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");je.Qm.logWarn("query is slow:",je.Qm.highlightSql(i)),je.Qm.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&je.Qm.log(e)},e.prototype.logMigration=function(e,t){je.Qm.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&je.Qm.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&je.Qm.logInfo("INFO:",t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(je.Qm.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),wt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t}(function(){function e(){}return e.prototype.logQuery=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logQueryError=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logQuerySlow=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logSchemaBuild=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logMigration=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.log=function(){throw new Error("This logger is not applicable in a browser context")},e}()),Tt=n(1300),Ct=n.n(Tt),Nt=function(){function e(){this.debugQueryLog=Ct()("typeorm:query:log"),this.debugQueryError=Ct()("typeorm:query:error"),this.debugQuerySlow=Ct()("typeorm:query:slow"),this.debugSchemaBuild=Ct()("typeorm:schema"),this.debugMigration=Ct()("typeorm:migration"),this.debugLog=Ct()("typeorm:log"),this.debugInfo=Ct()("typeorm:info"),this.debugWarn=Ct()("typeorm:warn")}return e.prototype.logQuery=function(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(je.Qm.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))},e.prototype.logQueryError=function(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(je.Qm.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))},e.prototype.logQuerySlow=function(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(je.Qm.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),Mt=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new bt(t);case"file":return new wt(t);case"advanced-console":return new Et(t);case"debug":return new Nt}return new Et(t)},e}(),At=function(){function e(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){if(e=this.connection.options.cache,"redis"===this.clientType)e&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient();else if("ioredis"===this.clientType)e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType)if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new Error("options.startupNodes required for "+this.clientType+".");this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}return[2]}))}))},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){e.client.quit((function(r,i){if(r)return n(r);t(),e.client=void 0}))}))]}))}))},e.prototype.synchronize=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2]}))}))},e.prototype.getFromCache=function(e,t){var n=this;return new Promise((function(t,r){e.identifier?n.client.get(e.identifier,(function(e,n){if(e)return r(e);t(JSON.parse(n))})):e.query?n.client.get(e.query,(function(e,n){if(e)return r(e);t(JSON.parse(n))})):t(void 0)}))},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var t=this;return(0,r.Jh)(this,(function(n){return[2,new Promise((function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,(function(e,t){if(e)return r(e);n()})):e.query&&t.client.set(e.query,JSON.stringify(e),"PX",e.duration,(function(e,t){if(e)return r(e);n()}))}))]}))}))},e.prototype.clear=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var e=this;return(0,r.Jh)(this,(function(t){return[2,new Promise((function(t,n){e.client.flushdb((function(e,r){if(e)return n(e);t()}))}))]}))}))},e.prototype.remove=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var t=this;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t.deleteKey(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype.deleteKey=function(e){var t=this;return new Promise((function(n,r){t.client.del(e,(function(e,t){if(e)return r(e);n()}))}))},e.prototype.loadRedis=function(){try{return"ioredis/cluster"===this.clientType?je.Qm.load("ioredis"):je.Qm.load(this.clientType)}catch(e){throw new Error("Cannot use cache because "+this.clientType+' is not installed. Please run "npm i '+this.clientType+' --save".')}},e}(),Rt=function(){function e(e){this.connection=e;var t=this.connection.driver.options,n=("object"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheTable=this.connection.driver.buildTableName(n,t.schema,t.database)}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2]}))}))},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2]}))}))},e.prototype.synchronize=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(this.queryResultCacheTable)];case 1:return n.sent()?[2]:[4,e.createTable(new o.i({name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return n.sent(),[2]}}))}))},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof p.Z0?new f(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?this.connection.driver instanceof p.XR?n.where("dbms_lob.compare("+n.escape("cache")+"."+n.escape("query")+", :query) = 0",{query:e.query}).getRawOne():n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof p.Z0?new f(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){var t="string"==typeof e.duration?parseInt(e.duration):e.duration;return("string"==typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=this.getQueryRunner(n),i=e,this.connection.driver instanceof p.Z0&&(i={identifier:new f(e.identifier,"nvarchar"),time:new f(e.time,"bigint"),duration:new f(e.duration,"int"),query:new f(e.query,"nvarchar"),result:new f(e.result,"nvarchar")}),t&&t.identifier?((a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i)).where(a.escape("identifier")+" = :condition",{condition:i.identifier}),[4,a.execute()]):[3,2];case 1:return r.sent(),[3,6];case 2:return t&&t.query?(a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i),this.connection.driver instanceof p.XR?a.where('dbms_lob.compare("query", :condition) = 0',{condition:i.query}):a.where(a.escape("query")+" = :condition",{condition:i.query}),[4,a.execute()]):[3,4];case 3:return r.sent(),[3,6];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(i).execute()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},e.prototype.clear=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){return[2,this.getQueryRunner(e).clearTable(this.queryResultCacheTable)]}))}))},e.prototype.remove=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,Promise.all(e.map((function(e){var r=n.getQueryRunner(t).manager.createQueryBuilder();return r.delete().from(n.queryResultCacheTable).where(r.escape("identifier")+" = :identifier",{identifier:e}).execute()})))];case 1:return r.sent(),[2]}}))}))},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner()},e}(),xt=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");var e=this.connection.options.cache;return e.provider&&"function"==typeof e.provider?e.provider(this.connection):"redis"===e.type||"ioredis"===e.type||"ioredis/cluster"===e.type?new At(this.connection,e.type):new Rt(this.connection)},e}(),Ot=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n):this.loadManyToManyNotOwner(e,t,n)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.entityMetadata.primaryColumns,a=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map((function(t){return e.entityMetadata.name+"."+t.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName})).join(" AND "),o=e.entityMetadata.name,s=this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,o,a);if(1===i.length)s.where(o+"."+i[0].propertyPath+" IN (:..."+o+"_"+i[0].propertyName+")"),s.setParameter(o+"_"+i[0].propertyName,r.map((function(e){return i[0].getEntityValue(e)})));else{var u=r.map((function(e,t){return i.map((function(n,r){var i=o+"_entity_"+t+"_"+r;return s.setParameter(i,n.getEntityValue(e)),o+"."+n.propertyPath+" = :"+i})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ");s.where(u)}return s.getMany()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.inverseRelation.joinColumns,o=this.connection.createQueryBuilder(n).select(i).from(e.inverseRelation.entityMetadata.target,i);if(1===a.length)o.where(i+"."+a[0].propertyPath+" IN (:..."+i+"_"+a[0].propertyName+")"),o.setParameter(i+"_"+a[0].propertyName,r.map((function(e){return a[0].referencedColumn.getEntityValue(e)})));else{var s=r.map((function(e,t){return a.map((function(n,r){var a=i+"_entity_"+t+"_"+r;return o.setParameter(a,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+a})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ");o.where(s)}return o.getMany()},e.prototype.loadManyToManyOwner=function(e,t,n){var i=Array.isArray(t)?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.joinColumns.map((function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"})),u=e.inverseJoinColumns.map((function(e){return o+"."+e.propertyName+"="+a+"."+e.referencedColumn.propertyName})),c=e.joinColumns.reduce((function(e,t){return e[t.propertyName]=i.map((function(e){return t.referencedColumn.getEntityValue(e)})),e}),{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,(0,r.fl)(s,u).join(" AND ")).setParameters(c).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t,n){var i=Array.isArray(t)?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.inverseRelation.joinColumns.map((function(e){return o+"."+e.propertyName+" = "+a+"."+e.referencedColumn.propertyName})),u=e.inverseRelation.inverseJoinColumns.map((function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"})),c=e.inverseRelation.inverseJoinColumns.reduce((function(e,t){return e[t.propertyName]=i.map((function(e){return t.referencedColumn.getEntityValue(e)})),e}),{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,(0,r.fl)(s,u).join(" AND ")).setParameters(c).getMany()},e.prototype.enableLazyLoad=function(e,t,n){var r=this,i="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",o="__has_"+e.propertyName+"__",s=function(e,t){return e[i]=t,e[o]=!0,delete e[a],t},u=function(e,t){return delete e[o],delete e[i],e[a]=t,t.then((function(n){return e[a]===t?s(e,n):n})),t};Object.defineProperty(t,e.propertyName,{get:function(){if(!0===this[o]||void 0!==this[i])return Promise.resolve(this[i]);if(this[a])return this[a];var t=r.load(e,this,n).then((function(t){return e.isOneToOne||e.isManyToOne?0===t.length?null:t[0]:t}));return u(this,t)},set:function(e){e instanceof Promise?u(this,e):s(this,e)},configurable:!0})},e}(),St=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n,i){return(0,r.mG)(this,void 0,void 0,(function(){var a,o,s,u;return(0,r.Jh)(this,(function(r){if(e instanceof $e)a=e,o=Array.isArray(t)?t:[t],s=Array.isArray(n)?n:n?[n]:void 0;else{if(u=this.connection.getMetadata(e),!(a=u.findRelationWithPropertyPath(t)))throw new Error('Relation "'+a+'" was not found in "'+u.name+'".');o=Array.isArray(n)?n:[n],s=Array.isArray(i)?i:i?[i]:void 0}return a.isManyToMany?[2,this.loadForManyToMany(a,o,s)]:a.isManyToOne||a.isOneToOneOwner?[2,this.loadForManyToOneAndOneToOneOwner(a,o,s)]:[2,this.loadForOneToManyAndOneToOneNotOwner(a,o,s)]}))}))},e.prototype.loadManyToManyRelationIdsAndGroup=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i,a,o,s,u,c;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return i=e.isManyToMany||e.isOneToMany,a=Array.isArray(t)?t:[t],n?[3,2]:[4,this.connection.relationLoader.load(e,t)];case 1:if(!(n=r.sent()).length)return[2,a.map((function(e){return{entity:e,related:i?[]:void 0}}))];r.label=2;case 2:return[4,this.load(e,t,n)];case 3:return o=r.sent(),s=Array.isArray(n)?n:[n],e.isManyToManyOwner?(u=e.junctionEntityMetadata.inverseColumns.map((function(e){return e.referencedColumn})),c=e.junctionEntityMetadata.ownerColumns.map((function(e){return e.referencedColumn}))):e.isManyToManyNotOwner?(u=e.junctionEntityMetadata.ownerColumns.map((function(e){return e.referencedColumn})),c=e.junctionEntityMetadata.inverseColumns.map((function(e){return e.referencedColumn}))):e.isManyToOne||e.isOneToOneOwner?(u=e.joinColumns.map((function(e){return e.referencedColumn})),c=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(u=e.inverseRelation.entityMetadata.primaryColumns,c=e.inverseRelation.joinColumns.map((function(e){return e.referencedColumn}))),[2,a.map((function(t){var n={entity:t,related:i?[]:void 0};return o.forEach((function(r){c.every((function(e){return e.getEntityValue(t)===r[e.entityMetadata.name+"_"+e.propertyPath.replace(".","_")]}))&&s.forEach((function(t){u.every((function(n){return n.getEntityValue(t)===r[n.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+n.propertyPath.replace(".","_")]}))&&(i?n.related.push(t):n.related=t)}))})),n}))]}}))}))},e.prototype.loadForManyToMany=function(e,t,n){var r=e.junctionEntityMetadata,i=r.name,a=e.isOwning?r.ownerColumns:r.inverseColumns,o=e.isOwning?r.inverseColumns:r.ownerColumns,s=this.connection.createQueryBuilder();r.ownerColumns.forEach((function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+e.propertyPath,t)})),r.inverseColumns.forEach((function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+t.propertyPath,n)}));var u="";1===a.length?(s.setParameter("values1",t.map((function(e){return a[0].referencedColumn.getEntityValue(e)}))),u=i+"."+a[0].propertyPath+" IN (:...values1)"):u="("+t.map((function(e,t){return a.map((function(n){var r="entity1_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ")+")";var c="";return n&&(1===o.length?(s.setParameter("values2",n.map((function(e){return o[0].referencedColumn.getEntityValue(e)}))),c=i+"."+o[0].propertyPath+" IN (:...values2)"):c="("+n.map((function(e,t){return o.map((function(n){var r="entity2_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ")+")"),s.from(r.target,i).where(u+(c?" AND "+c:"")).getRawMany()},e.prototype.loadForManyToOneAndOneToOneOwner=function(e,t,n){var r=e.entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((function(e){var t=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)})),e.joinColumns.forEach((function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)}));var a="";return 1===e.entityMetadata.primaryColumns.length?(i.setParameter("values",t.map((function(t){return e.entityMetadata.primaryColumns[0].getEntityValue(t)}))),a=r+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)"):a=t.map((function(t,n){return e.entityMetadata.primaryColumns.map((function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e.prototype.loadForOneToManyAndOneToOneNotOwner=function(e,t,n){var r=(e=e.inverseRelation).entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((function(t){var n=t.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+t.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)})),e.joinColumns.forEach((function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)}));var a="";return 1===e.joinColumns.length?(i.setParameter("values",t.map((function(t){return e.joinColumns[0].referencedColumn.getEntityValue(t)}))),a=r+"."+e.joinColumns[0].propertyPath+" IN (:...values)"):a=t.map((function(t,n){return e.joinColumns.map((function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.referencedColumn.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e}(),Pt=n(3587),It=function(){function e(e){this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new Mt).create(this.options.logger,this.options.logging),this.driver=(new We).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new s,this.queryResultCache=e.cache?new xt(this).create():void 0,this.relationLoader=new Ot(this),this.relationIdLoader=new St(this),this.isConnected=!1}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof p.$2))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof de))throw new Error("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:if(this.isConnected)throw new c(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:pe.g.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations({transaction:this.options.migrationsTransactionMode})]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}}))}))},e.prototype.close=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:if(!this.isConnected)throw new u(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return pe.g.assign(this,{isConnected:!1}),[2]}}))}))},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:if(!this.isConnected)throw new u(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return t.sent(),[2]}}))}))},e.prototype.dropDatabase=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:e=this.createQueryRunner(),c.label=1;case 1:if(c.trys.push([1,,13,15]),!(this.driver instanceof p.Z0||this.driver instanceof p.p$||this.driver instanceof p.xI))return[3,10];t=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach((function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)})),c.label=2;case 2:c.trys.push([2,7,8,9]),n=(0,r.XA)(t),i=n.next(),c.label=3;case 3:return i.done?[3,6]:(a=i.value,[4,e.clearDatabase(a)]);case 4:c.sent(),c.label=5;case 5:return i=n.next(),[3,3];case 6:return[3,9];case 7:return o=c.sent(),s={error:o},[3,9];case 8:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 9:return[3,12];case 10:return[4,e.clearDatabase()];case 11:c.sent(),c.label=12;case 12:return[3,15];case 13:return[4,e.release()];case 14:return c.sent(),[7];case 15:return[2]}}))}))},e.prototype.runMigrations=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new u(this.name);return(t=new d(this)).transaction=e&&e.transaction||"all",[4,t.executePendingMigrations()];case 1:return[2,n.sent()]}}))}))},e.prototype.undoLastMigration=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new u(this.name);return(t=new d(this)).transaction=e&&e.transaction||"all",[4,t.undoLastMigration()];case 1:return n.sent(),[2]}}))}))},e.prototype.showMigrations=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:if(!this.isConnected)throw new u(this.name);return[4,new d(this).showMigrations()];case 1:return[2,e.sent()]}}))}))},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new l(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof p.Qd))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){return[2,this.manager.transaction(e,t)]}))}))},e.prototype.query=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(this instanceof p.$2)throw new Error("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new C;i=n||this.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,i.query(e,t)];case 2:return[2,r.sent()];case 3:return n?[3,5]:[4,i.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof p.$2)throw new Error("Query Builder is not supported by MongoDB.");if(t){var r=this.getMetadata(e);return new gt.Z(this,n).select(t).from(r.target,t)}return new gt.Z(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Error('Relation "'+t+'" was not found in '+e+" entity.");if(!n.isManyToMany)throw new Error('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new ye).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find((function(t){return t.target===e||(e instanceof yt.I?t.name===e.options.name:"string"==typeof e&&(-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e))}))},e.prototype.buildMetadatas=function(){var e=new vt(this),t=new T,n=e.buildSubscribers(this.options.subscribers||[]);pe.g.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[]);pe.g.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);pe.g.assign(this,{migrations:i}),this.driver.database=this.getDatabaseName(),t.validateMany(this.entityMetadatas.filter((function(e){return"view"!==e.tableType})),this.driver)},e.prototype.getDatabaseName=function(){var e=this.options;switch(e.type){case"mysql":case"mariadb":case"postgres":case"cockroachdb":case"mssql":case"oracle":return Pt.z.buildDriverOptions(e.replication?e.replication.master:e).database;default:return Pt.z.buildDriverOptions(e).database}},e}(),_t=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message='Connection "'+n+'" was not found.',r}return(0,r.ZT)(t,e),t}(Error),jt=function(e){function t(n){var r=e.call(this)||this;return r.name="AlreadyHasActiveConnectionError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a new connection named "'+n+'", because connection with such name already exist and it now has an active connection session.',r}return(0,r.ZT)(t,e),t}(Error),qt=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find((function(t){return t.name===e}))},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find((function(t){return t.name===e}));if(!t)throw new _t(e);return t},e.prototype.create=function(e){var t=this.connections.find((function(t){return t.name===(e.name||"default")}));if(t){if(t.isConnected)throw new jt(e.name||"default");this.connections.splice(this.connections.indexOf(t),1)}var n=new It(e);return this.connections.push(n),n},e}(),Dt=function(){function e(){}return e.prototype.all=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Cannot read connection options in a browser context.")}))}))},e.prototype.get=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Cannot read connection options in a browser context.")}))}))},e.prototype.has=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){throw new Error("Cannot read connection options in a browser context.")}))}))},e}(),Lt=function(e){function t(n,r){var i=e.call(this)||this;return i.name="ColumnTypeUndefinedError",Object.setPrototypeOf(i,t.prototype),i.message="Column type for "+n.constructor.name+"#"+r+' is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.',i}return(0,r.ZT)(t,e),t}(Error);function Bt(e,t){return function(n,r){var i;"string"==typeof e||e instanceof Function?i=e:e&&(t=e,i=e.type),t||(t={});var a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),"hstore"!==t.type||t.hstoreType||(t.hstoreType=a===Object?"object":"string"),e instanceof Function)zt().embeddeds.push({target:n.constructor,propertyName:r,isArray:a===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:e});else{if(!t.type)throw new Lt(n,r);!0===t.unique&&zt().uniques.push({target:n.constructor,columns:[r]}),zt().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&zt().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}function Ut(e){return function(t,n){zt().columns.push({target:t.constructor,propertyName:n,mode:"createDate",options:e||{}})}}function Ft(e,t){var n,r={};return e?("string"==typeof e&&(n=e),e instanceof Object&&(n="increment",Object.assign(r,e))):n="increment",t instanceof Object&&Object.assign(r,t),function(e,t){r.type||("increment"===n?r.type=Number:"uuid"===n?r.type="uuid":"rowid"===n&&(r.type="int")),r.primary=!0,zt().columns.push({target:e.constructor,propertyName:t,mode:"regular",options:r}),zt().generations.push({target:e.constructor,propertyName:t,strategy:n})}}function Jt(e){return function(t,n){zt().columns.push({target:t.constructor,propertyName:n,mode:"updateDate",options:e||{}})}}function kt(){return function(e,t){zt().entityListeners.push({target:e.constructor,propertyName:t,type:rt.BEFORE_INSERT})}}function Gt(e){return function(t,n){(Array.isArray(e)?e:[e||{}]).forEach((function(e){zt().joinColumns.push({target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName})}))}}function Qt(e,t,n){var r;return"object"==typeof t?n=t:r=t,function(t,i){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}zt().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function Vt(e,t,n){return function(r,i){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",r,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}zt().relations.push({target:r.constructor,propertyName:i,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n})}}function Wt(e,t){var n=("object"==typeof e?e:t)||{},r="string"==typeof e?e:n.name;return function(e){zt().tables.push({target:e,name:r,type:"regular",orderBy:n.orderBy?n.orderBy:void 0,engine:n.engine?n.engine:void 0,database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:n.synchronize,withoutRowid:n.withoutRowid})}}function zt(){var e=je.Qm.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new dt),e.typeormMetadataArgsStorage}function Kt(e){return void 0===e&&(e="default"),(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){return[2,(new Dt).get(e)]}))}))}function Zt(){return Ze(qt)}function Ht(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t="string"==typeof e?e:"default",e instanceof Object?(i=e,[3,3]):[3,1];case 1:return[4,Kt(t)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,Zt().create(n).connect()]}}))}))}function Xt(e){return void 0===e&&(e="default"),Zt().get(e)}He=Error,(0,r.ZT)((function e(t,n){var r=He.call(this)||this;return r.name="PrimaryColumnCannotBeNullableError",Object.setPrototypeOf(r,e.prototype),r.message="Primary column "+t.constructor.name+"#"+n+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",r}),He),function(e){(0,r.ZT)((function t(n,r){var i=e.call(this)||this;return i.name="CannotReflectMethodParameterTypeError",Object.setPrototypeOf(i,t.prototype),i.message='Cannot get reflected type for a "'+r+'" method\'s parameter of "'+n.name+'" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.',i}),e)}(Error),n(7979),n(2410),function(){function e(){}e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(e){return this.constructor.getRepository().save(this,e)},e.prototype.remove=function(e){return this.constructor.getRepository().remove(this,e)},e.prototype.softRemove=function(e){return this.constructor.getRepository().softRemove(this,e)},e.prototype.recover=function(e){return this.constructor.getRepository().recover(this,e)},e.prototype.reload=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,(e=this.constructor).getRepository().findOneOrFail(e.getId(this))];case 1:return t=n.sent(),pe.g.assign(this,t),[2]}}))}))},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||Xt()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.getRepository()).merge.apply(t,(0,r.fl)([e],n))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.softRemove=function(e,t){return this.getRepository().softRemove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.findOneOrFail=function(e,t){return this.getRepository().findOneOrFail(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()}}(),n(3404),n(5100),n(5586),n(7938),n(9783),n(7543),n(1920),n(5547),n(7296)},9693:(e,t,n)=>{"use strict";n.d(t,{T:()=>u});var r=n(518),i=n(8731),a=n(5585),o=n(7979),s=n(7718),u=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.comment="",this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),void 0!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter((function(e){return isNaN(+e)})).map((function(t){return e.args.options.enum[t]})):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isDeleteDate="deleteDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),void 0===this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}return e.prototype.createValueMap=function(e,t){var n,i=this;if(void 0===t&&(t=!1),this.embeddedMetadata){var a=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),o=function(n,r){var a=n.shift();return a?(r[a]={},o(n,r[a]),r):("increment"!==i.generationStrategy&&"rowid"!==i.generationStrategy||"bigint"!==i.type||null===e||(e=String(e)),r[t?i.databaseName:i.propertyName]=e,r)};return o(a,{})}return"increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||null===e||(e=String(e)),(n={})[t?this.databaseName:this.propertyName]=e,n},e.prototype.getEntityValueMap=function(e,t){var n,a,o=this;if(this.embeddedMetadata){var s=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),u=function(e,t,n){var r=e.shift();if(void 0===t)return n;if(r){var i={};return u(e,t[r],i),Object.keys(i).length>0&&(n[r]=i),n}return void 0!==t[o.propertyName]&&(n[o.propertyName]=t[o.propertyName]),n};return u(s,e,c={}),Object.keys(c).length>0?c:void 0}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var c=this.relationMetadata.joinColumns.reduce((function(t,n){var r=n.referencedColumn.getEntityValueMap(e[o.propertyName]);return void 0===r?t:i.s.mergeDeep(t,r)}),{});return Object.keys(c).length>0?((n={})[this.propertyName]=c,n):void 0}return void 0!==e[this.propertyName]?((a={})[this.propertyName]=e[this.propertyName],a):void 0},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){var n=void 0;if(this.embeddedMetadata){var i=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),a=function(e,t){var n=e.shift();return n&&t?a(e,t[n]):t},u=a(i,e);u&&(n=this.relationMetadata&&this.referencedColumn?(c=this.relationMetadata.getEntityValue(u))&&c instanceof Object&&!(c instanceof o.J)?this.referencedColumn.getEntityValue(c):u[this.propertyName]&&u[this.propertyName]instanceof Object&&!(u[this.propertyName]instanceof o.J)?this.referencedColumn.getEntityValue(u[this.propertyName]):u[this.propertyName]:this.referencedColumn?this.referencedColumn.getEntityValue(u[this.propertyName]):u[this.propertyName])}else{var c;n=this.relationMetadata&&this.referencedColumn?!((c=this.relationMetadata.getEntityValue(e))&&c instanceof Object)||c instanceof o.J||c instanceof Function?!(e[this.propertyName]&&e[this.propertyName]instanceof Object)||e[this.propertyName]instanceof o.J||e[this.propertyName]instanceof Function?e[this.propertyName]:this.referencedColumn.getEntityValue(e[this.propertyName]):this.referencedColumn.getEntityValue(c):this.referencedColumn?this.referencedColumn.getEntityValue(e[this.propertyName]):e[this.propertyName]}return t&&this.transformer&&(n=s.A.transformTo(this.transformer,n)),n}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n.propertyName]=t,r)};return i((0,r.fl)(this.embeddedMetadata.embeddedMetadataTree),e)}!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=t):e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof a.Qd&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}()},7837:(e,t,n)=>{"use strict";n.d(t,{T:()=>u});var r=n(518),i=n(5585),a=function(e){function t(n,r){var i=e.call(this)||this;i.name="CannotCreateEntityIdMapError",Object.setPrototypeOf(i,t.prototype);var a=n.primaryColumns.reduce((function(e,t,n){return t.setEntityValue(e,n+1),e}),{});return i.message='Cannot use given entity id "'+r+'" because "'+n.targetName+'" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(a)+" as an id.",i}return(0,r.ZT)(t,e),t}(Error),o=n(8731),s=n(3169),u=function(){function e(e){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid}return e.prototype.create=function(e){var t,n=this;if(this.target instanceof Function)return t=new this.target,this.lazyRelations.forEach((function(r){return n.connection.relationLoader.enableLazyLoad(r,t,e)})),t;var r={};return this.lazyRelations.forEach((function(t){return n.connection.relationLoader.enableLazyLoad(t,r,e)})),r},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every((function(t){var n=t.getEntityValue(e);return null!=n&&""!==n}))},e.prototype.hasAllPrimaryKeys=function(e){return this.primaryColumns.every((function(t){return null!=t.getEntityValue(e)}))},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new a(this,e);return this.primaryColumns[0].createValueMap(e)},e.prototype.getEntityIdMap=function(t){if(t)return e.getValueMap(t,this.primaryColumns,{skipNulls:!0})},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t},e.prototype.compareEntities=function(e,t){var n=this.getEntityIdMap(e);if(!n)return!1;var r=this.getEntityIdMap(t);return!!r&&o.s.compareIds(n,r)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find((function(t){return t.propertyName===e}))},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find((function(t){return t.databaseName===e}))},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find((function(t){return t.propertyPath===e}));if(t)return t;var n=this.relations.find((function(t){return t.propertyPath===e}));return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find((function(t){return t.propertyPath===e}));if(t)return[t];var n=this.relations.find((function(t){return t.propertyPath===e}));return n&&n.joinColumns?n.joinColumns:[]},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find((function(t){return t.propertyPath===e}))},e.prototype.hasEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.some((function(t){return t.propertyPath===e}))},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find((function(t){return t.propertyPath===e}))},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=this,r=[];return t.forEach((function(t){var i=t.getEntityValue(e);Array.isArray(i)?i.forEach((function(e){return r.push([t,e,n.getInverseEntityMetadata(e,t)])})):i&&r.push([t,i,n.getInverseEntityMetadata(i,t)])})),r},e.prototype.getInverseEntityMetadata=function(e,t){return t.inverseEntityMetadata.childEntityMetadatas.find((function(t){return t.target===e.constructor}))||t.inverseEntityMetadata},e.createPropertyPath=function(e,t,n){var i=this;void 0===n&&(n="");var a=[];return Object.keys(t).forEach((function(o){var s=n?n+"."+o:o;if(e.hasEmbeddedWithPropertyPath(s)){var u=i.createPropertyPath(e,t[o],s);a.push.apply(a,(0,r.fl)(u))}else{var c=n?n+"."+o:o;a.push(c)}})),a},e.difference=function(e,t){return e.filter((function(e){return!t.find((function(t){return o.s.compareIds(e,t)}))}))},e.getValueMap=function(e,t,n){return t.reduce((function(t,r){var i=r.getEntityValueMap(e,n);if(void 0!==t&&null!=i)return r.isObjectId?Object.assign(t,i):o.s.mergeDeep(t,i)}),{})},e.prototype.build=function(){var e=this.connection.namingStrategy,t=this.connection.options.entityPrefix;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:this.schema=this.connection.options.schema,this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=(0,s.OV)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=t?e.prefixTableName(t,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.buildTablePath(),this.schemaPath=this.buildSchemaPath(),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type},e.prototype.registerColumn=function(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce((function(e,t){return e.concat(t.columnsFromTree)}),this.ownColumns),this.primaryColumns=this.columns.filter((function(e){return e.isPrimary})),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter((function(e){return e.isGenerated||"uuid"===e.generationStrategy})).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach((function(t){return t.registerColumn(e)})))},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach((function(t){return o.s.mergeDeep(e,t.createValueMap(t.propertyPath))})),this.relations.forEach((function(t){return o.s.mergeDeep(e,t.createValueMap(t.propertyPath))})),e},e.prototype.buildTablePath=function(){var e=this.tableName;return this.schema&&(this.connection.driver instanceof i.XR||this.connection.driver instanceof i.U4||this.connection.driver instanceof i.Z0||this.connection.driver instanceof i.tU)&&(e=this.schema+"."+e),!this.database||this.connection.driver instanceof i.U4||(e=!this.schema&&this.connection.driver instanceof i.Z0?this.database+".."+e:this.database+"."+e),e},e.prototype.buildSchemaPath=function(){if(this.schema)return!this.database||this.connection.driver instanceof i.U4?this.schema:this.database+"."+this.schema},e}()},5585:(e,t,n)=>{"use strict";n.d(t,{Qd:()=>r,En:()=>i,$2:()=>a,yX:()=>o,U4:()=>s,xI:()=>u,J1:()=>c,Z0:()=>l,tU:()=>h,p$:()=>p,XR:()=>f,Z7:()=>d,R4:()=>m});var r=function(){},i=function(){},a=function(){},o=function(){},s=function(){},u=function(){},c=function(){},l=function(){},h=function(){},p=function(){},f=function(){},d=function(){},m=function(){}},1649:(e,t,n)=>{"use strict";n.d(t,{Qm:()=>r});var r=function(){function e(){}return e.getGlobalVariable=function(){return"undefined"!=typeof window?window:n.g},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormalize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.dotenv=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "'+e+'" }).')},e.getEnvVariable=function(e){},e.readFileSync=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},e.appendFileSync=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},e.writeFile=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},e.highlightSql=function(e){return e},e.highlightJson=function(e){return e},e.logInfo=function(e,t){console.info(e+" ",t)},e.logError=function(e,t){console.error(e+" ",t)},e.logWarn=function(e,t){console.warn(e+" ",t)},e.log=function(e){console.log(e)},e.warn=function(e){return e},e.type="browser",e}();"undefined"!=typeof window&&(window.Buffer=n(9300).Buffer),void 0!==n.g&&(n.g.Buffer=n(9300).Buffer)},7543:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var r=function(e){this.whereFactory=e}},5100:(e,t,n)=>{"use strict";n.d(t,{T:()=>h});var r=n(518),i=n(5585),a=n(3404),o=n(7296),s=n(6572),u=n(8529),c=n(3730),l=n(9878),h=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createDeleteExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,a,s,l,h,p,f,d;return(0,r.Jh)(this,(function(m){switch(m.label){case 0:e=(0,r.CR)(this.getQueryAndParameters(),2),t=e[0],n=e[1],a=this.obtainQueryRunner(),s=!1,m.label=1;case 1:return m.trys.push([1,11,16,21]),!0!==this.expressionMap.useTransaction||!1!==a.isTransactionActive?[3,3]:[4,a.startTransaction()];case 2:m.sent(),s=!0,m.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(f=new c.D,a.broadcaster.broadcastBeforeRemoveEvent(f,this.expressionMap.mainAlias.metadata),f.promises.length>0?[4,Promise.all(f.promises)]:[3,5]):[3,5];case 4:m.sent(),m.label=5;case 5:return l=new o.y,[4,a.query(t,n)];case 6:return h=m.sent(),(p=a.connection.driver)instanceof i.p$||p instanceof i.xI?(l.raw=h,l.affected=h.affectedRows):p instanceof i.Z0||p instanceof i.U4||p instanceof i.J1?(l.raw=h[0]?h[0]:null,l.affected="number"==typeof h[1]?h[1]:null):p instanceof i.XR?l.affected=h:p instanceof i.R4?(l.raw=h,l.affected=h.changes):l.raw=h,!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(f=new c.D,a.broadcaster.broadcastAfterRemoveEvent(f,this.expressionMap.mainAlias.metadata),f.promises.length>0?[4,Promise.all(f.promises)]:[3,8]):[3,8];case 7:m.sent(),m.label=8;case 8:return s?[4,a.commitTransaction()]:[3,10];case 9:m.sent(),m.label=10;case 10:return[2,l];case 11:if(d=m.sent(),!s)return[3,15];m.label=12;case 12:return m.trys.push([12,14,,15]),[4,a.rollbackTransaction()];case 13:case 14:return m.sent(),[3,15];case 15:throw d;case 16:return a===this.queryRunner?[3,18]:[4,a.release()];case 17:m.sent(),m.label=18;case 18:return this.connection.driver instanceof u.x&&!a.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,20];case 19:m.sent(),m.label=20;case 20:return[7];case 21:return[2]}}))}))},t.prototype.from=function(e,t){e=e instanceof l.IU?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new s.y;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression();return n&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof i.J1)?"DELETE FROM "+e+t+" RETURNING "+n:""!==n&&this.connection.driver instanceof i.Z0?"DELETE FROM "+e+" OUTPUT "+n+t:"DELETE FROM "+e+t},t}(a.z)},5586:(e,t,n)=>{"use strict";n.d(t,{O:()=>m});var r=n(518),i=n(5585),a=n(3404),o=n(2972),s=n(1920),u=n(6572),c=function(e){function t(){var n=e.call(this)||this;return n.name="InsertValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.',n}return(0,r.ZT)(t,e),t}(Error),l=n(4324),h=n(3781),p=n(8529),f=n(3730),d=n(8154),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createInsertExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,a,o,u,c,h,d,m,y,v,g,b,E,w=this;return(0,r.Jh)(this,(function(T){switch(T.label){case 0:if(0===(e=this.getValueSets()).length)return[2,new s.t];t=this.obtainQueryRunner(),n=!1,T.label=1;case 1:return T.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==t.isTransactionActive?[3,3]:[4,t.startTransaction()];case 2:T.sent(),n=!0,T.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(a=new f.D,e.forEach((function(e){t.broadcaster.broadcastBeforeInsertEvent(a,w.expressionMap.mainAlias.metadata,e)})),a.promises.length>0?[4,Promise.all(a.promises)]:[3,5]):[3,5];case 4:T.sent(),T.label=5;case 5:return o=null,u=null,c=new l.v(t,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver instanceof i.XR||(this.expressionMap.extraReturningColumns=c.getInsertionReturningColumns()),this.expressionMap.extraReturningColumns.length>0&&this.connection.driver instanceof i.Z0&&(o=this.connection.driver.buildTableVariableDeclaration("@OutputTable",this.expressionMap.extraReturningColumns),u="SELECT * FROM @OutputTable")),h=(0,r.CR)(this.getQueryAndParameters(),2),d=h[0],m=h[1],y=new s.t,v=[o,d,u],g=y,[4,t.query(v.filter((function(e){return null!=e})).join(";\n\n"),m)];case 6:return g.raw=T.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,c.insert(y,e)]:[3,8];case 7:T.sent(),T.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(b=new f.D,e.forEach((function(e){t.broadcaster.broadcastAfterInsertEvent(b,w.expressionMap.mainAlias.metadata,e)})),b.promises.length>0?[4,Promise.all(b.promises)]:[3,10]):[3,10];case 9:T.sent(),T.label=10;case 10:return n?[4,t.commitTransaction()]:[3,12];case 11:T.sent(),T.label=12;case 12:return[2,y];case 13:if(E=T.sent(),!n)return[3,17];T.label=14;case 14:return T.trys.push([14,16,,17]),[4,t.rollbackTransaction()];case 15:case 16:return T.sent(),[3,17];case 17:throw E;case 18:return t===this.queryRunner?[3,20]:[4,t.release()];case 19:T.sent(),T.label=20;case 20:return this.connection.driver instanceof p.x&&!t.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:T.sent(),T.label=22;case 22:return[7];case 23:return[2]}}))}))},t.prototype.into=function(e,t){e=e instanceof d.I?e.options.name:e;var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new u.y;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.orIgnore=function(e){return void 0===e&&(e=!0),this.expressionMap.onIgnore=e,this},t.prototype.orUpdate=function(e){return this.expressionMap.onUpdate={},e&&Array.isArray(e.conflict_target)&&(this.expressionMap.onUpdate.conflict=" ( "+e.conflict_target.join(", ")+" ) "),e&&"string"==typeof e.conflict_target&&(this.expressionMap.onUpdate.conflict=" ON CONSTRAINT "+e.conflict_target+" "),e&&Array.isArray(e.columns)&&(this.expressionMap.onUpdate.columns=e.columns.map((function(e){return e+" = :"+e})).join(", ")),e&&Array.isArray(e.overwrite)&&(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI?this.expressionMap.onUpdate.overwrite=e.overwrite.map((function(e){return e+" = VALUES("+e+")"})).join(", "):(this.connection.driver instanceof i.U4||this.connection.driver instanceof h.w||this.connection.driver instanceof i.J1)&&(this.expressionMap.onUpdate.overwrite=e.overwrite.map((function(e){return e+" = EXCLUDED."+e})).join(", "))),this},t.prototype.createInsertExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n=this.connection.driver instanceof i.XR&&this.getValueSets().length>1?null:this.createReturningExpression(),r=this.createColumnNamesExpression(),a="INSERT ";if((this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)&&(a+=this.expressionMap.onIgnore?" IGNORE ":""),a+="INTO "+e,r?a+="("+r+")":!t&&(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)&&(a+="()"),n&&this.connection.driver instanceof i.Z0&&(a+=" OUTPUT "+n),t?this.connection.driver instanceof i.XR&&this.getValueSets().length>1?a+=" "+t:a+=" VALUES "+t:this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI?a+=" VALUES ()":a+=" DEFAULT VALUES",this.connection.driver instanceof i.U4||this.connection.driver instanceof h.w||this.connection.driver instanceof i.J1){if(a+=this.expressionMap.onIgnore?" ON CONFLICT DO NOTHING ":"",a+=this.expressionMap.onConflict?" ON CONFLICT "+this.expressionMap.onConflict:"",this.expressionMap.onUpdate){var o=this.expressionMap.onUpdate,s=o.overwrite,u=o.columns,c=o.conflict;a+=u?" ON CONFLICT "+c+" DO UPDATE SET "+u:"",a+=s?" ON CONFLICT "+c+" DO UPDATE SET "+s:""}}else if((this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)&&this.expressionMap.onUpdate){var l=this.expressionMap.onUpdate;s=l.overwrite,a+=(u=l.columns)?" ON DUPLICATE KEY UPDATE "+u:"",a+=s?" ON DUPLICATE KEY UPDATE "+s:""}return n&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof i.XR||this.connection.driver instanceof i.J1)&&(a+=" RETURNING "+n),a},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter((function(t){return e.expressionMap.insertColumns.length?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):!!t.isInsert&&(!t.isGenerated||"increment"!==t.generationStrategy||e.connection.driver instanceof i.XR||e.connection.driver instanceof h.w||e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI)})):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(t.length>0)return t.map((function(t){return e.escape(t.databaseName)})).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var n=this.getValueSets();if(1===n.length)return Object.keys(n[0]).map((function(t){return e.escape(t)})).join(", ")}return this.expressionMap.insertColumns.map((function(t){return e.escape(t)})).join(", ")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){var r="",a=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach((function(s,u){n.forEach((function(c,l){0===l&&(e.connection.driver instanceof i.XR&&t.length>1?r+=" SELECT ":r+="(");var p="i"+u+"_"+c.databaseName,f=c.getEntityValue(s);if(f instanceof Function||(f=e.connection.driver.preparePersistentValue(f,c)),c.isVersion&&void 0===f)r+="1";else if(c.isDiscriminator)e.expressionMap.nativeParameters["discriminator_value_"+a]=e.expressionMap.mainAlias.metadata.discriminatorValue,r+=e.connection.driver.createParameter("discriminator_value_"+a,a),a++;else if(c.isGenerated&&"uuid"===c.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===f){var d="uuid_"+c.databaseName+u;f=o.f.uuid4(),e.expressionMap.nativeParameters[d]=f,r+=e.connection.driver.createParameter(d,a),a++}else if(void 0===f)e.connection.driver instanceof i.XR&&t.length>1||e.connection.driver instanceof h.w||e.connection.driver instanceof i.tU?void 0!==c.default?r+=e.connection.driver.normalizeDefault(c):r+="NULL":r+="DEFAULT";else if(f instanceof Function)r+=f();else{if(e.connection.driver instanceof i.Z0&&(f=e.connection.driver.parametrizeValue(c,f)),e.expressionMap.nativeParameters[p]=f,(e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI)&&-1!==e.connection.driver.spatialTypes.indexOf(c.type)){var m=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";null!=c.srid?r+=m+"("+e.connection.driver.createParameter(p,a)+", "+c.srid+")":r+=m+"("+e.connection.driver.createParameter(p,a)+")"}else e.connection.driver instanceof i.U4&&-1!==e.connection.driver.spatialTypes.indexOf(c.type)?null!=c.srid?r+="ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(p,a)+"), "+c.srid+")::"+c.type:r+="ST_GeomFromGeoJSON("+e.connection.driver.createParameter(p,a)+")::"+c.type:e.connection.driver instanceof i.Z0&&-1!==e.connection.driver.spatialTypes.indexOf(c.type)?r+=c.type+"::STGeomFromText("+e.connection.driver.createParameter(p,a)+", "+(c.srid||"0")+")":r+=e.connection.driver.createParameter(p,a);a++}l===n.length-1?u===t.length-1?e.connection.driver instanceof i.XR&&t.length>1?r+=" FROM DUAL ":r+=")":e.connection.driver instanceof i.XR&&t.length>1?r+=" FROM DUAL UNION ALL ":r+="), ":r+=", "}))})),"()"===r?"":r}var s="",u=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach((function(n,r){Object.keys(n).forEach((function(a,o){0===o&&(s+="(");var c="i"+r+"_"+a,l=n[a];l instanceof Function?s+=l():void 0===l?e.connection.driver instanceof h.w||e.connection.driver instanceof i.tU?s+="NULL":s+="DEFAULT":(e.expressionMap.nativeParameters[c]=l,s+=e.connection.driver.createParameter(c,u),u++),o===Object.keys(n).length-1?r===t.length-1?s+=")":s+="), ":s+=", "}))})),"()"===s?"":s},t.prototype.getValueSets=function(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new c},t}(a.z)},6853:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var r=n(518),i=n(767),a=n(4205),o=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,a.g.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){var e=this;return this.isSelectedEvaluated||(this.isSelectedCache=function(){var t,n,i=function(t){return t.selection===e.alias.name||e.metadata&&e.metadata.columns.find((function(n){return t.selection===e.alias.name+"."+n.propertyPath}))?{value:!0}:void 0};try{for(var a=(0,r.XA)(e.queryExpressionMap.selects),o=a.next();!o.done;o=a.next()){var s=i(o.value);if("object"==typeof s)return s.value}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1}(),this.isSelectedEvaluated=!0),this.isSelectedCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(i.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(i.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){var e=this;return this.relationEvaluated||(this.relationCache=function(){if(i.G.isAliasProperty(e.entityOrProperty)){var t=e.queryExpressionMap.findAliasByName(e.parentAlias),n=t.metadata.findRelationWithPropertyPath(e.relationPropertyPath);if(n)return n;if(t.metadata.parentEntityMetadata&&(n=t.metadata.parentEntityMetadata.findRelationWithPropertyPath(e.relationPropertyPath)))return n;throw new Error("Relation with property path "+e.relationPropertyPath+" in entity was not found.")}}.bind(this)(),this.relationEvaluated=!0),this.relationCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},3404:(e,t,n)=>{"use strict";n.d(t,{z:()=>g});var r=n(518),i=n(4205),a=function(){function e(e){i.g.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),o=n(6853),s=n(5344),u=n(2644),c=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={}}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce((function(n,r){return n[e.mainAlias.name+"."+r]=t[r],n}),{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find((function(t){return t.name===e}));if(!t)throw new Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=(0,r.CR)(e.split("."),2),n=t[0],i=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(i)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new Error("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map((function(e){return e})),n.selectDistinct=this.selectDistinct,n.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach((function(e){return n.aliases.push(new a(e))})),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.onIgnore=this.onIgnore,n.onUpdate=this.onUpdate,n.joinAttributes=this.joinAttributes.map((function(e){return new o.k(t.connection,t,e)})),n.relationIdAttributes=this.relationIdAttributes.map((function(e){return new s.b(t,e)})),n.relationCountAttributes=this.relationCountAttributes.map((function(e){return new u.$(t,e)})),n.wheres=this.wheres.map((function(e){return(0,r.pi)({},e)})),n.havings=this.havings.map((function(e){return(0,r.pi)({},e)})),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map((function(e){return e})),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.withDeleted=this.withDeleted,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n.insertColumns=this.insertColumns,n.whereEntities=this.whereEntities,n.updateEntity=this.updateEntity,n.callListeners=this.callListeners,n.useTransaction=this.useTransaction,n.nativeParameters=Object.assign({},this.nativeParameters),n.comment=this.comment,n},e}(),l=n(7543),h=n(7837),p=n(8529),f=n(5585),d=n(9878),m=n(7979),y=n(2410),v=n(7126),g=function(){function e(t,n){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new c(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map((function(e){return{selection:e}})):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=n(7138).Z;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=n(5586).O;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if((e=e instanceof d.IU?e.options.name:e)instanceof Function||"string"==typeof e){var i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;var a=n(7938).T;return this instanceof a?this:new a(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=n(5100).T;return this instanceof e?this:new e(this)},e.prototype.softDelete=function(){this.expressionMap.queryType="soft-delete";var e=n(3093).B;return this instanceof e?this:new e(this)},e.prototype.restore=function(){this.expressionMap.queryType="restore";var e=n(3093).B;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2===arguments.length?e:void 0,i=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){var a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}var o=n(9783).K;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every((function(e){return!!n.findRelationWithPropertyPath(e)}))},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach((function(t){if(e[t]instanceof Function)throw new Error("Function parameter isn't supported in the parameters. Please check \""+t+'" parameter.')})),this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach((function(n){return t.setParameter(n,e[n])})),this},e.prototype.setNativeParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach((function(n){t.expressionMap.nativeParameters[n]=e[n]})),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter((function(e){return e.discriminatorColumn})).map((function(e){return e.discriminatorValue}));n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.printSql=function(){var e=(0,r.CR)(this.getQueryAndParameters(),2),t=e[0],n=e[1];return this.connection.logger.logQuery(t,n),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.Jh)(this,(function(a){switch(a.label){case 0:e=(0,r.CR)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,3,8]),[4,i.query(t,n)];case 2:return[2,a.sent()];case 3:return i===this.queryRunner?[3,5]:[4,i.release()];case 4:a.sent(),a.label=5;case 5:return this.connection.driver instanceof p.x?[4,this.connection.driver.autoSave()]:[3,7];case 6:a.sent(),a.label=7;case 7:return[7];case 8:return[2]}}))}))},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.comment=function(e){return this.expressionMap.comment=e,this},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.escape(e)})).join(".")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}if("string"==typeof e){var r="("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:r?void 0:e,subQuery:r?e:void 0})}var i=e(this.subQuery());this.setParameters(i.getParameters());var a=i.getQuery();return this.expressionMap.createAlias({type:"from",name:t,subQuery:a})},e.prototype.replacePropertyNames=function(e){var t,n,i=this,a=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},o=function(t){var n,o,u,c,l,h,p,f,d,m,y,v;if(!t.hasMetadata)return"continue";var g=s.expressionMap.aliasNamePrefixingEnabled?t.name+".":"",b=s.expressionMap.aliasNamePrefixingEnabled?s.escape(t.name)+".":"",E={};try{for(var w=(n=void 0,(0,r.XA)(t.metadata.relations)),T=w.next();!T.done;T=w.next())(M=T.value).joinColumns.length>0&&(E[M.propertyPath]=M.joinColumns[0].databaseName)}catch(e){n={error:e}}finally{try{T&&!T.done&&(o=w.return)&&o.call(w)}finally{if(n)throw n.error}}try{for(var C=(u=void 0,(0,r.XA)(t.metadata.relations)),N=C.next();!N.done;N=C.next()){var M=N.value;try{for(var A=(l=void 0,(0,r.XA)((0,r.fl)(M.joinColumns,M.inverseJoinColumns))),R=A.next();!R.done;R=A.next()){var x=R.value,O=M.propertyPath+"."+x.referencedColumn.propertyPath;E[O]=x.databaseName}}catch(e){l={error:e}}finally{try{R&&!R.done&&(h=A.return)&&h.call(A)}finally{if(l)throw l.error}}}}catch(e){u={error:e}}finally{try{N&&!N.done&&(c=C.return)&&c.call(C)}finally{if(u)throw u.error}}try{for(var S=(p=void 0,(0,r.XA)(t.metadata.columns)),P=S.next();!P.done;P=S.next()){var I=P.value;E[I.databaseName]=I.databaseName}}catch(e){p={error:e}}finally{try{P&&!P.done&&(f=S.return)&&f.call(S)}finally{if(p)throw p.error}}try{for(var _=(d=void 0,(0,r.XA)(t.metadata.columns)),j=_.next();!j.done;j=_.next())I=j.value,E[I.propertyName]=I.databaseName}catch(e){d={error:e}}finally{try{j&&!j.done&&(m=_.return)&&m.call(_)}finally{if(d)throw d.error}}try{for(var q=(y=void 0,(0,r.XA)(t.metadata.columns)),D=q.next();!D.done;D=q.next())I=D.value,E[I.propertyPath]=I.databaseName}catch(e){y={error:e}}finally{try{D&&!D.done&&(v=q.return)&&v.call(q)}finally{if(y)throw y.error}}var L=Object.keys(E);L.length&&(e=e.replace(new RegExp("(?<=[ =(]|^.{0})"+a(g)+"("+L.map(a).join("|")+")(?=[ =),]|.{0}$)","gm"),(function(e,t){return""+b+i.escape(E[t])})))},s=this;try{for(var u=(0,r.XA)(this.expressionMap.aliases),c=u.next();!c.done;c=u.next())o(c.value)}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return e},e.prototype.createComment=function(){return this.expressionMap.comment?"/* "+this.expressionMap.comment.replace("*/","")+" */ ":""},e.prototype.createWhereExpression=function(){var e=[];if(this.createWhereExpressionString().trim()&&e.push(this.createWhereExpressionString()),this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&t.deleteDateColumn){var n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.deleteDateColumn.propertyName:t.deleteDateColumn.propertyName,r=this.replacePropertyNames(n)+" IS NULL";e.push(r)}t.discriminatorColumn&&t.parentEntityMetadata&&(n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,r=this.replacePropertyNames(n)+" IN (:...discriminatorColumnValues)",e.push(r))}return this.expressionMap.extraAppendedAndWhereCondition&&(r=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition),e.push(r)),e.length?1===e.length?" WHERE "+e[0]:" WHERE ( "+e.join(" ) AND ( ")+" )":" "},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns(),n=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported()&&t.push.apply(t,(0,r.fl)(this.expressionMap.extraReturningColumns.filter((function(e){return-1===t.indexOf(e)})))),t.length){var i=t.map((function(t){var r=e.escape(t.databaseName);return n instanceof f.Z0?"insert"===e.expressionMap.queryType||"update"===e.expressionMap.queryType||"soft-delete"===e.expressionMap.queryType||"restore"===e.expressionMap.queryType?"INSERTED."+r:e.escape(e.getMainTableName())+"."+r:r})).join(", ");return n instanceof f.XR&&(i+=" INTO "+t.map((function(t){var r="output_"+t.databaseName;return e.expressionMap.nativeParameters[r]={type:n.columnTypeToNativeParameter(t.type),dir:n.oracle.BIND_OUT},e.connection.driver.createParameter(r,Object.keys(e.expressionMap.nativeParameters).length)})).join(", ")),n instanceof f.Z0&&("insert"!==this.expressionMap.queryType&&"update"!==this.expressionMap.queryType||(i+=" INTO @OutputTable")),i}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""},e.prototype.getReturningColumns=function(){var e=this,t=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach((function(n){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,(0,r.fl)(e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n)))})),t},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map((function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}})).join(" ")},e.prototype.createWhereIdsExpression=function(e){var t,n=this,r=this.expressionMap.mainAlias.metadata,i=(Array.isArray(e)?e:[e]).map((function(e){return r.ensureEntityIdMap(e)}));if(!r.hasMultiplePrimaryKeys&&0===r.embeddeds.length){var a=r.primaryColumns[0];if(!a.transformer)return this.computeWhereParameter(((t={})[a.propertyName]=(0,y.In)(i.map((function(e){return a.getEntityValue(e,!1)}))),t))}var o=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+".":"",s=Object.keys(this.expressionMap.nativeParameters).length,u=i.map((function(e,t){var i=[];return r.primaryColumns.forEach((function(r,a){var u="id_"+t+"_"+a;i.push(o+n.escape(r.databaseName)+" = "+n.connection.driver.createParameter(u,s)),n.expressionMap.nativeParameters[u]=r.getEntityValue(e,!0),s++})),i.join(" AND ")}));return u.length>1?"("+u.map((function(e){return"("+e+")"})).join(" OR ")+")":u[0]},e.prototype.computeWhereParameter=function(e){var t=this;if("string"==typeof e)return e;if(e instanceof l.D){var n=this.createQueryBuilder();n.expressionMap.mainAlias=this.expressionMap.mainAlias,n.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,n.expressionMap.nativeParameters=this.expressionMap.nativeParameters,e.whereFactory(n);var r=n.createWhereExpressionString();return this.setParameters(n.getParameters()),r?"("+r+")":""}if(e instanceof Function)return e(this);if(e instanceof Object){var i=Array.isArray(e)?e:[e],a=void 0,o=Object.keys(this.expressionMap.nativeParameters).length;return(a=this.expressionMap.mainAlias.hasMetadata?i.map((function(e,n){return h.T.createPropertyPath(t.expressionMap.mainAlias.metadata,e).map((function(r,i){var a=t.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(r);if(!a.length)throw new v.n(r);return a.map((function(a,s){var u=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:a.propertyPath,c=a.getEntityValue(e,!0),l="where_"+n+"_"+i+"_"+s,h=Object.keys(t.expressionMap.nativeParameters).filter((function(e){return e.startsWith(l)})).length;if(null===c)return u+" IS NULL";if(c instanceof m.J){var p=[];return c.useParameter&&(c.objectLiteralParameters?t.setParameters(c.objectLiteralParameters):(c.multipleParameters?c.value:[c.value]).forEach((function(e,n){t.expressionMap.nativeParameters[l+(h+n)]=e,o++,p.push(t.connection.driver.createParameter(l+(h+n),o-1))}))),t.computeFindOperatorExpression(c,u,p)}return t.expressionMap.nativeParameters[l]=c,o++,u+" = "+t.connection.driver.createParameter(l,o-1)})).filter((function(e){return!!e})).join(" AND ")})).filter((function(e){return!!e})).join(" AND ")})):i.map((function(e,n){return Object.keys(e).map((function(r,i){var a=e[r],o=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:r;if(null===a)return o+" IS NULL";var s="where_"+n+"_"+i;return t.expressionMap.nativeParameters[s]=a,i++,o+" = "+t.connection.driver.createParameter(s,i-1)})).join(" AND ")}))).length>1?a.map((function(e){return"("+e+")"})).join(" OR "):a.join("")}return""},e.prototype.computeFindOperatorExpression=function(e,t,n){var r=this.connection.driver;switch(e.type){case"not":return e.child?"NOT("+this.computeFindOperatorExpression(e.child,t,n)+")":t+" != "+n[0];case"lessThan":return t+" < "+n[0];case"lessThanOrEqual":return t+" <= "+n[0];case"moreThan":return t+" > "+n[0];case"moreThanOrEqual":return t+" >= "+n[0];case"equal":return t+" = "+n[0];case"ilike":return r instanceof f.U4||r instanceof f.J1?t+" ILIKE "+n[0]:"UPPER("+t+") LIKE UPPER("+n[0]+")";case"like":return t+" LIKE "+n[0];case"between":return t+" BETWEEN "+n[0]+" AND "+n[1];case"in":return 0===n.length?"0=1":t+" IN ("+n.join(", ")+")";case"any":return t+" = ANY("+n[0]+")";case"isNull":return t+" IS NULL";case"raw":return e.getSql?e.getSql(t):t+" = "+e.value}throw new TypeError("Unsupported FindOperator "+m.J.constructor.name)},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner()},e}()},767:(e,t,n)=>{"use strict";n.d(t,{G:()=>i});var r=n(518),i=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=(0,r.CR)(e.split("."),2),n=t[0],i=t[1];return!(!n||!i)&&-1===e.indexOf("(")&&-1===e.indexOf(")")},e}()},9783:(e,t,n)=>{"use strict";n.d(t,{K:()=>u});var r=n(518),i=n(3404),a=n(5585),o=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,o,s,u,c,l,h,p,f,d,m,y=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(c=t.joinColumns.reduce((function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t}),{}),!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(c).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return r.sent(),[3,10];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==e?[3,4]:(n={},t.inverseRelation.joinColumns.forEach((function(e){n[e.propertyName]=null})),h=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i={},o=[],h.forEach((function(e,n){t.inverseRelation.joinColumns.map((function(t,r){var a="joinColumn_"+n+"_"+r;i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,o.push(t.propertyPath+" = :"+a)}))})),(s=o.map((function(e){return"("+e+")"})).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(s).setParameters(i).execute()]:[2]);case 3:return r.sent(),[3,10];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(Array.isArray(this.expressionMap.of))throw new Error("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return u=this.expressionMap.of,c=t.inverseRelation.joinColumns.reduce((function(e,t){var n=u instanceof Object?t.referencedColumn.getEntityValue(u):u;return t.setEntityValue(e,n),e}),{}),!e||Array.isArray(e)&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(c).whereInIds(e).execute()];case 5:return r.sent(),[3,10];case 6:return l=t.junctionEntityMetadata,h=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],p=Array.isArray(e)?e:[e],f=t.isManyToManyOwner?h:p,d=t.isManyToManyOwner?p:h,m=[],f.forEach((function(e){d.forEach((function(t){var n={};l.ownerColumns.forEach((function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e})),l.inverseColumns.forEach((function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t})),m.push(n)}))})),m.length?this.queryBuilder.connection.driver instanceof a.XR||this.queryBuilder.connection.driver instanceof a.tU?[4,Promise.all(m.map((function(e){return y.queryBuilder.createQueryBuilder().insert().into(l.tableName).values(e).execute()})))]:[3,8]:[2];case 7:return r.sent(),[3,10];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(l.tableName).values(m).execute()];case 9:r.sent(),r.label=10;case 10:return[2]}}))}))},e}(),s=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p,f,d;return(0,r.Jh)(this,(function(m){switch(m.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],n=Array.isArray(e)?e:[e],i={},t.inverseRelation.joinColumns.forEach((function(e){i[e.propertyName]=null})),a={},o=[],u.forEach((function(e,i){o.push.apply(o,(0,r.fl)(n.map((function(n,o){return(0,r.fl)(t.inverseRelation.joinColumns.map((function(t,n){var r="joinColumn_"+i+"_"+o+"_"+n;return a[r]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+" = :"+r})),t.inverseRelation.entityMetadata.primaryColumns.map((function(e,t){var r="primaryColumn_"+o+"_"+o+"_"+t;return a[r]=n instanceof Object?e.getEntityValue(n):n,e.propertyPath+" = :"+r}))).join(" AND ")}))))})),(d=o.map((function(e){return"("+e+")"})).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(d).setParameters(a).execute()]:[2]):[3,2];case 1:return m.sent(),[3,4];case 2:return s=t.junctionEntityMetadata,u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],c=Array.isArray(e)?e:[e],l=t.isManyToManyOwner?u:c,h=t.isManyToManyOwner?c:u,p={},f=[],l.forEach((function(e,t){f.push.apply(f,(0,r.fl)(h.map((function(n,i){return(0,r.fl)(s.ownerColumns.map((function(n,r){var a="firstValue_"+t+"_"+i+"_"+r;return p[a]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+" = :"+a})),s.inverseColumns.map((function(e,r){var a="secondValue_"+t+"_"+i+"_"+r;return p[a]=n instanceof Object?e.referencedColumn.getEntityValue(n):n,e.databaseName+" = :"+a}))).join(" AND ")}))))})),d=f.map((function(e){return"("+e+")"})).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(s.tableName).where(d).setParameters(p).execute()];case 3:m.sent(),m.label=4;case 4:return[2]}}))}))},e}(),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new o(this,this.expressionMap).update(e)]}))}))},t.prototype.add=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new o(this,this.expressionMap).update(e)]}))}))},t.prototype.remove=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return[2,new s(this,this.expressionMap).remove(e)]}))}))},t.prototype.addAndRemove=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}}))}))},t.prototype.loadOne=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return[2,this.loadMany().then((function(e){return e[0]}))]}))}))},t.prototype.loadMany=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t;return(0,r.Jh)(this,(function(n){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,e)]}))}))},t}(i.z)},4324:(e,t,n)=>{"use strict";n.d(t,{v:()=>o});var r=n(518),i=n(8731),a=n(5585),o=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,i=this;return(0,r.Jh)(this,(function(o){switch(o.label){case 0:return n=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map((function(t,o){return(0,r.mG)(i,void 0,void 0,(function(){var i,s,u,c,l=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(this.queryRunner.connection.driver instanceof a.XR&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e}),{})),i=Array.isArray(e.raw)?e.raw[o]:e.raw,(s=this.queryRunner.connection.driver.createGeneratedMap(n,i))&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s)),[3,3]):[3,1];case 1:if(!(this.getUpdationReturningColumns().length>0))return[3,3];if(!(u=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw new Error("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((function(e){return n.targetName+"."+e.propertyPath}))).addSelect(this.getUpdationReturningColumns().map((function(e){return n.targetName+"."+e.propertyPath}))).from(n.target,n.targetName).where(u).setOption("create-pojo").getOne()];case 2:(c=r.sent())&&(this.queryRunner.manager.merge(n.target,t,c),e.generatedMaps.push(c)),r.label=3;case 3:return[2]}}))}))})))];case 1:return o.sent(),[2]}}))}))},e.prototype.insert=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,o,s,u,c,l=this;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n=this.expressionMap.mainAlias.metadata,o=this.getInsertionReturningColumns(),s=t.map((function(r,o){l.queryRunner.connection.driver instanceof a.XR&&Array.isArray(e.raw)&&l.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e}),{}));var s=Array.isArray(e.raw)?e.raw[o]:e.raw,u=l.queryRunner.connection.driver.createGeneratedMap(n,s,o,t.length)||{};return!1===l.queryRunner.connection.driver.isUUIDGenerationSupported()&&n.generatedColumns.forEach((function(e){if("uuid"===e.generationStrategy){var t=e.getEntityValue(r);t||(t=l.expressionMap.nativeParameters["uuid_"+e.databaseName+o]),i.s.mergeDeep(u,e.createValueMap(t))}})),l.queryRunner.manager.merge(n.target,r,u),u})),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&o.length>0?(u=t.map((function(e){var t=n.getEntityIdMap(e);if(!t)throw new Error("Cannot update entity because entity id is not set in the entity.");return t})),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((function(e){return n.targetName+"."+e.propertyPath}))).addSelect(o.map((function(e){return n.targetName+"."+e.propertyPath}))).from(n.target,n.targetName).where(u).setOption("create-pojo").getMany()]):[3,2];case 1:c=r.sent(),t.forEach((function(e,t){l.queryRunner.manager.merge(n.target,s[t],c[t])})),r.label=2;case 2:return t.forEach((function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r]),l.queryRunner.manager.merge(l.expressionMap.mainAlias.metadata.target,t,s[r],s[r])})),[2]}}))}))},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter((function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isDeleteDate||t.isVersion}))},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter((function(e){return e.isUpdateDate||e.isVersion}))},e}()},7138:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var r=n(518),i=n(5585),a=n(8731),o=n(3587),s=function(){function e(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}return e.prototype.transform=function(e,t){var n=this,r=this.group(e,t),i=[];return r.forEach((function(e){var r=n.transformRawResultsGroup(e,t);void 0!==r&&i.push(r)})),i},e.prototype.group=function(e,t){var n=this,i=new Map,a=[];return"view"===t.metadata.tableType?a.push.apply(a,(0,r.fl)(t.metadata.columns.map((function(e){return o.z.buildColumnAlias(n.driver,t.name,e.databaseName)})))):a.push.apply(a,(0,r.fl)(t.metadata.primaryColumns.map((function(e){return o.z.buildColumnAlias(n.driver,t.name,e.databaseName)})))),e.forEach((function(e){var t=a.map((function(t){var n=e[t];return Buffer.isBuffer(n)?n.toString("hex"):"object"==typeof n?JSON.stringify(n):n})).join("_"),n=i.get(t);n?n.push(e):i.set(t,[e])})),i},e.prototype.transformRawResultsGroup=function(e,t){var n=this,r=t.metadata;if(r.discriminatorColumn){var i=e.map((function(e){return e[o.z.buildColumnAlias(n.driver,t.name,t.metadata.discriminatorColumn.databaseName)]})),a=r.childEntityMetadatas.find((function(e){return void 0!==i.find((function(t){return t===e.discriminatorValue}))}));a&&(r=a)}var s=-1!==this.expressionMap.options.indexOf("create-pojo")?{}:r.create(this.queryRunner),u=this.transformColumns(e,t,s,r),c=this.transformJoins(e,s,t,r),l=this.transformRelationIds(e,t,s,r),h=this.transformRelationCounts(e,t,s);return u||0===r.primaryColumns.filter((function(e){return!1===e.isVirtual})).length&&(c||l||h)?s:void 0},e.prototype.transformColumns=function(e,t,n,r){var i=this,a=!1;return r.columns.forEach((function(s){if(!(r.childEntityMetadatas.length>0&&-1!==r.childEntityMetadatas.map((function(e){return e.target})).indexOf(s.target))){var u=e[0][o.z.buildColumnAlias(i.driver,t.name,s.databaseName)];void 0===u||s.isVirtual||i.expressionMap.selects.find((function(e){return e.selection===t.name||e.selection===t.name+"."+s.propertyPath}))&&(s.setEntityValue(n,i.driver.prepareHydratedValue(u,s)),null!==u&&(a=!0))}})),a},e.prototype.transformJoins=function(e,t,n,r){var i=this,a=!1;return this.expressionMap.joinAttributes.forEach((function(o){if(o.metadata&&o.isSelected&&(!o.relation||r.relations.find((function(e){return e===o.relation})))){if(o.mapToProperty){if(o.mapToPropertyParentAlias!==n.name)return}else if(!o.relation||o.parentAlias!==n.name||o.relationPropertyPath!==o.relation.propertyPath)return;var s=i.transform(e,o.alias);s=o.isMany?s:s[0],void 0!==(s=o.isMany||void 0!==s?s:null)&&(o.mapToPropertyPropertyName?t[o.mapToPropertyPropertyName]=s:o.relation.setEntityValue(t,s),a=!0)}})),a},e.prototype.transformRelationIds=function(e,t,n,r){var i=this,o=!1;return this.rawRelationIdResults.forEach((function(r){if(r.relationIdAttribute.parentAlias===t.name){var s=r.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,r.relationIdAttribute.parentAlias,e);if(null!=u){var c=r.results.map((function(e){var t=i.extractEntityPrimaryIds(s,e);if(!1!==a.s.compareIds(t,u)){var n,o=(n=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map((function(e){return e})):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map((function(e){return e})):s.isOwning?s.inverseJoinColumns.map((function(e){return e})):s.inverseRelation.joinColumns.map((function(e){return e}))).reduce((function(t,n){var r=e[n.databaseName];return s.isOneToMany||s.isOneToOneNotOwner?(n.isVirtual&&n.referencedColumn&&n.referencedColumn.propertyName!==n.propertyName&&(r=n.referencedColumn.createValueMap(r)),a.s.mergeDeep(t,n.createValueMap(r))):(n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),a.s.mergeDeep(t,n.referencedColumn.createValueMap(r)))}),{});return 1===n.length&&!1===r.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?n[0].getEntityValue(o):n[0].referencedColumn.getEntityValue(o):o}})).filter((function(e){return void 0!==e})),l=r.relationIdAttribute.mapToPropertyPropertyPath.split("."),h=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void h(e,t[r],n):t};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(h(l,n,c[0]),o=!0):(h(l,n,c),c.length>0&&(o=!0))}}})),o},e.prototype.transformRelationCounts=function(e,t,n){var r=this,i=!1;return this.rawRelationCountResults.filter((function(e){return e.relationCountAttribute.parentAlias===t.name})).forEach((function(a){var s,u=a.relationCountAttribute.relation;s=u.isOneToMany?u.inverseRelation.joinColumns[0].referencedColumn.databaseName:u.isOwning?u.joinColumns[0].referencedColumn.databaseName:u.inverseRelation.joinColumns[0].referencedColumn.databaseName;var c=e[0][o.z.buildColumnAlias(r.driver,t.name,s)];null!=c&&(n[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter((function(e){return e.parentId===c})).forEach((function(e){n[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0})))})),i},e.prototype.createValueMapFromJoinColumns=function(e,t,n){var r=this;return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((function(e){return e})):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((function(e){return e})):e.isOwning?e.joinColumns.map((function(e){return e})):e.inverseRelation.inverseJoinColumns.map((function(e){return e}))).reduce((function(i,a){return n.forEach((function(n){e.isManyToOne||e.isOneToOneOwner?i[a.databaseName]=r.driver.prepareHydratedValue(n[o.z.buildColumnAlias(r.driver,t,a.databaseName)],a):i[a.databaseName]=r.driver.prepareHydratedValue(n[o.z.buildColumnAlias(r.driver,t,a.referencedColumn.databaseName)],a)})),i}),{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((function(e){return e})):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((function(e){return e})):e.isOwning?e.joinColumns.map((function(e){return e})):e.inverseRelation.inverseJoinColumns.map((function(e){return e}))).reduce((function(e,n){return e[n.databaseName]=t[n.databaseName],e}),{})},e}(),u=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return(0,r.ZT)(t,e),t}(Error),c=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return(0,r.ZT)(t,e),t}(Error),l=function(e){function t(n,r,i){var a=e.call(this)||this;return a.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(a,t.prototype),a.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",a}return(0,r.ZT)(t,e),t}(Error),h=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return(0,r.ZT)(t,e),t}(Error),p=n(6853),f=n(5344),d=n(2644),m=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n=this;return(0,r.Jh)(this,(function(i){return t=this.relationIdAttributes.map((function(t){return(0,r.mG)(n,void 0,void 0,(function(){var n,i,a,s,u,c,l,h,p,f,d,m,y,v,g,b,E,w,T,C,N,M=this;return(0,r.Jh)(this,(function(A){switch(A.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return N=e.map((function(e){var n={};return t.relation.joinColumns.forEach((function(r){n[r.databaseName]=M.connection.driver.prepareHydratedValue(e[o.z.buildColumnAlias(M.connection.driver,t.parentAlias,r.databaseName)],r.referencedColumn)})),t.relation.entityMetadata.primaryColumns.forEach((function(r){n[r.databaseName]=M.connection.driver.prepareHydratedValue(e[o.z.buildColumnAlias(M.connection.driver,t.parentAlias,r.databaseName)],r)})),n})),[2,{relationIdAttribute:t,results:N}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(n=t.relation,i=n.isOwning?n.joinColumns:n.inverseRelation.joinColumns,a=n.inverseEntityMetadata.target,s=n.inverseEntityMetadata.tableName,u=t.alias||s,c={},(T=e.map((function(e,n){return i.map((function(r){var i=r.databaseName+n;return c[i]=e[o.z.buildColumnAlias(M.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],u+"."+r.propertyPath+" = :"+i})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR "))?(l=this.connection.createQueryBuilder(this.queryRunner),i.forEach((function(e){l.addSelect(u+"."+e.propertyPath,e.databaseName)})),n.inverseRelation.entityMetadata.primaryColumns.forEach((function(e){l.addSelect(u+"."+e.propertyPath,e.databaseName)})),l.from(a,u).where("("+T+")").setParameters(c),t.queryBuilderFactory&&t.queryBuilderFactory(l),[4,l.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return(N=A.sent()).forEach((function(e){i.forEach((function(t){e[t.databaseName]=M.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})),n.inverseRelation.entityMetadata.primaryColumns.forEach((function(t){e[t.databaseName]=M.connection.driver.prepareHydratedValue(e[t.databaseName],t)}))})),[2,{relationIdAttribute:t,results:N}];case 3:return h=t.relation,p=h.isOwning?h.joinColumns:h.inverseRelation.inverseJoinColumns,f=h.isOwning?h.inverseJoinColumns:h.inverseRelation.joinColumns,d=t.junctionAlias,m=t.joinInverseSideMetadata.tableName,y=t.alias||m,v=h.isOwning?h.junctionEntityMetadata.tableName:h.inverseRelation.junctionEntityMetadata.tableName,0===(g=e.map((function(e){return p.reduce((function(n,r){return n[r.propertyPath]=e[o.z.buildColumnAlias(M.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],n}),{})}))).length?[2,{relationIdAttribute:t,results:[]}]:(b={},E=g.map((function(e,t){return Object.keys(e).map((function(n){var r=n+t;return b[r]=e[n],d+"."+n+" = :"+r})).join(" AND ")})),w=f.map((function(e){return d+"."+e.propertyPath+" = "+y+"."+e.referencedColumn.propertyPath})).join(" AND "),T=E.map((function(e){return"("+e+" AND "+w+")"})).join(" OR "),C=this.connection.createQueryBuilder(this.queryRunner),f.forEach((function(e){C.addSelect(d+"."+e.propertyPath,e.databaseName).addOrderBy(d+"."+e.propertyPath)})),p.forEach((function(e){C.addSelect(d+"."+e.propertyPath,e.databaseName).addOrderBy(d+"."+e.propertyPath)})),C.from(m,y).innerJoin(v,d,T).setParameters(b),t.queryBuilderFactory&&t.queryBuilderFactory(C),[4,C.getRawMany()]);case 4:return(N=A.sent()).forEach((function(e){(0,r.fl)(p,f).forEach((function(t){e[t.databaseName]=M.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}))})),[2,{relationIdAttribute:t,results:N}]}}))}))})),[2,Promise.all(t)]}))}))},e}(),y=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach((function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)})),this.expressionMap.joinAttributes.forEach((function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach((function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)}))}))},e.prototype.metadataToAttribute=function(e,t){return new f.b(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),v=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.Jh)(this,(function(a){return t=function(e,t,n){return n.indexOf(e)===t},n=this.relationCountAttributes.map((function(n){return(0,r.mG)(i,void 0,void 0,(function(){var i,a,o,s,u,c,l,h,p,f,d,m,y,v,g,b,E,w;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return n.relation.isOneToMany?(i=n.relation,a=i.inverseRelation,o=a.joinColumns[0].referencedColumn.propertyName,s=i.inverseEntityMetadata.target,y=i.inverseEntityMetadata.tableName,v=n.alias||y,u=a.propertyName,0===(d=(d=e.map((function(e){return e[n.parentAlias+"_"+o]})).filter((function(e){return!!e}))).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:((E=this.connection.createQueryBuilder(this.queryRunner)).select(v+"."+u,"parentId").addSelect("COUNT(*)","cnt").from(s,v).where(v+"."+u+" IN (:...ids)").addGroupBy(v+"."+u).setParameter("ids",d),n.queryBuilderFactory&&n.queryBuilderFactory(E),c={relationCountAttribute:n},[4,E.getRawMany()])):[3,2];case 1:return[2,(c.results=r.sent(),c)];case 2:return h=void 0,p=void 0,f=void 0,n.relation.isOwning?(l=n.relation.joinColumns[0].referencedColumn.databaseName,h=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[0],f=n.relation.junctionEntityMetadata.columns[1]):(l=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,h=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[1],f=n.relation.junctionEntityMetadata.columns[0]),0===(d=(d=e.map((function(e){return e[n.parentAlias+"_"+l]})).filter((function(e){return!!e}))).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:(m=n.junctionAlias,y=n.joinInverseSideMetadata.tableName,v=n.alias||y,g=n.relation.junctionEntityMetadata.tableName,b=m+"."+p.propertyName+" IN ("+d.map((function(e){return isNaN(e)?"'"+e+"'":e}))+") AND "+m+"."+f.propertyName+" = "+v+"."+h,(E=this.connection.createQueryBuilder(this.queryRunner)).select(m+"."+p.propertyName,"parentId").addSelect("COUNT("+E.escape(v)+"."+E.escape(h)+")","cnt").from(y,v).innerJoin(g,m,b).addGroupBy(m+"."+p.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(E),w={relationCountAttribute:n},[4,E.getRawMany()]);case 3:return[2,(w.results=r.sent(),w)]}}))}))})),[2,Promise.all(n)]}))}))},e}(),g=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach((function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)})),this.expressionMap.joinAttributes.forEach((function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach((function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)}))}))},e.prototype.metadataToAttribute=function(e,t){return new d.$(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),b=n(3404),E=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on given driver.",n}return(0,r.ZT)(t,e),t}(Error),w=n(3781),T=function(e){function t(){var n=e.call(this)||this;return n.name="OffsetWithoutLimitNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).",n}return(0,r.ZT)(t,e),t}(Error),C=n(3730),N=n(4205),M=n(597),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e=(e+=this.createLockExpression()).trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map((function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map((function(e){return{selection:e}})));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.distinct=function(e){return void 0===e&&(e=!0),this.expressionMap.selectDistinct=e,this},t.prototype.distinctOn=function(e){return this.expressionMap.selectDistinctOn=e,this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new f.b(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new d.$(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach((function(n){void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(n.propertyPath)||t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+n.propertyPath,t.expressionMap.mainAlias.name+"."+n.propertyPath,e)})),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){var r,i;if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new Error('Provided "limit" value is not a number. Please provide a numeric value.');return this},t.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new Error('Provided "offset" value is not a number. Please provide a numeric value.');return this},t.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new Error('Provided "take" value is not a number. Please provide a numeric value.');return this},t.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new Error('Provided "skip" value is not a number. Please provide a numeric value.');return this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.withDeleted=function(){return this.expressionMap.withDeleted=!0,this},t.prototype.getRawOne=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.getRawMany=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return[4,this.loadRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getRawAndEntities=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getOne=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=r.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((i=n.updateDateColumn.getEntityValue(t)).getTime()!==this.expressionMap.lockVersion.getTime())throw new l(n.name,this.expressionMap.lockVersion,i)}else if((i=n.versionColumn.getEntityValue(t))!==this.expressionMap.lockVersion)throw new l(n.name,this.expressionMap.lockVersion,i);return[2,t]}}))}))},t.prototype.getOneOrFail=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.getOne()];case 1:if(!(e=t.sent()))throw new M.E(this.expressionMap.mainAlias.target,this);return[2,e]}}))}))},t.prototype.getMany=function(){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}}))}))},t.prototype.getCount=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getManyAndCount=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,8,13,16]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 5:return i=r.sent(),a=[n.entities,i],t?[4,e.commitTransaction()]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2,a];case 8:if(o=r.sent(),!t)return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:case 11:return r.sent(),[3,12];case 12:throw o;case 13:return e===this.queryRunner?[3,15]:[4,e.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}}))}))},t.prototype.stream=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,(function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,e=(0,r.CR)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a=!1,l.label=1;case 1:return l.trys.push([1,6,,11]),!0!==this.expressionMap.useTransaction||!1!==i.isTransactionActive?[3,3]:[4,i.startTransaction()];case 2:l.sent(),a=!0,l.label=3;case 3:return o=function(){if(i!==c.queryRunner)return i.release()},s=i.stream(t,n,o,o),a?[4,i.commitTransaction()]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2,s];case 6:if(u=l.sent(),!a)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,i.rollbackTransaction()];case 8:case 9:return l.sent(),[3,10];case 10:throw u;case 11:return[2]}}))}))},t.prototype.cache=function(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.setOption=function(e){return this.expressionMap.options.push(e),this},t.prototype.join=function(e,t,n,r,i,a,o){this.setParameters(i||{});var s=new p.k(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=a,s.isMappingMany=o,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var u="";if(t instanceof Function){var c=t(this.subQuery());this.setParameters(c.getParameters()),u=c.getQuery()}else u=t;var l=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===l?t:void 0,subQuery:!0===l?u:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var a=this.expressionMap.mainAlias.metadata;t.push.apply(t,(0,r.fl)(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,a))),n.push.apply(n,(0,r.fl)(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,a)))}this.expressionMap.joinAttributes.forEach((function(i){if(i.metadata)t.push.apply(t,(0,r.fl)(e.buildEscapedEntityColumnSelects(i.alias.name,i.metadata))),n.push.apply(n,(0,r.fl)(e.findEntityColumnSelects(i.alias.name,i.metadata)));else if(e.expressionMap.selects.some((function(e){return e.selection===i.alias.name}))){t.push({selection:e.escape(i.alias.name)+".*"});var a=e.expressionMap.selects.find((function(e){return e.selection===i.alias.name}));n.push(a)}})),this.expressionMap.selects.filter((function(e){return-1===n.indexOf(e)})).forEach((function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})})),0===t.length&&t.push({selection:"*"});var o="";if(this.connection.driver instanceof i.Z0)switch(this.expressionMap.lockMode){case"pessimistic_read":o=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":o=" WITH (UPDLOCK, ROWLOCK)";break;case"dirty_read":o=" WITH (NOLOCK)"}var s=this.expressionMap.aliases.filter((function(e){return"from"===e.type&&(e.tablePath||e.subQuery)})).map((function(t){return t.subQuery?t.subQuery+" "+e.escape(t.name):e.getTableName(t.tablePath)+" "+e.escape(t.name)}));return this.createSelectDistinctExpression()+t.map((function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")})).join(", ")+" FROM "+s.join(", ")+o},t.prototype.createSelectDistinctExpression=function(){var e=this,t=this.expressionMap,n=t.selectDistinct,r=t.selectDistinctOn,a="SELECT ";return this.connection.driver instanceof i.U4&&r.length>0?a="SELECT DISTINCT ON ("+r.map((function(t){return e.replacePropertyNames(t)})).join(", ")+") ":n&&(a="SELECT DISTINCT "),a},t.prototype.createJoinExpression=function(){var e=this;return this.expressionMap.joinAttributes.map((function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,a=t.condition?" AND ("+t.condition+")":"",o=t.parentAlias;if(!o||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return" "+t.direction+" JOIN "+s+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){var u=n.joinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+o+"."+n.propertyPath+"."+e.referencedColumn.propertyPath})).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}if(n.isOneToMany||n.isOneToOneNotOwner)return u=n.inverseRelation.joinColumns.map((function(e){return i+"."+n.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND ")," "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a);var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,h="",p="";return n.isOwning?(h=n.joinColumns.map((function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND "),p=n.inverseJoinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath})).join(" AND ")):(h=n.inverseRelation.inverseJoinColumns.map((function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND "),p=n.inverseRelation.joinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath})).join(" AND "))," "+t.direction+" JOIN "+e.getTableName(c)+" "+e.escape(l)+" ON "+e.replacePropertyNames(h)+" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(p+a)})).join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitOffsetExpression=function(){var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof i.Z0){var n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI||this.connection.driver instanceof i.tU){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new T}else if(this.connection.driver instanceof w.w){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver instanceof i.XR){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""},t.prototype.createLockExpression=function(){var e=this.connection.driver;switch(this.expressionMap.lockMode){case"pessimistic_read":if(e instanceof i.p$||e instanceof i.xI)return" LOCK IN SHARE MODE";if(e instanceof i.U4)return" FOR SHARE";if(e instanceof i.XR)return" FOR UPDATE";if(e instanceof i.Z0)return"";throw new E;case"pessimistic_write":if(e instanceof i.p$||e instanceof i.xI||e instanceof i.U4||e instanceof i.XR)return" FOR UPDATE";if(e instanceof i.Z0)return"";throw new E;case"pessimistic_partial_write":if(e instanceof i.U4||e instanceof i.p$)return" FOR UPDATE SKIP LOCKED";throw new E;case"pessimistic_write_or_fail":if(e instanceof i.U4||e instanceof i.p$)return" FOR UPDATE NOWAIT";throw new E;case"for_no_key_update":if(e instanceof i.U4)return" FOR NO KEY UPDATE";throw new E;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map((function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}})).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,a=this.expressionMap.selects.some((function(t){return t.selection===e})),s=[];if(a&&s.push.apply(s,(0,r.fl)(t.columns.filter((function(e){return!0===e.isSelect})))),s.push.apply(s,(0,r.fl)(t.columns.filter((function(t){return n.expressionMap.selects.some((function(n){return n.selection===e+"."+t.propertyPath}))})))),0===s.length)return[];var u=this.expressionMap.queryEntity?t.primaryColumns.filter((function(e){return-1===s.indexOf(e)})):[];return(0,r.fl)(s,u).map((function(t){var r=n.expressionMap.selects.find((function(n){return n.selection===e+"."+t.propertyPath})),s=n.escape(e)+"."+n.escape(t.databaseName);return-1!==n.connection.driver.spatialTypes.indexOf(t.type)&&((n.connection.driver instanceof i.p$||n.connection.driver instanceof i.xI)&&(s=(n.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText")+"("+s+")"),n.connection.driver instanceof i.U4&&(s="ST_AsGeoJSON("+s+")::json"),n.connection.driver instanceof i.Z0&&(s+=".ToString()")),{selection:s,aliasName:r&&r.aliasName?r.aliasName:o.z.buildColumnAlias(n.connection.driver,e,t.databaseName),virtual:r?!0===r.virtual:!a}}))},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find((function(t){return t.selection===e}));return n?[n]:this.expressionMap.selects.filter((function(n){return t.columns.some((function(t){return n.selection===e+"."+t.propertyPath}))}))},t.prototype.computeCountExpression=function(){var e=this,t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(t);if(0===this.expressionMap.joinAttributes.length&&0===this.expressionMap.relationIdAttributes.length&&0===this.expressionMap.relationCountAttributes.length)return"COUNT(1)";if(this.connection.driver instanceof i.J1||this.connection.driver instanceof i.U4)return"COUNT(DISTINCT("+n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(", ")+"))";if(this.connection.driver instanceof i.p$)return"COUNT(DISTINCT "+n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(", ")+")";if(this.connection.driver instanceof i.Z0){var a=n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(", '|;|', ");return 1===n.length?"COUNT(DISTINCT("+a+"))":"COUNT(DISTINCT(CONCAT("+a+")))"}return"COUNT(DISTINCT("+n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(" || '|;|' || ")+"))"},t.prototype.executeCountQuery=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return t=this.computeCountExpression(),[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(t,"cnt").setOption("disable-global-order").loadRawResults(e)];case 1:return(n=r.sent())&&n[0]&&n[0].cnt?[2,parseInt(n[0].cnt)]:[2,0]}}))}))},t.prototype.executeEntitiesAndRawResults=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var n,i,a,l,h,p,f,d,b,E,w,T,N,M,A,R,x,O,S,P=this;return(0,r.Jh)(this,(function(I){switch(I.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new u;if("optimistic"===this.expressionMap.lockMode&&!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn)throw new c(n.name);return i=new m(this.connection,e,this.expressionMap.relationIdAttributes),a=new v(this.connection,e,this.expressionMap.relationCountAttributes),new y(this.expressionMap).transform(),new g(this.expressionMap).transform(),l=[],h=[],(this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0?(p=(0,r.CR)(this.createOrderByCombinedWithSelectExpression("distinctAlias"),2),f=p[0],d=p[1],b=this.expressionMap.mainAlias.metadata,E=this.expressionMap.mainAlias.name,w=b.primaryColumns.map((function(e){var t=P.escape("distinctAlias"),n=P.escape(o.z.buildColumnAlias(P.connection.driver,E,e.databaseName));return d[n]||(d[n]="ASC"),t+"."+n+' as "'+o.z.buildColumnAlias(P.connection.driver,"ids_"+E,e.databaseName)+'"'})),[4,new t(this.connection,e).select("DISTINCT "+w.join(", ")).addSelect(f).from("("+this.clone().orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(d).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return(l=I.sent()).length>0?(T="",N={},b.hasMultiplePrimaryKeys?T=l.map((function(e,t){return b.primaryColumns.map((function(n){var r="orm_distinct_ids_"+t+"_"+n.databaseName;return N[r]=e["ids_"+E+"_"+n.databaseName],E+"."+n.propertyPath+"=:"+r})).join(" AND ")})).join(" OR "):(M=o.z.buildColumnAlias(this.connection.driver,"ids_"+E,b.primaryColumns[0].databaseName),(A=l.map((function(e){return e[M]}))).every((function(e){return"number"==typeof e}))?T=E+"."+b.primaryColumns[0].propertyPath+" IN ("+A.join(", ")+")":(N.orm_distinct_ids=A,T=E+"."+b.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:T}).setParameters(N).loadRawResults(e)]):[3,3];case 2:l=I.sent(),I.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:l=I.sent(),I.label=6;case 6:return l.length>0?[4,i.load(l)]:[3,10];case 7:return R=I.sent(),[4,a.load(l)];case 8:return x=I.sent(),O=new s(this.expressionMap,this.connection.driver,R,x,this.queryRunner),h=O.transform(l,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(S=new C.D,e.broadcaster.broadcastLoadEventsForAll(S,this.expressionMap.mainAlias.metadata,h),S.promises.length>0?[4,Promise.all(S.promises)]:[3,10]):[3,10];case 9:I.sent(),I.label=10;case 10:return[2,{raw:l,entities:h}]}}))}))},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,r=Object.keys(n).map((function(n){if(-1!==n.indexOf(".")){var r=n.split("."),i=r[0],a=r.slice(1).join("."),s=t.expressionMap.findAliasByName(i).metadata.findColumnWithPropertyPath(a);return t.escape(e)+"."+t.escape(o.z.buildColumnAlias(t.connection.driver,i,s.databaseName))}return t.expressionMap.selects.find((function(e){return e.selection===n||e.aliasName===n}))?t.escape(e)+"."+n:""})).join(", "),i={};return Object.keys(n).forEach((function(r){if(-1!==r.indexOf(".")){var a=r.split("."),s=a[0],u=a.slice(1).join("."),c=t.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(u);i[t.escape(e)+"."+t.escape(o.z.buildColumnAlias(t.connection.driver,s,c.databaseName))]=n[r]}else t.expressionMap.selects.find((function(e){return e.selection===r||e.aliasName===r}))?i[t.escape(e)+"."+r]=n[r]:i[r]=n[r]})),[r,i]},t.prototype.loadRawResults=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:return t=(0,r.CR)(this.getQueryAndParameters(),2),n=t[0],i=t[1],a=n+" -- PARAMETERS: "+JSON.stringify(i),o="object"==typeof this.connection.options.cache?this.connection.options.cache:{},s=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},e)]:[3,2];case 1:if((s=c.sent())&&!this.connection.queryResultCache.isExpired(s))return[2,JSON.parse(s.result)];c.label=2;case 2:return[4,e.query(n,i)];case 3:return u=c.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(u)},s,e)]:[3,5];case 4:c.sent(),c.label=5;case 5:return[2,u]}}))}))},t.prototype.mergeExpressionMap=function(e){return N.g.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return"number"==typeof e||null==e?e:Number(e)},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},t}(b.z)},3093:(e,t,n)=>{"use strict";n.d(t,{B:()=>y});var r=n(518),i=n(5585),a=n(3404),o=n(5547),s=n(6572),u=n(4324),c=n(8529),l=n(3730),h=n(3781),p=n(2108),f=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDeleteDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have delete date columns.',r}return(0,r.ZT)(t,e),t}(Error),d=n(8163),m=n(8154),y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,a,s,h,p,f,d,m;return(0,r.Jh)(this,(function(y){switch(y.label){case 0:e=this.obtainQueryRunner(),t=!1,y.label=1;case 1:return y.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:y.sent(),t=!0,y.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(d=new l.D,e.broadcaster.broadcastBeforeUpdateEvent(d,this.expressionMap.mainAlias.metadata),d.promises.length>0?[4,Promise.all(d.promises)]:[3,5]):[3,5];case 4:y.sent(),y.label=5;case 5:return n=new u.v(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=n.getUpdationReturningColumns()),a=(0,r.CR)(this.getQueryAndParameters(),2),s=a[0],h=a[1],p=new o.s,[4,e.query(s,h)];case 6:return f=y.sent(),e.connection.driver instanceof i.U4?(p.raw=f[0],p.affected=f[1]):p.raw=f,!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,n.update(p,this.expressionMap.whereEntities)]:[3,8];case 7:y.sent(),y.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(d=new l.D,e.broadcaster.broadcastAfterUpdateEvent(d,this.expressionMap.mainAlias.metadata),d.promises.length>0?[4,Promise.all(d.promises)]:[3,10]):[3,10];case 9:y.sent(),y.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:y.sent(),y.label=12;case 12:return[2,p];case 13:if(m=y.sent(),!t)return[3,17];y.label=14;case 14:return y.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:case 16:return y.sent(),[3,17];case 17:throw m;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:y.sent(),y.label=20;case 20:return this.connection.driver instanceof c.x&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:y.sent(),y.label=22;case 22:return[7];case 23:return[2]}}))}))},t.prototype.from=function(e,t){e=e instanceof m.I?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new s.y;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach((function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)})),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new Error('Cannot get entity metadata for the given alias "'+this.expressionMap.mainAlias+'"');if(!e.deleteDateColumn)throw new f(e);var t=[];switch(this.expressionMap.queryType){case"soft-delete":t.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":t.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new Error('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),t.length<=0)throw new d.y;(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.XR||this.connection.driver instanceof h.w)&&(this.expressionMap.nativeParameters=Object.assign({},this.expressionMap.nativeParameters));var n=this.createWhereExpression(),r=this.createReturningExpression();return r&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof i.XR||this.connection.driver instanceof i.J1)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n+" RETURNING "+r:r&&this.connection.driver instanceof i.Z0?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+" OUTPUT "+r+n:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.p$)return" LIMIT "+e;throw new p.T}return""},t}(a.z)},7938:(e,t,n)=>{"use strict";n.d(t,{T:()=>y});var r=n(518),i=n(5585),a=n(3404),o=n(7837),s=n(5547),u=n(6572),c=n(4324),l=n(8529),h=n(3730),p=n(3781),f=n(2108),d=n(8163),m=n(7126),y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,a,o,u,p,f,d,m,y,v,g;return(0,r.Jh)(this,(function(b){switch(b.label){case 0:e=this.obtainQueryRunner(),t=!1,b.label=1;case 1:return b.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:b.sent(),t=!0,b.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(v=new h.D,e.broadcaster.broadcastBeforeUpdateEvent(v,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),v.promises.length>0?[4,Promise.all(v.promises)]:[3,5]):[3,5];case 4:b.sent(),b.label=5;case 5:return n=null,a=null,o=new c.v(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=o.getUpdationReturningColumns(),this.expressionMap.extraReturningColumns.length>0&&this.connection.driver instanceof i.Z0&&(n=this.connection.driver.buildTableVariableDeclaration("@OutputTable",this.expressionMap.extraReturningColumns),a="SELECT * FROM @OutputTable")),u=(0,r.CR)(this.getQueryAndParameters(),2),p=u[0],f=u[1],d=new s.s,m=[n,p,a],[4,e.query(m.filter((function(e){return null!=e})).join(";\n\n"),f)];case 6:return y=b.sent(),this.connection.driver instanceof i.U4?(d.raw=y[0],d.affected=y[1]):this.connection.driver instanceof i.p$?(d.raw=y,d.affected=y.affectedRows):this.connection.driver instanceof i.R4?(d.raw=y,d.affected=y.changes):d.raw=y,!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,o.update(d,this.expressionMap.whereEntities)]:[3,8];case 7:b.sent(),b.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(v=new h.D,e.broadcaster.broadcastAfterUpdateEvent(v,this.expressionMap.mainAlias.metadata),v.promises.length>0?[4,Promise.all(v.promises)]:[3,10]):[3,10];case 9:b.sent(),b.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:b.sent(),b.label=12;case 12:return[2,d];case 13:if(g=b.sent(),!t)return[3,17];b.label=14;case 14:return b.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:case 16:return b.sent(),[3,17];case 17:throw g;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:b.sent(),b.label=20;case 20:return this.connection.driver instanceof l.x&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:b.sent(),b.label=22;case 22:return[7];case 23:return[2]}}))}))},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new u.y;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach((function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)})),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[],a=[],s={},u=this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI||this.connection.driver instanceof i.XR||this.connection.driver instanceof p.w||this.connection.driver instanceof i.tU?0:Object.keys(this.expressionMap.nativeParameters).length;if(n?(o.T.createPropertyPath(n,t).forEach((function(o){var c=n.findColumnsWithPropertyPath(o);if(c.length<=0)throw new m.n(o);c.forEach((function(n){if(n.isUpdate){a.push(n);var o="upd_"+n.databaseName,c=n.getEntityValue(t);if(n.referencedColumn&&c instanceof Object?c=n.referencedColumn.getEntityValue(c):c instanceof Function||(c=e.connection.driver.preparePersistentValue(c,n)),c instanceof Function)r.push(e.escape(n.databaseName)+" = "+c());else if(e.connection.driver instanceof i.tU&&null===c)r.push(e.escape(n.databaseName)+" = NULL");else{e.connection.driver instanceof i.Z0&&(c=e.connection.driver.parametrizeValue(n,c)),e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI||e.connection.driver instanceof i.XR||e.connection.driver instanceof p.w||e.connection.driver instanceof i.tU?s[o]=c:e.expressionMap.nativeParameters[o]=c;var l=null;if((e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI)&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)){var h=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";l=null!=n.srid?h+"("+e.connection.driver.createParameter(o,u)+", "+n.srid+")":h+"("+e.connection.driver.createParameter(o,u)+")"}else l=e.connection.driver instanceof i.U4&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?null!=n.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(o,u)+"), "+n.srid+")::"+n.type:"ST_GeomFromGeoJSON("+e.connection.driver.createParameter(o,u)+")::"+n.type:e.connection.driver instanceof i.Z0&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?n.type+"::STGeomFromText("+e.connection.driver.createParameter(o,u)+", "+(n.srid||"0")+")":e.connection.driver.createParameter(o,u);r.push(e.escape(n.databaseName)+" = "+l),u++}}}))})),n.versionColumn&&-1===a.indexOf(n.versionColumn)&&r.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&-1===a.indexOf(n.updateDateColumn)&&r.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(t).map((function(n){var a=t[n];a instanceof Function?r.push(e.escape(n)+" = "+a()):e.connection.driver instanceof i.tU&&null===a?r.push(e.escape(n)+" = NULL"):(e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI||e.connection.driver instanceof i.XR||e.connection.driver instanceof p.w||e.connection.driver instanceof i.tU?s[n]=a:e.expressionMap.nativeParameters[n]=a,r.push(e.escape(n)+" = "+e.connection.driver.createParameter(n,u)),u++)})),r.length<=0)throw new d.y;(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI||this.connection.driver instanceof i.XR||this.connection.driver instanceof p.w||this.connection.driver instanceof i.tU)&&(this.expressionMap.nativeParameters=Object.assign(s,this.expressionMap.nativeParameters));var c=this.createWhereExpression(),l=this.createReturningExpression();return l&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof i.XR||this.connection.driver instanceof i.J1)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+c+" RETURNING "+l:l&&this.connection.driver instanceof i.Z0?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+" OUTPUT "+l+c:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+c},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)return" LIMIT "+e;throw new f.T}return""},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new d.y},t}(a.z)},2644:(e,t,n)=>{"use strict";n.d(t,{$:()=>o});var r=n(518),i=n(767),a=n(4205),o=function(){function e(e,t){this.expressionMap=e,a.g.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=(0,r.CR)(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rc"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=(0,r.CR)(this.relationName.split("."),2),t=e[0],n=e[1],a=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!a)throw new Error("Relation with property path "+n+" in entity was not found.");return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},5344:(e,t,n)=>{"use strict";n.d(t,{b:()=>o});var r=n(518),i=n(767),a=n(4205),o=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,a.g.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=(0,r.CR)(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rid"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}()},7296:(e,t,n)=>{"use strict";n.d(t,{y:()=>r});var r=function(){}},1920:(e,t,n)=>{"use strict";n.d(t,{t:()=>r});var r=function(){this.identifiers=[],this.generatedMaps=[]}},5547:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var r=function(){this.generatedMaps=[]}},7962:(e,t,n)=>{"use strict";n.d(t,{Y:()=>o});var r=n(518),i=n(28),a=function(){this.upQueries=[],this.downQueries=[]},o=function(){function e(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new a}return e.prototype.getTable=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadTables([e])];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables.length>0?this.loadedTables[0]:void 0]}}))}))},e.prototype.getTables=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadTables(e)];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables]}}))}))},e.prototype.getView=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadViews([e])];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews.length>0?this.loadedViews[0]:void 0]}}))}))},e.prototype.getViews=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadViews(e)];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews]}}))}))},e.prototype.enableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!1},e.prototype.clearSqlMemory=function(){this.sqlInMemory=new a},e.prototype.getMemorySql=function(){return this.sqlInMemory},e.prototype.executeMemoryUpSql=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=(0,r.XA)(this.sqlInMemory.upQueries),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(n=t.value,i=n.query,a=n.parameters,[4,this.query(i,a)]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},e.prototype.executeMemoryDownSql=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=(0,r.XA)(this.sqlInMemory.downQueries.reverse()),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(n=t.value,i=n.query,a=n.parameters,[4,this.query(i,a)]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},e.prototype.getCachedView=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(t=this.loadedViews.find((function(t){return t.name===e})))?[2,t]:[4,this.loadViews([e])];case 1:if((n=r.sent()).length>0)return this.loadedViews.push(n[0]),[2,n[0]];throw new Error('View "'+e+'" does not exist.')}}))}))},e.prototype.getCachedTable=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return(t=this.loadedTables.find((function(t){return t.name===e})))?[2,t]:[4,this.loadTables([e])];case 1:if((n=r.sent()).length>0)return this.loadedTables.push(n[0]),[2,n[0]];throw new Error('Table "'+e+'" does not exist.')}}))}))},e.prototype.replaceCachedTable=function(e,t){var n=this.loadedTables.find((function(t){return t.name===e.name}));n&&(n.name=t.name,n.columns=t.columns,n.indices=t.indices,n.foreignKeys=t.foreignKeys,n.uniques=t.uniques,n.checks=t.checks,n.justCreated=t.justCreated,n.engine=t.engine)},e.prototype.getTypeormMetadataTableName=function(){var e=this.connection.driver.options;return this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database)},e.prototype.isColumnChanged=function(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||e.enum!==t.enum},e.prototype.isDefaultColumnLength=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.length)return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length)&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()},e.prototype.isDefaultColumnPrecision=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.precision&&void 0!==r.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].precision||void 0===this.connection.driver.dataTypeDefaults[t.type].precision)&&this.connection.driver.dataTypeDefaults[t.type].precision===n},e.prototype.isDefaultColumnScale=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.scale&&void 0!==r.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].scale||void 0===this.connection.driver.dataTypeDefaults[t.type].scale)&&this.connection.driver.dataTypeDefaults[t.type].scale===n},e.prototype.executeQueries=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n,a,o,s,u,c,l,h,p,f;return(0,r.Jh)(this,(function(d){switch(d.label){case 0:if(e instanceof i.A&&(e=[e]),t instanceof i.A&&(t=[t]),(l=this.sqlInMemory.upQueries).push.apply(l,(0,r.fl)(e)),(h=this.sqlInMemory.downQueries).push.apply(h,(0,r.fl)(t)),!0===this.sqlMemoryMode)return[2,Promise.resolve()];d.label=1;case 1:d.trys.push([1,6,7,8]),n=(0,r.XA)(e),a=n.next(),d.label=2;case 2:return a.done?[3,5]:(o=a.value,s=o.query,u=o.parameters,[4,this.query(s,u)]);case 3:d.sent(),d.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return c=d.sent(),p={error:c},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(p)throw p.error}return[7];case 8:return[2]}}))}))},e}()},9431:(e,t,n)=>{"use strict";n.d(t,{i:()=>l});var r=n(3586),i=n(5704),a=n(8836),o=n(4449),s=n(8946),u=n(988),c=n(6838),l=function(){function e(e){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,e&&(this.name=e.name,e.columns&&(this.columns=e.columns.map((function(e){return new r.D(e)}))),e.indices&&(this.indices=e.indices.map((function(e){return new i.s(e)}))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map((function(e){return new a.U(e)}))),e.uniques&&(this.uniques=e.uniques.map((function(e){return new s.v(e)}))),e.checks&&(this.checks=e.checks.map((function(e){return new u.r(e)}))),e.exclusions&&(this.exclusions=e.exclusions.map((function(e){return new c.N(e)}))),void 0!==e.justCreated&&(this.justCreated=e.justCreated),this.engine=e.engine)}return Object.defineProperty(e.prototype,"primaryColumns",{get:function(){return this.columns.filter((function(e){return e.isPrimary}))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e({name:this.name,columns:this.columns.map((function(e){return e.clone()})),indices:this.indices.map((function(e){return e.clone()})),foreignKeys:this.foreignKeys.map((function(e){return e.clone()})),uniques:this.uniques.map((function(e){return e.clone()})),checks:this.checks.map((function(e){return e.clone()})),exclusions:this.exclusions.map((function(e){return e.clone()})),justCreated:this.justCreated,engine:this.engine})},e.prototype.addColumn=function(e){this.columns.push(e)},e.prototype.removeColumn=function(e){var t=this.columns.find((function(t){return t.name===e.name}));t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.addUniqueConstraint=function(e){if(this.uniques.push(e),1===e.columnNames.length){var t=this.columns.find((function(t){return t.name===e.columnNames[0]}));t&&(t.isUnique=!0)}},e.prototype.removeUniqueConstraint=function(e){var t=this.uniques.find((function(t){return t.name===e.name}));if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){var n=this.columns.find((function(e){return e.name===t.columnNames[0]}));n&&(n.isUnique=!1)}},e.prototype.addCheckConstraint=function(e){this.checks.push(e)},e.prototype.removeCheckConstraint=function(e){var t=this.checks.find((function(t){return t.name===e.name}));t&&this.checks.splice(this.checks.indexOf(t),1)},e.prototype.addExclusionConstraint=function(e){this.exclusions.push(e)},e.prototype.removeExclusionConstraint=function(e){var t=this.exclusions.find((function(t){return t.name===e.name}));t&&this.exclusions.splice(this.exclusions.indexOf(t),1)},e.prototype.addForeignKey=function(e){this.foreignKeys.push(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find((function(t){return t.name===e.name}));t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.addIndex=function(e,t){if(void 0===t&&(t=!1),this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){var n=this.columns.find((function(t){return t.name===e.columnNames[0]}));n&&(n.isUnique=!0)}},e.prototype.removeIndex=function(e,t){void 0===t&&(t=!1);var n=this.indices.find((function(t){return t.name===e.name}));if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){var r=this.columns.find((function(e){return e.name===n.columnNames[0]}));r&&(r.isUnique=this.indices.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===r.name&&!!n.isUnique})))}},e.prototype.findColumnByName=function(e){return this.columns.find((function(t){return t.name===e}))},e.prototype.findColumnIndices=function(e){return this.indices.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnForeignKeys=function(e){return this.foreignKeys.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnUniques=function(e){return this.uniques.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnChecks=function(e){return this.checks.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),engine:t.engine,columns:t.columns.filter((function(e){return e})).map((function(e){return o.P.createTableColumnOptions(e,n)})),indices:t.indices.filter((function(e){return!0===e.synchronize})).map((function(e){return i.s.create(e)})),uniques:t.uniques.map((function(e){return s.v.create(e)})),checks:t.checks.map((function(e){return u.r.create(e)})),exclusions:t.exclusions.map((function(e){return c.N.create(e)}))})},e}()},988:(e,t,n)=>{"use strict";n.d(t,{r:()=>i});var r=n(518),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,columnNames:this.columnNames?(0,r.fl)(this.columnNames):[],expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},3586:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||e.unsigned||!1,this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}return e.prototype.clone=function(){return new e({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},e}()},6838:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var r=function(){function e(e){this.name=e.name,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},8836:(e,t,n)=>{"use strict";n.d(t,{U:()=>i});var r=n(518),i=function(){function e(e){this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.fl)(this.columnNames),referencedColumnNames:(0,r.fl)(this.referencedColumnNames),referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})},e.create=function(t){return new e({name:t.name,columnNames:t.columnNames,referencedColumnNames:t.referencedColumnNames,referencedTableName:t.referencedTablePath,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable})},e}()},5704:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});var r=n(518),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.parser=e.parser,this.where=e.where?e.where:""}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.fl)(this.columnNames),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,parser:this.parser,where:this.where})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map((function(e){return e.databaseName})),isUnique:t.isUnique,isSpatial:t.isSpatial,isFulltext:t.isFulltext,parser:t.parser,where:t.where})},e}()},8946:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var r=n(518),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.fl)(this.columnNames)})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map((function(e){return e.databaseName}))})},e}()},4449:(e,t,n)=>{"use strict";n.d(t,{P:()=>r});var r=function(){function e(){}return e.createTableColumnOptions=function(e,t){return{name:e.databaseName,length:e.length,width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map((function(e){return e+""})):e.enum,enumName:e.enumName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}},e}()},9368:(e,t,n)=>{"use strict";n.d(t,{G:()=>r});var r=function(){function e(e){e&&(this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression,materialized:this.materialized})},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),expression:t.expression,materialized:t.tableMetadataArgs.materialized})},e}()},5725:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});var r=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,n){var r=this;n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var a=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))},e.prototype.broadcastBeforeUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(s){if(o.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){var u=s.beforeUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}}))},e.prototype.broadcastBeforeRemoveEvent=function(e,t,n,r){var i=this;n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(a){if(i.isAllowedSubscriber(a,t.target)&&a.beforeRemove){var o=a.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}}))},e.prototype.broadcastAfterInsertEvent=function(e,t,n){var r=this;n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterInsert){var a=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))},e.prototype.broadcastBeforeTransactionStartEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.beforeTransactionStart){var r=n.beforeTransactionStart({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterTransactionStartEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.afterTransactionStart){var r=n.afterTransactionStart({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastBeforeTransactionCommitEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.beforeTransactionCommit){var r=n.beforeTransactionCommit({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterTransactionCommitEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.afterTransactionCommit){var r=n.afterTransactionCommit({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastBeforeTransactionRollbackEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.beforeTransactionRollback){var r=n.beforeTransactionRollback({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterTransactionRollbackEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.afterTransactionRollback){var r=n.afterTransactionRollback({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(s){if(o.isAllowedSubscriber(s,t.target)&&s.afterUpdate){var u=s.afterUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}}))},e.prototype.broadcastAfterRemoveEvent=function(e,t,n,r){var i=this;n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(a){if(i.isAllowedSubscriber(a,t.target)&&a.afterRemove){var o=a.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}}))},e.prototype.broadcastLoadEventsForAll=function(e,t,n){var r=this;n.forEach((function(n){n instanceof Promise||(t.relations.length&&t.relations.forEach((function(t){if(!t.isLazy||n.hasOwnProperty(t.propertyName)){var i=t.getEntityValue(n);i instanceof Object&&r.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,Array.isArray(i)?i:[i])}})),t.afterLoadListeners.length&&t.afterLoadListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterLoad){var a=i.afterLoad(n,{connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})))}))},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}()},3730:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var r=function(){this.count=0,this.promises=[]}},7718:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var r=function(){function e(){}return e.transformFrom=function(e,t){return Array.isArray(e)?e.slice().reverse().reduce((function(e,t){return t.from(e)}),t):e.from(t)},e.transformTo=function(e,t){return Array.isArray(e)?e.reduce((function(e,t){return t.to(e)}),t):e.to(t)},e}()},7155:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var r=n(518),i=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&"string"==typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r="string"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"==typeof e){var t=(0,r.CR)(e.split(":"),3),n=t[0],i=t[1],a=t[2],o=new Date;return n&&o.setHours(parseInt(n)),i&&o.setMinutes(parseInt(i)),a&&o.setSeconds(parseInt(a)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map((function(e){return 1===e.length?"0"+e:e})).join(":"):e},e.mixedDateToDatetimeString=function(e,t){if("string"==typeof e&&(e=new Date(e)),e instanceof Date){var n=this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());t&&(n+="."+this.formatMilliseconds(e.getMilliseconds())),e=n}return e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return Array.isArray(e)?e.map((function(e){return String(e)})).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.length>0?e.split(","):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){return"string"==typeof e?JSON.parse(e):e},e.simpleEnumToString=function(e){return""+e},e.stringToSimpleEnum=function(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<10?"00"+e:e<100?"0"+e:String(e)},e}()},4205:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});var r=n(518),i=function(){function e(){}return e.assign=function(e){for(var t,n,i,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u=(0,r.XA)(o),c=u.next();!c.done;c=u.next()){var l=c.value;try{for(var h=(i=void 0,(0,r.XA)(Object.getOwnPropertyNames(l))),p=h.next();!p.done;p=h.next()){var f=p.value;e[f]=l[f]}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}},e}()},8731:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});var r=n(518),i=function(){function e(){}return e.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),(function(n,r){return e.slice(r*t,r*t+t)}))},e.splitClassesAndStrings=function(e){return[e.filter((function(e){return"string"!=typeof e})),e.filter((function(e){return"string"==typeof e}))]},e.groupBy=function(e,t){return e.reduce((function(e,n){var r=t(n),i=e.find((function(e){return e.id===r}));return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e}),[])},e.uniq=function(e,t){return e.reduce((function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find((function(e){return t(e)===i}))}else r="string"==typeof t?!!e.find((function(e){return e[t]===n[t]})):-1!==e.indexOf(n);return r||e.push(n),e}),[])},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t,n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(!i.length)return e;var o=i.shift();if(this.isObject(e)&&this.isObject(o))for(var s in o){var u=o[s];"__proto__"===s||u instanceof Promise||(!this.isObject(u)||u instanceof Map||u instanceof Set||u instanceof Date||u instanceof Buffer||u instanceof RegExp?Object.assign(e,((n={})[s]=u,n)):(e[s]||Object.assign(e,((t={})[s]=Object.create(Object.getPrototypeOf(u)),t)),this.mergeDeep(e[s],u)))}return this.mergeDeep.apply(this,(0,r.fl)([e],i))},e.deepCompare=function(){for(var e,t,n,r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(n=[],r=[],!this.compare2Objects(n,r,arguments[0],arguments[e]))return!1;return!0},e.compareIds=function(t,n){return null!=t&&null!=n&&(("string"==typeof t.id&&"string"==typeof n.id||"number"==typeof t.id&&"number"==typeof n.id)&&1===Object.keys(t).length&&1===Object.keys(n).length?t.id===n.id:e.deepCompare(t,n))},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})},e.isArraysEqual=function(e,t){return e.length===t.length&&e.every((function(e){return-1!==t.indexOf(e)}))},e.compare2Objects=function(e,t,n,r){var i;if(Number.isNaN(n)&&Number.isNaN(r))return!0;if(n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if(("function"==typeof n.equals||n.equals instanceof Function)&&n.equals(r))return!0;if("function"==typeof n&&"function"==typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||n instanceof String&&r instanceof String||n instanceof Number&&r instanceof Number)return n.toString()===r.toString();if(!(n instanceof Object&&r instanceof Object))return!1;if(n.isPrototypeOf(r)||r.isPrototypeOf(n))return!1;if(n.constructor!==r.constructor)return!1;if(n.prototype!==r.prototype)return!1;if(e.indexOf(n)>-1||t.indexOf(r)>-1)return!1;for(i in r){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1}for(i in n){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1;switch(typeof n[i]){case"object":case"function":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[i],r[i]))return!1;e.pop(),t.pop();break;default:if(n[i]!==r[i])return!1}}return!0},e}()},2972:(e,t,n)=>{"use strict";n.d(t,{f:()=>r});var r=function(){function e(){}return e.sha1=function(e){var t,n,r,i,a,o,s,u,c,l=function(e,t){return e<<t|e>>>32-t},h=function(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},p=new Array(80),f=1732584193,d=4023233417,m=2562383102,y=271733878,v=3285377520,g=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<g-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(g%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(g-1)<<24|8388608;break;case 2:n=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:n=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(g>>>29),b.push(g<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=f,a=d,o=m,s=y,u=v,n=0;n<=19;n++)c=l(i,5)+(a&o|~a&s)+u+p[n]+1518500249&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(a^o^s)+u+p[n]+1859775393&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(a&o|a&s|o&s)+u+p[n]+2400959708&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(a^o^s)+u+p[n]+3395469782&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;f=f+i&4294967295,d=d+a&4294967295,m=m+o&4294967295,y=y+s&4294967295,v=v+u&4294967295}return(c=h(f)+h(d)+h(m)+h(y)+h(v)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e}()},3169:(e,t,n)=>{"use strict";n.d(t,{eV:()=>a,fu:()=>o,Qs:()=>s,OV:()=>u,vp:()=>c});var r=n(4706),i=n.n(r);function a(e,t){return void 0===t&&(t=!1),e.replace(/^([A-Z])|[\s-_](\w)/g,(function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()}))}function o(e){return e.replace(/(?:([a-z])([A-Z]))|(?:((?!^)[A-Z])([a-z]))/g,"$1_$3$2$4").toLowerCase()}function s(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function u(e,t){void 0===t&&(t={});var n=t.segmentLength,r=void 0===n?4:n,i=t.separator,a=void 0===i?"__":i,o=t.termLength,s=void 0===o?2:o;return e.split(a).reduce((function(e,t){var n=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),i=n.length>1?s:r,a=n.map((function(e){return e.substr(0,i)})).join("");return e.push(a),e}),[]).join(a)}function c(e,t){void 0===t&&(t={});var n=i()("sha256");n.update(e,"utf8");var r=n.digest("hex");return t.length?r.slice(0,t.length):r}},9483:(e,t,n)=>{e.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,n,r)}return n[o].exports}for(var a=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var a=0,o=new i(l),s=e.document.createTextNode("");o.observe(s,{characterData:!0}),n=function(){s.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var u=new e.MessageChannel;u.port1.onmessage=l,n=function(){u.port2.postMessage(0)}}var c=[];function l(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}t.exports=function(e){1!==c.push(e)||r||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var a={},o=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)}))}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function i(t){n||(n=!0,a.resolve(e,t))}var o=d((function(){t(i,r)}));"error"===o.status&&r(o.value)}function d(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==u?h(n,this.state===s?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){a.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=d(p,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=s,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:a.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return a.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,u=-1,c=new this(i);++u<n;)l(e[u],u);return c;function l(e,i){t.resolve(e).then((function(e){o[i]=e,++s!==n||r||(r=!0,a.resolve(c,o))}),(function(e){r||(r=!0,a.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,r=e.length,o=!1;if(!r)return this.resolve([]);for(var s=-1,u=new this(i);++s<r;)n=e[s],t.resolve(n).then((function(e){o||(o=!0,a.resolve(u,e))}),(function(e){o||(o=!0,a.reject(u,e))}));return u}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function a(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",p=void 0,f={},d=Object.prototype.toString,m="readonly",y="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function g(e){return"boolean"==typeof p?o.resolve(p):function(e){return new o((function(t){var n=e.transaction(h,y),r=a([""]);n.objectStore(h).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return p=e}))}function b(e){var t=f[e.name],n={};n.promise=new o((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function E(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function w(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function T(e,t){return new o((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);b(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var o=i.open.apply(i,a);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){n(o.result),E(e)}}))}function C(e){return T(e,!1)}function N(e){return T(e,!0)}function M(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function A(e){return a([v(atob(e.data))],{type:e.type})}function R(e){return e&&e.__local_forage_encoded_blob}function x(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function O(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),N(e)})).then((function(){return function(e){b(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,C(e).then((function(t){return e.db=t,M(e)?N(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw w(e,t),t}))}(e).then((function(){O(e,t,n,r-1)}))})).catch(n);n(i)}}var S={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=f[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=x);var a=[];function s(){return o.resolve()}for(var u=0;u<i.forages.length;u++){var c=i.forages[u];c!==t&&a.push(c._initReady().catch(s))}var l=i.forages.slice(0);return o.all(a).then((function(){return n.db=i.db,C(n)})).then((function(e){return n.db=e,M(n,t._defaultConfig.version)?N(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var a=l[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){O(n._dbInfo,m,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;R(r)&&(r=A(r));var i=e(r,n.key,s++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){O(n._dbInfo,m,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),R(e)&&(e=A(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var i=new o((function(n,i){var a;r.ready().then((function(){return a=r._dbInfo,"[object Blob]"===d.call(t)?g(a.db).then((function(e){return e?t:(n=t,new o((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){O(r._dbInfo,y,(function(a,o){if(a)return i(a);try{var s=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=u.error?u.error:u.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return s(i,n),i},removeItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){O(n._dbInfo,y,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(o.error)},a.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){O(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){O(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){e<0?t(null):n.ready().then((function(){O(n._dbInfo,m,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName),s=!1,u=o.openKeyCursor();u.onsuccess=function(){var n=u.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},u.onerror=function(){r(u.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){O(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];a.onsuccess=function(){var t=a.result;t?(o.push(t.key),t.continue()):e(o)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,a=this;if(e.name){var u=e.name===n.name&&a._dbInfo.db?o.resolve(a._dbInfo.db):C(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?u.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;b(e);var r=f[e.name],a=r.forages;t.close();for(var s=0;s<a.length;s++){var u=a[s];u._dbInfo.db=null,u._dbInfo.version=n}return new o((function(t,r){var a=i.open(e.name,n);a.onerror=function(e){a.result.close(),r(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<a.length;t++){var n=a[t];n._dbInfo.db=e,E(n._dbInfo)}})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}})):u.then((function(t){b(e);var n=f[e.name],r=n.forages;t.close();for(var a=0;a<r.length;a++)r[a]._dbInfo.db=null;return new o((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)E(r[t]._dbInfo)})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}))}else r=o.reject("Invalid arguments");return s(r,t),r}};var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",I=/^~~local_forage_type~([^~]+)~/,_="__lfsc__:",j=_.length,q="arbf",D="blob",L="si08",B="ui08",U="uic8",F="si16",J="si32",k="ur16",G="ui32",Q="fl32",V="fl64",W=j+q.length,z=Object.prototype.toString;function K(e){var t,n,r,i,a,o=.75*e.length,s=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var c=new ArrayBuffer(o),l=new Uint8Array(c);for(t=0;t<s;t+=4)n=P.indexOf(e[t]),r=P.indexOf(e[t+1]),i=P.indexOf(e[t+2]),a=P.indexOf(e[t+3]),l[u++]=n<<2|r>>4,l[u++]=(15&r)<<4|i>>2,l[u++]=(3&i)<<6|63&a;return c}function Z(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=P[n[t]>>2],r+=P[(3&n[t])<<4|n[t+1]>>4],r+=P[(15&n[t+1])<<2|n[t+2]>>6],r+=P[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var H={serialize:function(e,t){var n="";if(e&&(n=z.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===z.call(e.buffer))){var r,i=_;e instanceof ArrayBuffer?(r=e,i+=q):(r=e.buffer,"[object Int8Array]"===n?i+=L:"[object Uint8Array]"===n?i+=B:"[object Uint8ClampedArray]"===n?i+=U:"[object Int16Array]"===n?i+=F:"[object Uint16Array]"===n?i+=k:"[object Int32Array]"===n?i+=J:"[object Uint32Array]"===n?i+=G:"[object Float32Array]"===n?i+=Q:"[object Float64Array]"===n?i+=V:t(new Error("Failed to get type for BinaryArray"))),t(i+Z(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n="~~local_forage_type~"+e.type+"~"+Z(this.result);t("__lfsc__:blob"+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,j)!==_)return JSON.parse(e);var t,n=e.substring(W),r=e.substring(j,W);if(r===D&&I.test(n)){var i=n.match(I);t=i[1],n=n.substring(i[0].length)}var o=K(n);switch(r){case q:return o;case D:return a([o],{type:t});case L:return new Int8Array(o);case B:return new Uint8Array(o);case U:return new Uint8ClampedArray(o);case F:return new Int16Array(o);case k:return new Uint16Array(o);case J:return new Int32Array(o);case G:return new Uint32Array(o);case Q:return new Float32Array(o);case V:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}},stringToBuffer:K,bufferToString:Z};function X(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function Y(e,t,n,r,i,a){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?a(e,o):X(e,t,(function(){e.executeSql(n,r,i,a)}),a)}),a):a(e,o)}),a)}function $(e,t,n,r){var i=this;e=c(e);var a=new o((function(a,o){i.ready().then((function(){void 0===t&&(t=null);var s=t,u=i._dbInfo;u.serializer.serialize(t,(function(t,c){c?o(c):u.db.transaction((function(n){Y(n,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void a($.apply(i,[e,s,n,r-1]));o(t)}}))}))})).catch(o)}));return s(a,n),a}function ee(e){return new o((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],a=0;a<r.rows.length;a++)i.push(r.rows.item(a).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var te={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new o((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){X(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=H,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var a=r.rows,o=a.length,s=0;s<o;s++){var u=a.item(s),c=u.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,u.key,s+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return $.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Y(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Y(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Y(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return s(r=e.name?new o((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(ee(r))})).then((function(e){return new o((function(t,n){e.db.transaction((function(r){function i(e){return new o((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var a=[],s=0,u=e.storeNames.length;s<u;s++)a.push(i(e.storeNames[s]));o.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments"),t),r}};function ne(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function re(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var ie={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=ne(e,this._defaultConfig),re()?(this._dbInfo=t,t.serializer=H,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,a=localStorage.length,o=1,s=0;s<a;s++){var u=localStorage.key(s);if(0===u.indexOf(r)){var c=localStorage.getItem(u);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,u.substring(i),o++)))return c}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new o((function(i,a){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)a(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||a(e),a(e)}}))}))}));return s(i,n),i},removeItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var a=localStorage.key(i);0===a.indexOf(e.keyPrefix)&&r.push(a.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=l.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return s(r=e.name?new o((function(t){e.storeName?t(ne(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments"),t),r}},ae=function(e,t){for(var n=e.length,r=0;r<n;){if((i=e[r])===(a=t)||"number"==typeof i&&"number"==typeof a&&isNaN(i)&&isNaN(a))return!0;r++}var i,a;return!1},oe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},se={},ue={},ce={INDEXEDDB:S,WEBSQL:te,LOCALSTORAGE:ie},le=[ce.INDEXEDDB._driver,ce.WEBSQL._driver,ce.LOCALSTORAGE._driver],he=["dropInstance"],pe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(he),fe={description:"",driver:le.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function de(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function me(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(oe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ye=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ce)if(ce.hasOwnProperty(n)){var r=ce[n],i=r._driver;this[n]=i,se[i]||this.defineDriver(r)}this._defaultConfig=me({},fe),this._config=me({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new o((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var a=pe.concat("_initStorage"),u=0,c=a.length;u<c;u++){var l=a[u];if((!ae(he,l)||e[l])&&"function"!=typeof e[l])return void n(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=o.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=he.length;n<r;n++){var i=he[n];e[i]||(e[i]=t(i))}}();var h=function(n){se[r]&&console.info("Redefining LocalForage driver: "+r),se[r]=e,ue[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return u(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=se[e]?o.resolve(se[e]):o.reject(new Error("Driver not found."));return u(r,t,n),r},e.prototype.getSerializer=function(e){var t=o.resolve(H);return u(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;oe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function s(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}a();var u=new Error("No available storage method found.");return r._driverSet=o.reject(u),r._driverSet}()}}(i)}))})).catch((function(){a();var e=new Error("No available storage method found.");return r._driverSet=o.reject(e),r._driverSet})),u(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!ue[e]},e.prototype._extend=function(e){me(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=pe.length;e<t;e++)de(this,pe[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ye},{3:3}]},{},[4])(4)}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e,t=n(9878),r=new Uint8Array(16);function i(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(r)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&a.test(e)};for(var s=[],u=0;u<256;++u)s.push((u+256).toString(16).substr(1));const c=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase();if(!o(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var l=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class p{createUuid(){this.uuid=c()}toJSON(){return{...this,id:void 0}}}l([(0,t.bs)(),h("design:type",Number)],p.prototype,"id",void 0),l([(0,t.sg)({type:"uuid",unique:!0}),h("design:type",String)],p.prototype,"uuid",void 0),l([(0,t.er)(),h("design:type",Date)],p.prototype,"createdAt",void 0),l([(0,t.RU)(),h("design:type",Date)],p.prototype,"updatedAt",void 0),l([(0,t.Yc)(),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],p.prototype,"createUuid",null);var f=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let m=class extends p{constructor(e){super(),Object.assign(this,e)}validateGroup(){let e=0;if(this.chits.forEach((t=>{if(e+=t.noOfChits,20!==t.payments.length)throw Error("No of Payments is not equal to 20")})),20!==e)throw Error("No of chits in this group is not equal to 20")}};f([(0,t.sg)({unique:!0}),d("design:type",String)],m.prototype,"name",void 0),f([(0,t.sg)({nullable:!1}),d("design:type",String)],m.prototype,"batch",void 0),f([(0,t.sg)("integer"),d("design:type",Number)],m.prototype,"month",void 0),f([(0,t.sg)({nullable:!1}),d("design:type",Number)],m.prototype,"year",void 0),f([(0,t.IF)((e=>N),(e=>e.group),{cascade:!0}),d("design:type",Array)],m.prototype,"chits",void 0),f([(0,t.Yc)(),d("design:type",Function),d("design:paramtypes",[]),d("design:returntype",void 0)],m.prototype,"validateGroup",null),m=f([(0,t.JH)(),d("design:paramtypes",[Object])],m);const y=m;var v=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class extends p{constructor(e){super(),Object.assign(this,e)}};v([(0,t.sg)(),g("design:type",String)],b.prototype,"name",void 0),v([(0,t.sg)(),g("design:type",String)],b.prototype,"phone",void 0),v([(0,t.sg)(),g("design:type",String)],b.prototype,"address",void 0),v([(0,t.IF)((e=>N),(e=>e.user)),g("design:type",Array)],b.prototype,"chits",void 0),b=v([(0,t.JH)(),g("design:paramtypes",[Object])],b);const E=b;var w=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class extends p{constructor(e){super(),Object.assign(this,e)}};w([(0,t.Q2)(),(0,t.hA)((e=>E),(e=>e.chits)),T("design:type",E)],C.prototype,"user",void 0),w([(0,t.Q2)(),(0,t.hA)((e=>y),(e=>e.chits)),T("design:type",y)],C.prototype,"group",void 0),w([(0,t.sg)({nullable:!1}),T("design:type",Number)],C.prototype,"noOfChits",void 0),w([(0,t.IF)((e=>x),(e=>e.chit),{cascade:!0}),T("design:type",Array)],C.prototype,"payments",void 0),w([(0,t.sg)({type:"integer",nullable:!0}),T("design:type",Number)],C.prototype,"wonAtMonth",void 0),C=w([(0,t.JH)(),T("design:paramtypes",[Object])],C);const N=C;var M=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let R=class extends p{constructor(e){super(),Object.assign(this,e)}get toBePaid(){let e=5e3;return this.chit.wonAtMonth&&this.chit.wonAtMonth<this.imonth&&(e+=1e3),this.chit.noOfChits*e}get user(){return this.chit.user}};M([(0,t.hA)((e=>N),(e=>e.payments)),(0,t.Q2)(),A("design:type",N)],R.prototype,"chit",void 0),M([(0,t.sg)("integer",{nullable:!1}),A("design:type",Number)],R.prototype,"imonth",void 0),M([(0,t.sg)({nullable:!1}),A("design:type",Boolean)],R.prototype,"ispaid",void 0),R=M([(0,t.JH)(),A("design:paramtypes",[Object])],R);const x=R;var O=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let P=class{constructor(e){Object.assign(this,e)}};O([(0,t.bs)(),S("design:type",Number)],P.prototype,"id",void 0),O([(0,t.Q2)(),(0,t.hA)((e=>E)),S("design:type",E)],P.prototype,"user",void 0),O([(0,t.Q2)(),(0,t.hA)((e=>D),(e=>e.chits)),S("design:type",D)],P.prototype,"groupt",void 0),O([(0,t.sg)("integer",{nullable:!1}),S("design:type",Number)],P.prototype,"month",void 0),O([(0,t.sg)({nullable:!1}),S("design:type",Number)],P.prototype,"year",void 0),O([(0,t.sg)(),S("design:type",Boolean)],P.prototype,"paidInitial",void 0),O([(0,t.sg)({nullable:!1}),S("design:type",Number)],P.prototype,"noOfChits",void 0),P=O([(0,t.JH)(),S("design:paramtypes",[Object])],P);const I=P;var _=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let q=class{constructor(e){Object.assign(this,e)}createUuid(){this.uuid=c()}get name(){return this.year+this.month+this.batch}};_([(0,t.bs)(),j("design:type",Number)],q.prototype,"id",void 0),_([(0,t.sg)({nullable:!1}),j("design:type",String)],q.prototype,"batch",void 0),_([(0,t.sg)("integer",{nullable:!1}),j("design:type",Number)],q.prototype,"month",void 0),_([(0,t.sg)({nullable:!1}),j("design:type",Number)],q.prototype,"year",void 0),_([(0,t.IF)((e=>I),(e=>e.groupt),{cascade:!0}),j("design:type",Array)],q.prototype,"chits",void 0),_([(0,t.sg)({type:"uuid",unique:!0}),j("design:type",String)],q.prototype,"uuid",void 0),_([(0,t.Yc)(),j("design:type",Function),j("design:paramtypes",[]),j("design:returntype",void 0)],q.prototype,"createUuid",null),q=_([(0,t.JH)(),j("design:paramtypes",[Object])],q);const D=q;class L{constructor(e){this.options={entities:L.entities,...e,synchronize:!0}}async connect(){var e;(0,t.I5)({type:"sqljs"}),this.connection=await(0,t.I5)(this.options),this.repos={user:this.connection.getRepository(E),chit:this.connection.getRepository(N),group:this.connection.getRepository(y),payment:this.connection.getRepository(x),groupTemplate:this.connection.getRepository(D),chitTemplate:this.connection.getRepository(I)},console.log((null===(e=this.options)||void 0===e||e.name," for connection id "+this.options.name))}async close(){var e;(null===(e=this.connection)||void 0===e?void 0:e.isConnected)&&await this.connection.close(),console.log("Database connection closed")}async runQuery(e){if(!this.repos||!this.connection)throw new Error("Running a query before connecting is invalid");switch(console.log("DBMGMT: Recived message to run query",e),e.query){case"checkPhone":{const t=e.phone;let n=await this.repos.user.findOne({phone:t});return(null==n?void 0:n.phone)===t}case"createUser":{const{name:t,phone:n,address:r}=e;let i=null,a=new E({name:t,phone:n,address:r});if(await this.connection.manager.transaction((async e=>{await e.save(a)})),i=await this.repos.user.findOne({phone:n}),!i)throw new Error("Create User Does not exists in database");return i}case"checkBatch":{const{batch:t,month:n,year:r}=e;let i=await this.repos.group.findOne({batch:t,month:n,year:r});return(null==i?void 0:i.batch)===t}case"createGroup":{const{grouptUUID:t}=e,n=await this.repos.groupTemplate.findOne({uuid:t},{relations:["ChitTemplate","User"]});if(n)throw new Error("Invalid group");const{year:r,month:i,batch:a}=n,o=`${r}-${i}-${a}`;let s=0;for(const e of n.chits)s+=e.noOfChits;if(20!==s)throw new Error("Total number of chits is not equal to 20");const u=new y({name:o,batch:a,month:i,year:r,chits:[]});for(const e of n.chits){const t=e.user;if(!t)throw new Error("Invalid member got from the template");const n=new N({user:t,group:u,noOfChits:e.noOfChits,payments:[]});for(let t=1;t<=20;t++)n.payments.push(new x({chit:n,ispaid:e.paidInitial&&1===t,imonth:t}));u.chits.push(n)}await this.repos.group.manager.transaction((async e=>{await e.save(u)}));const c=await this.repos.group.findOne({name:o});if(!c)throw new Error("Created group does not exists in database.");return c}case"listUsers":return await this.repos.user.find();case"listGroups":{let e;return e=await this.repos.group.find(),e}case"userDetails":{const t=e.uuid;return await this.repos.user.findOne({uuid:t})}case"createGroupTemplate":{const{year:t,month:n,batch:r,members:i}=e;let a=null;const o=new D({batch:r,month:n,year:t,chits:[]});for(const e of i){const r=await this.repos.user.findOne({uuid:e.uuid});if(!r)throw new Error("Invalid member got for creation of Group Template");const i=new I({user:r,groupt:o,noOfChits:e.noOfChits,month:n,year:t,paidInitial:e.paidInitial});o.chits.push(i)}if(await this.repos.groupTemplate.manager.transaction((async e=>{await e.save(o)})),a=await this.repos.groupTemplate.findOne({batch:r,month:n,year:t}),!a)throw new Error("Created group does not exists in database.");return a}}}}L.entities=[E,N,y,x,I,D];let B={isDevelopement:!1,theme:"system",databaseFile:{},configPath:"",updates:{autoCheck:!0,autoDownload:!1},vueApp:null,locale:"en-in"},U=localStorage.getItem("config");U?B=JSON.parse(U):localStorage.setItem("config",JSON.stringify(B));const F=B;var J={handlers:{},init(e){J.handlers=e}},k={callMethod:async(e,...t)=>await G.handlers[e](G,...t)},G={handlers:{},init(e){G.handlers=e},callMethod:async(e,...t)=>await J.handlers[e](k,...t)};n(9483),window.config=F;const Q=new L({type:"sqljs",autoSave:!0,location:"main",useLocalForage:!0});Q.connect();const V={openExternal:async e=>{window.open(e,"_blank")},ping:async()=>console.log("Ping Recived"),showMessageBox:async e=>confirm(e.message)?1:0,showOpenDialog:async e=>prompt(e.toString()),updateConfig:async e=>function(e){localStorage.setItem("config",JSON.stringify(e))}(e)};new class{constructor(e,t,n,r){this.ipc=e,this.dbmgmt=t,this.pf=n,this.config=r}init(){const e={dbQuery:(e,t)=>this.dbmgmt.runQuery(t)};for(const t in this.pf)Object.prototype.hasOwnProperty.call(this.pf,t)&&(e[t]=async(e,...n)=>await this.pf[t](...n));this.ipc.init(e)}}(J,Q,V,F).init(),G.init({}),window.ipcirenderer=G,window.isBrowser=!0,console.log("Finished loading browser support libraries ")})()})();
//# sourceMappingURL=main.js.map