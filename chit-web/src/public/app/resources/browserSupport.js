!function(){"use strict";let e={isDevelopement:!1,theme:"system",databaseFile:{},configPath:"",updates:{autoCheck:!0,autoDownload:!1},vueApp:null},s=localStorage.getItem("config");s?e=JSON.parse(s):localStorage.setItem("config",JSON.stringify(e));var n=e;window.SharedWorker||alert("Shared Workers are not supported in your browser\nSome functionalities may be missing."),fetch("/api/login").then((e=>e.text().then((s=>{401===e.status||"LOGGED_IN"!==s?(alert("You are not signed in!\nPlease Sign in"),location.href="/login.html"):200!==e.status&&(alert("Nerwork Error!\nPlease check your internet connection."),location.reload())})))).catch((e=>console.log("CAUGHT_ERROR",e)));const t=new SharedWorker("/app/resources/browser.worker.js",{name:"mainWorker"});t.port.start(),console.log("started shared worker"),t.port.postMessage({command:"config",config:n}),window.ipcrenderer=new class{constructor(e){this.worker=e,this.port=this.worker.port,this.onceListeners={},this.listeners={},this.port.addEventListener("message",(e=>{var s,n;(null===(s=e.data)||void 0===s?void 0:s.channel)?(console.log("IPCRenderer: Recived message ",e.data," from main"),this.listeners[e.data.channel]&&this.listeners[e.data.channel].forEach((s=>{var n;return s(this.ipcrendererevent(),...null===(n=e.data)||void 0===n?void 0:n.args)})),this.onceListeners[e.data.channel]&&(this.onceListeners[e.data.channel].forEach((s=>{var n;return s(this.ipcrendererevent(),...null===(n=e.data)||void 0===n?void 0:n.args)})),this.onceListeners[e.data.channel]=null)):(null===(n=e.data)||void 0===n?void 0:n.toIpcClass)&&(this.id=e.data.id,(this.id=0)&&alert("This tab holds the main process!\nDon't close this."))}))}ipcrendererevent(){return{sender:this,senderId:this.id}}on(e,s){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(s),this}once(e,s){return this.onceListeners[e]||(this.onceListeners[e]=[]),this.onceListeners[e].push(s),this}send(e,...s){console.log("Posting message ",e,":",s," to the worker"),this.port.postMessage({channel:e,args:s})}sendSync(e,...s){console.log("Posting message ",e,":",s," to the worker"),this.port.postMessage({channel:e,args:s})}}(t),window.ipcrenderer.on("ipc",((e,s)=>{switch(s.command){case"openExternal":window.open(s.url,"_blank");break;case"openForm":let t=new URLSearchParams({form:s.type,...s.args});window.open("forms.html?"+t.toString(),"_blank","width=600,height=400,");break;case"showMessageBox":let o={response:confirm(s.options.message),checkboxChecked:!1};e.sender.send("ipc-showMessageBox",{command:"showMessageBox",data:o});break;case"updateConfig":n=s.newConfig,localStorage.setItem("config",JSON.stringify(n)),e.sender.send("ipc-updateConfig",{command:"updateConfig"})}var n})),t.onerror=function(e){throw console.error(e.error),console.log(e),e},window.config=n}();
