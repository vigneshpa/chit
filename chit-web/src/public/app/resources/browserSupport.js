!function(){"use strict";let e={isDevelopement:!1,theme:"system",databaseFile:{},configPath:"",updates:{autoCheck:!0,autoDownload:!1},vueApp:null},n=localStorage.getItem("config");n?e=JSON.parse(n):localStorage.setItem("config",JSON.stringify(e));var t=e;fetch("/api/login").then((e=>e.text().then((n=>{401===e.status||"LOGGED_IN"!==n?(alert("You are not signed in!\nPlease Sign in"),location.href="/login.html"):200!==e.status&&(alert("Nerwork Error!\nPlease check your internet connection."),location.reload())})))).catch((e=>console.log("CAUGHT_ERROR",e))),window.config=t;const s=new class{constructor(){this.mainEventHandlers={},this.rendererEventHandlers={};let e={on:(e,n)=>{this.mainEventHandlers[e]&&(this.mainEventHandlers[e]=n)}},n={id:1,call:async(e,n)=>!!this.rendererEventHandlers[e]&&await this.rendererEventHandlers[e](t,n)},t={on:(e,n)=>{this.rendererEventHandlers[e]&&(this.rendererEventHandlers[e]=n)},call:async(e,t)=>!!this.mainEventHandlers[e]&&await this.mainEventHandlers[e](n,t)};this.main=e,this.renderer=t}},i=new class{constructor(e){this.today=new Date,this.orm=e}connect(){return new Promise(((e,n)=>{this.socketAddress=(null===location||void 0===location?void 0:location.host)?("http:"===location.protocol?"ws":"wss")+"://"+location.host+"/api/dbmgmt":"ws://localhost:3000/dbmgmt",console.log("Web socket address",this.socketAddress),this.dbws=new WebSocket(this.socketAddress),this.dbws.onopen=n=>e(!0),this.dbws.onerror=e=>console.log(e)}))}async closeDB(){this.dbws.close()}runQuery(e){return new Promise(((n,t)=>{const s=Math.floor(Math.random()*10**10);e.queryId=s,this.dbws.send(JSON.stringify(e)),this.dbws.addEventListener("message",(e=>{let t=JSON.parse(e.data);t.queryId===s&&n(t.reply)}))}))}};i.connect();const o=new class{constructor(e,n,t){this.ipciMain=e,this.dbmgmt=n,this.events={},this.config=t}on(e,n){this.events[e]=n}initialise(){this.ipciMain.on("ping",(async(e,n)=>"pong")),this.ipciMain.on("show-message-box",(async(e,n)=>this.events.showMessageBox(n.options,e))),this.ipciMain.on("show-open-dialog",((e,n)=>this.events.showOpenDialog(n.options,e))),this.ipciMain.on("open-external",((e,n)=>this.events.openExternal(n.url))),this.ipciMain.on("get-config",(async(e,n)=>this.config)),this.ipciMain.on("update-config",(async(e,n)=>this.events.updateConfig(n.newConfig))),this.ipciMain.on("db-query",((e,n)=>this.dbmgmt.runQuery(n.args)))}}(s.main,i,t);o.on("openExternal",(e=>window.open(e,"_blank"))),o.on("pingRecived",(()=>console.log("Ping Recived"))),o.on("showMessageBox",(async e=>alert(e.message))),o.on("showOpenDialog",(async e=>prompt(e.toString()))),o.on("updateConfig",(async e=>function(e){try{return localStorage.setItem("config",JSON.stringify(e)),!0}catch(e){return!1}}(e))),o.initialise(),window.ipcirenderer=s.renderer,console.log("Finished loading browser support libraries ")}();
